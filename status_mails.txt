Sent:	Wednesday, November 02, 2016 10:24 AM
   - Fixed msym32 issue in Toolchain compilation.
   - Build Toolchain for LE mode and compiled SDK-BASE.
   - Ran nae loopback application in xlp5xx RC board in LE mode.
   - Observed pcie_net_sriov app crashing on xlp2xx pcie, debugging the
   same.
   - Ran startup and basic apps on xlp5xx using XLP auto test.

Sent:	Monday, October 17, 2016 9:47 AM
   - Compiled and ran Hello world program with new toolchain based on GCC
   4.9.2.
   - Observed segmentation fault if Hellow world program compiled using
   -msym32 flag.
   - All sdk-base application by default compiled wth -msym32 flag and
   throwing seg-fault, debugging the same.

Sent:	Sunday, October 09, 2016 8:29 AM
   - Fixed building Toolchain issues.
   - Build toolchain based on GCC 4.9.2, Binutils 2.25 and Glibc 2.21.
   - Compiled and run basic Hello world program on XLP2XX board.
   - Fixed XLP SDK-BASE compilation issues and compiled SDK-base.
   - Observed segmentation fault while running SDK-base applications on XLP.
   - Applications are running properly with toolchain based on GCC 4.6.3,
   Binutils 2.25 and Glibc 2.21

Sent:	Tuesday, September 27, 2016 10:40 AM
   - Fixed library issue in building toolchain based on gcc 4.9.2
   - Observed some issues while compiling XLP-SDK using new toolchain,
   debugging the same.
   - Build LTP for 64-bit MIPS using existing toolchain.
   - Observed kernel panic while running LTP on XLP board.
   -  Attended session on DPI

Sent:	Monday, September 12, 2016 11:41 AM
   - Applied XLP related patches on Glibc sources.
   - Fixed compilation issues and build toolchain.

Sent:	Friday, September 02, 2016 6:03 PM
   - Applied XLP related patches to Binutils-2.25 and GCC 4.9.2.
   - Fixed compilation issues and build toolchain.
   - Not able to Apply XLP related optimization on Glibc-2.21 due to file
   structure changes.

Sent:	Friday, August 26, 2016 5:13 PM
   - Compiled GCC 4.6.3 sources available in SDK-BASE git repository.
   - Able to Compile GCC sources with updated versions of Binutils 2.25 and
   Glibc 2.21.
   - Downloaded and applied XLP related GCC patches on GCC 4.9.2 sources.
   - Facing some issue while compiling new GCC sources, debugging the same.

Sent:	Friday, August 19, 2016 7:39 PM
   - Spent time on understanding pcie_net_sriov app.
   - Started looking at upgrading GCC.
   - Downloaded toolchain sources based on GCC 4.6.3 from git repository.
   - Facing some issue with compiling 4.6.3 GCC sources, debugging the same.

Sent:	Friday, August 12, 2016 7:22 PM
Vulcan- JDK:
   - Profile SpecJVM using JProfiler.
   - Collected CPU load, Heap and GC activities using Jprofiler.
   - Collected perf events for SpecJVM on X86 and ThunderX.
XLP-MIPS:
   -  Spent time on understanding pcie_net_sriove app

Sent:	Friday, August 05, 2016 5:34 PM
Vulcan- JDK:
   - Spent time on Understanding the JIT compilation code flow.
   - Looked at some intrinsics to make use of ARMV8 stp and vector
   instructions.

Sent:	Friday, July 29, 2016 5:44 PM
Vulcan- JDK:
   - Profiled JDK hotspot calls using Jprofiler,
   - JDK8 failed with UseLSE flag, debugged the same.
   - Backported LSE atomic instruction patch from JDK9 to JDK8.
   - Verified the performance and generation of atomic instructions using
   SpecJBB
   - Compiled OpenJDK with Brcm-gcc5.2-vulcan Toolchain.

Sent:	Friday, July 22, 2016 6:28 PM
Vulcan- JDK:
   - Installed Jprofiler and Yourkit Java profiling tools.
   - Profiled SpecJBB2015 using Jprofiler and Yourkit profiling tools,
   - Spent some time on Merging the FreeLunch tool source code changes to
   JDk hotspot code.
   - Observed compilation issues while building OpenJDK with gcc-linaro-5.3
   Toolchain, Fixed the same.
XLP-MIPS:
   - Spent some time on understanding the Ixia automation Framework.
   - Ran basic NAE app and NAE forwarding app on XLP2xx with  XAUI interface

Sent:	Monday, June 20, 2016 2:58 PM
   OpenJDK:
   - Developed a script to extract methods compiled by c2 from the debug
   logs.
   - Updated the google site with SpecJbb composite results.
   - Tried to profile SpecJBB with Valgrind but Valgrind hangs on ThundexX.
   - Spent some time on getting the raw CPU counters for A57.
   - Collected perf logs for SpecJVM benchmarks on ThunderX and x86.

Sent:	Monday, June 13, 2016 2:04 PM
   OpenJDK:
   - Collected SpecJBB results with Composite mode on Cavium.
   - Tested Atomic instruction support on Cavium.
   - Linaro Jdk8u 16-05 release binary failed with UseLSE option, Debugged
   the same
   - Ran SpecJBB with UseLSE option on Cavium.

Sent:	Monday, June 06, 2016 2:30 PM
   OpenJDK:
   - Spent some time on understanding the C2 compiler instruction selection
   logic.
   - Replace extended load instructions selection logic with separate lsl
   and load instructions.
   - Understanding the pipeline logic in JIT compiler.
   - Ran SpecJBB with default configuration on ThunderX

Sent:	Monday, May 30, 2016 4:13 PM
OpenJDK:
   - Analysed published SpceJbb multi-JVM results to understand the
   workload characterization.
   -
   - Download and installed Idealgraphvisualizer tool.
   - Analysed c2 code generation (CFG stages) with the help of
   Idealgraphvisualizer tool.

Sent:	Monday, May 23, 2016 2:55 PM
OpenJDK:
   - Ran SpecJBB using  G1 garbage collector.
   - Spent some time on understanding JVM debug print flags
   - Checkout lateset changes from openjdk repository and build Java.
   - Ran SpecJBB with latest Java from openjdk repository.

Sent:	Monday, May 16, 2016 2:29 PM
OpenJDK:
    SpecJbb2015
   - Worked with Debayan on OpenJDK Hotspot code analysis.
   - Compared SpecJbb Number of stale tasks on Juno with X86.
   - Compared x86 default JVM flags with Juno JVM flags.
   - Ran SpecJBB by changing some default JVM parameters on Juno.
   - Got the access to Linaro Cloud.

Sent:	Monday, May 09, 2016 2:49 PM
OpenJDK:
    SpecJbb2015
   - Worked with Debayan on OpenJDK Hotspot code analysis.
   - Developed scripts for OpenJDK native and cross compile, execution and
   parsing Hotspot logs for useful information
   - send ssh public key to Martin for Linaro cloud access.

Sent:	Monday, May 02, 2016 2:25 PM
OpenJDK:
    SpecJbb2015
   - Ran SpecJbb by changing number of ParallelGCThreads.
   - Spent some time on understand levels in JIT compiler.
   - Downloaded OpenJDK source and cross compiled for AARCH64
   - Looked at Linaro OpenJDK patches (16-02 and 16-03 releases)
   - Obeserved Linaro sources are not sync with OpenJDK sources.

Sent:	Monday, April 25, 2016 2:14 PM
OpenJDK:
    SpecJbb2015
   - Experimented with various JVM flags to get more debug information.
   - Installed Jitwatch tool on X86.
   - Specnt some time on understanding the usage of Jitwatch tool.
   - Ran specjbb by enabling printassembly option to get the jitwatch
   profiler log data.
   - Compared C1/C2 compilation time on Juno with  compilation time on X86.
   - Ran specjbb on juno A57 CPUs to comprae the result with Haswell.
   - Ran specjbb with new linaro 16-03 release AARCH64 Openjdk binaries.

Sent:	Monday, April 18, 2016 1:43 PM
OpenJDK:
    SpecJbb2015
   - Experimented with G1 Garbage collector tuning options.
   - Ran SpecJBB in multijvm mode with default configuration.
   - Tried running Multijvm SpecJBB with different configuration options.
   - Compared Heap usage of SpecJBB on x86 and Juno.
   - Analysed Garbage collector performance on x86 and Juno.

     Updated the Google site with logs and task list.

https://sites.google.com/a/broadcom.com/hpc-compilers-libs/toolchain/openjdk

Sent:	Monday, April 11, 2016 2:06 PM
OpenJDK:
    SpecJbb2015
   - Experimenting with deferent Garbage collectors.
      - Analysing Heap usage with Java VisualVm tool.
     SPECJVM2008:
   - Ran SPECJVM on JUNO using JDK8.
   - Except one sub menchmark all benchmarks ran succesfuuly. looks like
   this known issue with JDK8
   - All benchmarks ran succesfully on JUNO with JDK7.

     Updated the Google site with logs and task list.

https://sites.google.com/a/broadcom.com/hpc-compilers-libs/toolchain/openjdk

Sent:	Monday, April 04, 2016 3:03 PM
OpenJDK:
   - Installed OpenJDK 8 on Juno board.
   - Downloaded OpenJDK8 binaries from linaro website.
   - Got SPECjbb 2015 binaries from Bheemesh.
   - Ran SPECjbb binaries on Juno board with default configuraion.\

Issues:

   - Observed validation error (Max perf delay Criteria failed) in SPECjbb
   result.
   - Tried running the SPECjbb with modified configuration parameters to
   resolve this issue.
   - By increasing max heap memory size this issue was resolved.

Sent:	Monday, March 28, 2016 3:02 PM
Benchmarks/Applications:
     WRF: (Weather Research and Forecasting)

   - Compiled WRF with mpich libraries on x86 and ran the CONUS 12KM
   benchmark.
   - Installed dependent packages on Juno
   - Calculated the peak memory usage of WRF with CONUS benchmark on X86.

Issues:
    Facing issues in compilation WRF on Juno.

Sent:	Tuesday, March 22, 2016 11:34 AM
Benchmarks/Applications:
     WRF: (Weather Research and Forecasting) on X86
   - Compiled and ran WRF Real test case.
   - Fixed compilation issued in WPS (WRF Preprocessing system).
   - Compiled Post processing Application( ARWPost) and ran with WRF output.
   - Downloaded CONUS 12Km benchmark to calculate WRF performance.
   - Ran Conus12Km bench with WRF serial version.

Issues:
    Facing issues in compilation WRF with OpenMPI.

Sent:	Monday, March 14, 2016 1:58 PM
Benchmarks/Applications:
     WRF: (Weather Research and Forecasting) on X86
   - Downloaded the WRF source and compiled.
      - Installed dependent packages.
      - Ran Idealized data test cases.
      - Downloaded Post processing Application( ARWPost) and compiled.

Sent:	Monday, March 07, 2016 12:43 PM
QEMU / LLVM

   - Added Predicate Count instructions in LLVM framework.
   - Checked in QEMU and LLVM code.

Sent:	Monday, February 29, 2016 2:07 PM
  QEMU/LLVM:
   - Implemented/Added required shoji instructions in QEMU/LLVM to run
   RSbench binary.
   - Ran Rsbench binary with shoji instructions on QEMU.
   - Added  following categories of instructions in LLVM framework.
   1.  BitShift permute and count.
      2.  Floating point conversions.
      3.  Horizantal Redections.

Sent:	Monday, February 22, 2016 2:36 PM
  QEMU/LLVM:
       Ran the Lulseh binary on Qemu with new shoji encodings.
       Debugged issues faced in running the lulesh binary.

Sent:	Monday, February 15, 2016 4:10 PM
  QEMU/LLVM:
       Added required instructions in LLVm/QEMU to run lulesh binary.

Sent:	Monday, February 08, 2016 2:11 PM
QEMU/LLVM:
        Added following categories of load/store instructions to LLVM
framework.
   - Scalar plus Scalar.
   - Scalar plus Immediate.
   - Vector plus Immediate.
   - Scalar plus Vector.

Sent:	Monday, February 01, 2016 12:36 PM
QEMU/LLVM:
        Implemented 40 load/store instruction in QEMU.
        Ramp up on LLVM to add shoji instructions.
        Added 4 load/store instructions to LLVM framework.

Sent:	Monday, January 25, 2016 2:19 PM
QEMU:
	Implemented 40 basic load and store instructions.
                Started testing implemented instructions.

Issues:
    Facing some Issue with byte mode load/store instructions. debugging
the same.

Sent:	Thursday, January 14, 2016 5:34 PM
QEMU:
               Implemented following categories of instructions in QEMU.

         Horizontal reduction instructions.

         Permute and shuffle instructions.

            Started implementing load/store instructions.

Sent:	Monday, January 11, 2016 11:25 AM
QEMU:
               Implemented following categories of instructions in QEMU.

         Floating point comparisons.

         Floating point conversions

         Bit shift permute and count

         Bitwise logical operations

         Predicate count.



Sent: Monday, 04 January, 2016 12:01 PM
QEMU:
               Implemented following categories of instructions in QEMU.

         Vector set and copy

         Constructive prefix

         Integer comparisons.

         Simple counted loop instructions


Sent:	Monday, January 04, 2016 12:01 PM
QEMU:
               Implemented following categories of instructions in QEMU.

         Vector set and copy

         Constructive prefix

         Integer comparisons.

         Simple counted loop instructions


Sent:	Monday, December 28, 2015 11:33 AM
QEMU:
               Implemented integer arithmetic instructions in QEMU.

               Modified load/store instructions to work with predicate
register.

               Moved all shoji related functions to new file and fixed
compilation issues.

 

Issues:

.          

 

,



 


Sent:	Monday, December 21, 2015 12:35 PM


Subject:	status: WW51



 

Achievements:

QEMU:

                Implemented following categories of instructions in QEMU.

.         Predicate logical operations

.         Predicate set and copy operations

.         Conditional loop break instructions.

 

Issues:

.          

 

,



 


Sent:	Monday, December 14, 2015 12:40 PM


Subject:	status: WW50



 

Achievements:

QEMU:

. Looked at QEMU code to implement shoji instructions.

. Spent some time on understanding new shoji instructions from new shoji
spec.

                . Implemented 20 Floating point arithmetic instructions in
QEMU.

 

Issues:

.          

 

,



 


Sent:	Monday, December 07, 2015 12:34 PM


Subject:	RE: status: WW48



 

Achievements:

Gem5:

.         Implemented 8 Integer arithmetic instructions in Gem5

.         Looked at new shoji spec for the modifications.

 

Issues:

.          

 

,



 


Sent:	Monday, November 30, 2015 11:40 AM


Subject:	status: WW48



 

Achievements:

Gem5:

.         Implemented Following Serialized operations instructions. 

                PNEXT, CTERMEQ, CTERMNE,  PTERMA, PTERMB, PROPA, PROPB,
WPEP, ADDPL, ADDVL, ADR

.         Fixed a bug in accessing input registers for Bitwise shift
operations. 

Issues:

.          

 

,



 


Sent:	Monday, November 23, 2015 11:34 AM


Subject:	status: WW47



 

Achievements:

Gem5:

.         Implemented Predicate partitioning instructions. 

.         Implemented special register access instructions.

.         Added shoji FPSR1 and FPSR2 registers.

.         Fixed a bug due to wrong interpretation of constant for MUL
instructions.

.         Fixed a bug in decoding source register for integer arithmetic
instructions.

 

Issues:

.          

 

,



 


Sent:	Monday, November 16, 2015 1:55 PM


Subject:	status: WW46



 

Achievements:

.          

Misc:  

    PTO: 4days

 

Plan for current week:

      Implement following categories of instructions in GEM5.

.         Predicate partitioning.

.         Serialized operations and address calculation.

.         Special registers.

.         Floating point trigonometry.

 

,



 


Sent:	Friday, November 06, 2015 5:17 PM


Subject:	status: WW45



 

Achievements:

Gem5:

.         Implemented Permute and shuffle instruction in GEM5 ISA.

.         Implemented Predicate count Instructions.

                

Issues:

.          

 

,



 


Sent:	Monday, November 02, 2015 12:04 PM


Subject:	status: WW44



 

Achievements:

Gem5:

.         Created unit tests for shoji floating point arithmetic
instructions.

.         Implemented 10 Vector Permute and Shuffle instructions.

                

Issues:

.          

 

,



 


Sent:	Monday, October 26, 2015 3:15 PM


Subject:	status: WW43



 

Achievements:

Gem5:

                Started  writing unit tests for shoji floating point
arithmetic instructions.

.         Created test cases for 10 instructions.

.         Checked-in the test cases written so far.

                

Issues:

.          

 

,



 


Sent:	Friday, October 16, 2015 1:08 PM


Subject:	status: WW42



 

Achievements:

Gem5:

                Implemented 39 Shoji Integer Arithmetic instructions in
Gem5.

Issues:

.          

 

,



 


Sent:	Monday, October 12, 2015 12:19 PM


Subject:	status: WW41



 

Achievements:

Gem5:

.         Added Following shoji instructions in Gem5

                   9 Floating Point Arithmetic instructions.

                     8 Predicate logic instructions.

  

Issues:

.          

 

,



 


Sent:	Monday, October 05, 2015 2:51 PM


Subject:	status: WW40



 

Achievements:

Gem5:

.         Ramped up on Gem5's ISA infrastructure.

.         Added Following floating point shoji instructions with existing
template code.

        FSUB, FSUBR, FABD,FDIV,FDIVR.

Issues:

.          

 

,



 


Sent:	Monday, September 28, 2015 10:55 AM


Subject:	status: WW39



 

Worked on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue. 

Tried following hacks to check the behavior, but the data transfer ends up
with errors.

1.       Transferring data using single line mode (by setting Data
Transfer width bit to 0 on Host Control Register)

2.       Transferring the data using single block mode (by disabling the
Multi block mode)

3.       Added some delay (say 100us) before releasing the MMC lock for
the other controller

 

,




Sent:	Saturday, September 26, 2015 7:14 PM


Subject:	RE: mmc issue on Griffin B0





I’ve spent a reasonable time and put my best effort in debugging MMC
issue.

Since it is not going any further I’m planning to stop working on this as
Vulcan related work has become priority.



So, I’m just consolidating all my findings during these days of debugging.



Debug summary



On XLP9XX B0 board:

Observed errors with error code #145 (timeout error) and #88 (DCRC error)
in following scenarios.

1.       Transferring two huge files (say 2GB each, random data) from
Ramfs to both mmc cards one after the other without running sync command
before file transfer to the second mmc.

2.       Transferring one huge file (say 2GB) file from one mmc card to
2nd mmc card.



Note:

·         Sometimes data transfer aborts.

        When driver gets #88 error from MMC device, driver issues a STOP
cmd for a particular block of transfer to the device and gets timeout and
no response from mmc device.

Hence driver assumes that the MMC card is not present and produces Abort
messages

·         If transfer doesn’t aborts File system on mmc corrupted.

·         MMC Operation sequence was normal till the error observed.



Tried following hacks to check the behavior, but the behavior was same i.e
data transfer always ends up with errors.

1.       DMA Mode data transfer (default ADMA)

2.       Transferring data using single line mode (by setting Data
Transfer width bit to 0 on Host Control Register)

3.       Transferring the data using single block mode (by disabling the
Multi block mode)

4.       Added some delay (say 100us) before releasing the MMC lock for
the other controller



Working scenario on B0:

1.       Transferring two huge files (say 2GB each, random data) from
Ramfs to both mmc cards one after the other by  running sync command
before file transfer to the second mmc.

       MMC0 copies files to or from RAM file system and run  “sync”
command and then  MMC1 copies files to or from RAM filesystem.



On XLP9XX A0 board:

For all the non-working data transfer cases mentioned for B0 completes in
A0 but with error #145. No data corruption observed



,






Sent: Thursday, September 24, 2015 1:36 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Thanks for the updates Praveen.



I saw an update on Siva’s updates which included some good details of the
behavior when Error 88 is encountered which I did not hear before.



o   Debugged the reason for Abort messages when two different files are
transferred to two MMC cards from Ramfs one after the other.

o   When driver gets #88 error from MMC device, driver issues a STOP cmd
to the device and gets no response from it. Hence driver assumes that the
MMC card is not present and produces Abort messages.



Hardware team (Varun, Basil, Gaganpreet) had done different test cases for
testing similar to the ones I had described to you.  Gaganpreet’s test
cases and logs are attached to the
http://ingjira.sj.broadcom.com/browse/EPSW-2938 ticket where this issue
was logged.   When they did testing keeping MMC operations separately or
with sync they did not see issues also.  They saw similar problems as you
when performing tests with both MMC used at similar times, which is why we
are trying to understand if there is anything missing in the software
workaround for protecting both MMC (registers, data movements, etc.) from
being used at the same time, and are trying to find a trace which can
showcase either the software workaround being incomplete (or maybe needing
to add some delay latency before releasing the MMC lock for the other
controller?) or the hardware to be at fault and a method to showcase that.



What do you believe we should look at next, are you in progress on the
above points to determine any reason why the MMC does not respond to the
“STOP cmd”?



Some ideas to get further I had

-          What is the different symptoms and operations leading up to
error 88 or 145 on B0 silicon? How do the operations up to that point
differ to the failure signature?

-          What specifically does error 88 show has happened to the MMC
device for data corruption?  Does the recovery after error 88 (driver
reload?) recover and repeat all the same operations or does it fail to
complete the last operations (cleanly or in a dirty state?)?




Ryan




Sent: Monday, September 21, 2015 5:37 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



HI Ryan,



Sorry for the late reply, I was on leave last week.

Please see my comments inline.



2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?

Ø  Observed both 145 and 88 (DCRC ) errors.

Ø  I have tried transferring two different files to two mmc cards, but I
have observed the same errors 145 and 88 (DCRC error).



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?

Ø  On A1 , observed only 145 (Time out ) error. No data corruption
happening.

Ø  On B0/B1, observed both 145 and 88 (DCRC) errors.



I am wondering if anyone from Hardware team has tested this issue. If so,
sharing the test details may help us in our debugging.



,






Sent: Saturday, September 19, 2015 3:19 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0







Can you help to follow up on this request for Griffin MMC debug?



One important part I wanted to follow up on with you, the 2nd case where
we use 2 MMC at same time but not WITH SAME DATA transferred between
them..



                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?



This needs to be understood what delta’s in error types and issues are
seen so we focus our debug correctly.




Ryan




Sent: Thursday, September 10, 2015 4:36 PM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



+Paul/Joe



Praveen, Gaganpreet confirmed my comment is correct here:

The comment “non-fatal” in the error list was suggested as such because
the driver restarts and I guess continues operation to a successful test
completion, Gaganpreet is that correct?




Ryan




Sent: Wednesday, September 09, 2015 7:14 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Thanks for following up, I’ve been getting buried in tasks and issues
recently so haven’t been able to follow the below in-depth.  I’m going to
see if I can include another AE who can assess the details of the MMC
driver and error codes to give commentary on debug steps.



One important part I wanted to follow up on with you, the 2nd case where
we use 2 MMC at same time but not WITH SAME DATA transferred between
them..



                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?

This needs to be understood what delta’s in error types and issues are
seen so we focus our debug correctly.



The comment “non-fatal” in the error list was suggested as such because
the driver restarts and I guess continues operation to a successful test
completion, Gaganpreet is that correct?

The “cmd error” in the MMC_error_list excel sheet seems to suggest there
are time outs however from the output described.. that is definitely not
seem to be correlated to your missing timeout interrupt right, you don’t
see that log?



One of the logs:

mmcblk1: timed out sending r/w cmd command, card status 0x900

end_request: I/O error, dev mmcblk1, sector 63587

Buffer I/O error on device mmcblk1p2, logical block 15392

lost page write due to I/O error on mmcblk1p2



Ryan




Sent: Monday, September 07, 2015 6:07 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Since we know the cause for the generation of error 145(Waiting for
cmd/data completion interrupt) and error 88 (cmd/data error)

and it is also mentioned in the excel sheet attached to  EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  that these errors are
not fatal, what else do you want me to debug ?

Please suggest.



,
.


Sent: Tuesday, September 01, 2015 7:17 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







·         I have tried the two test cases which you suggested me to try on
griffin B0 , Following are the details



                1st case:

             - MMC0 copies files to or from RAM filesystem

     -THEN “sync” and then do MMC1 copies files to or from RAM filesystem

                                No issue, Works fine.

                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       Works well if the second command is run after some delay (10 sec)
instead of running immediately after first command completes.

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.



                Note: On griffin A1 , above 2 cases works fine.



·         I have been debugging MMC issue on A1 so far. Most of the time
observed timeout issue.

And On B0 I have observed error 88 (cmd or data error) , currently
debugging the same.



,

.




Sent: Saturday, August 29, 2015 6:18 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







So that the MMC operations don’t come into a weird state due to MMC0 and
MMC1 workaround that they cannot make operations (or even register
accesses) at the same time (and yet they somewhat must to provide data
from one to the other), are you able to change the test case so that we
try to avoid MMC0 or MMC1 doing any operations at same time and see if we
can reproduce an issue?



-          MMC0 copies files to or from RAM filesystem

-          THEN “sync” and then do MMC1 copies files to or from RAM
filesystem



If that can’t reproduce an issue, can we at least try not having MMC0 and
MMC1 transfer directly to each other so that they are not dependent on the
data operations occurring from each other?



-          MMC0 copies files to or from RAM filesystem

-          AND MMC1 copies files to or from RAM filesystem




Ryan




Sent: Friday, August 28, 2015 6:47 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0



HI Varun,



First I am mounting two mmc cards then copying 2gb of file with random
data from one mmc to other.

I tried to copy data form mmc1 to mmc2 and also mmc2 to mmc1, Almost every
time I am getting the error.



,

.




Sent: Friday, August 28, 2015 4:39 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0



Hello Praveen,



I am trying to understand the experiment being done here.

You copy data from one mmc to other mmc. Are you mounting both mmc first
and directly copying data from one mmc to other mmc?

Or do you copy the data from one mmc to system and then in second step
copy it to other mmc?



How often you see the failure? Are you always copying from a specific slot
to other slot or you are also doing other way round?





Varun








Sent: Thursday, August 27, 2015 5:50 AM

Khadilkar

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Just a clarification on 2nd question.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                This test is done with the workaround only.





Kamlakant Patel




Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0







Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.



Praveen, my interpretation of your results, does your current experiments
seem to suggest that

1.       In a failing case, the MMC controller is not generating a “Data
Transfer Complete” interrupt – and the rest of the operation and commands
up to that point seem fine – Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?



Ryan,



Following are my observations during debugging process.

·         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I’ve increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

·         I’ve extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a “Data Transfer
Complete/Command Complete” interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.



Following is the sequence of mmc operations in working and non-working
case.



Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)



Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)






Ryan






Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0







As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.



1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>

>> JC just started passing this debug to Mayank’s team in QA team to help
to test and address this issue, I’ll provide updates on the plan from
them.



2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank’s team in QA team to help
to test and address this issue, I’ll provide updates on the plan from
them.



3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.




Ryan




Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0



Kaushik,



There are several outstanding Griffin debug items that require your team’s
support.



We have been awaiting a schedule to resolve them for several weeks.



Please review with your team and provide a schedule.



1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)



Shaun




Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi JC



The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

·         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc.

·         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.





,



Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Gaganpreet,



We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time.

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.



It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.



,

JC.




Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Basil had further questions (please see attached). Let us know your take
on this.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0







Please find my reply inline.

Sorry for late reply, I was on leave last week.





Kamlakant Patel




Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi JC



NOTES:

·         DCRC error (Error Message – “Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress”) is
non-fatal, hence not of interest.

·         Error Val -145, -88 are non-fatal errors, hence not of interest.



NEXT:

Please

·         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

·         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

·         Explain these two errors observed in the “mmc_error_trace.txt”

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

·         Correlate the time-stamps of “mmc_error_trace.txt” and
“mmc_error.log”.

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.



Thanks

Gaganpreet Singh

Office: 4089194230








Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Gaganpreet, Varun,




transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.



And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.





JC.




Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0







Please find the details below.



Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.



f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002



·         Please find the log file with the detailed sequence of
operations, registers, register values and error.

·         Please find state of the machine after the error:



[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================



>3. The patch file shows the synchronization you have added. We are
assuming following for the function “static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)” that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.





Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Do you have any updates to share? Please let us know.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses.



1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?



0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000





2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure – This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.



3. The patch file shows the synchronization you have added. We are
assuming following for the function “static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)” that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.





Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Including Paul back into the discussion for assisting.



Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I’m not clear what Kamlakant’s new trace scenario is from and who
will review it next (Varun?).




Ryan




Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



HI all,



Please refer this(attached) file for trace.





Kamlakant Patel




Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.





Kamlakant  Patel




Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Sorry for the delay.



Please find the details below.

1.       (a). Checked the code again and again, couldn’t see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.



2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0



3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].







Kamlakant Patel




Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Just to re-capture what we discussed for individual points:



1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun.

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.





Kamlakant Patel




Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?



1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b].

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

·         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is “mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc” then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to “synchronize” the
operation”, without which failures occur on all other products.
[Kamlakant, Pending]



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.



We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.





Kamlakant Patel




Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.



I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Today’s debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ….

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

…



Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it’s working fine on other boards.





Kamlakant Patel




Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Kamlakant,



Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.



We need solutions to the other failures.



But I am still getting DCRC error on mmc1.

I am still not able to conclude either it’s a Hardware or software issue.
I will continue debugging.



Shaun








Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Did you have to make any changes to the driver to ensure “only one card is
active at a time and there is no interrupt conflicts between both MMCs”?



Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?





Basil




Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.





Varun




Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1.

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.



Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.



Do you see any other failures except DCRC on slot 1? What about Slot 0?





Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it’s a Hardware or software issue.
I will continue debugging.



I have following questions:

·         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.



·         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.





Kamlakant Patel




Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround.

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday.

If you want to refer the run logs for our testing, please refer the
following directories:

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.



> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.





Kamlakant Patel




Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design.

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hello Shaun,



Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.



If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.



Apart from simultaneous access to MMC Kamlakant mentions “looks like there
are some more issues with Griffin, we suspect it’s a hardware issue but
couldn’t conclude the actual reason”

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it.

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)





Varun






Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



+Varun



Varun,



Didn’t you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?



Perhaps we have different definitions of simultaneous?



Kamlakant,



Where are your results posted that point to a h/w problem?



Shaun




Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0



+ Ken, Shaun, Basil



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0







We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).



We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it’s a
hardware issue but couldn’t conclude the actual reason.



Please refer following JIRA’s for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180

http://ingjira.sj.broadcom.com/browse/EPSW-2938



Could you please help debug this issue.





Kamlakant Patel


Sent:	Saturday, September 26, 2015 2:14 PM

Subject:	RE: Griffin B0 MMC bug status



 

I've spent a reasonable time and put my best effort in debugging MMC
issue.

Since it is not going any further I'm planning to stop working on this as
Vulcan related work has become priority.

 

So, I'm just consolidating all my findings during these days of debugging.

 

Debug summary

 

On XLP9XX B0 board:

Observed errors with error code 145 (timeout error) and 88 (DCRC error) in
following scenarios.

1.       Transferring two huge files (say 2GB each, random data) from
Ramfs to both mmc cards one after the other without running sync command
before file transfer to the second mmc.

2.       Transferring one huge file (say 2GB) file from one mmc card to
2nd mmc card.

 

Note: 

.         Sometime data Transfer aborts.

        When driver gets #88 error from MMC device, driver issues a STOP
cmd for a particular block of transfer to the device and gets timeout and
no response from mmc device. Hence driver assumes that the MMC card is not
present and produces Abort messages 

.         Mmc Operation sequence was normal till the error observed.

 

Tried following hacks to check the behavior, but the behavior was same ,
transferring the data ends up with errors.

a.        DMA Mode data transfer (default ADMA) 

b.      Transferring data using single line mode (SD1 mode )

c.       Transferring the data using single block mode (by disabling the
Multi block mode)

d.      Added some delay (say 100us) before releasing the MMC lock for the
other controller

 

Working scenario on B0:

1.       Transferring two huge files (say 2GB each, random data) from
Ramfs to both mmc cards one after the other by  running sync command
before file transfer to the second mmc.

        -MMC0 copies files to or from RAM filesystem

-THEN "sync" and then do MMC1 copies files to or from RAM filesystem

 


Sent:	Friday, September 25, 2015 4:48 PM

Subject:	FW: mmc issue on Griffin B0

Look this and write the mail




Sent: Thursday, September 24, 2015 1:36 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Thanks for the updates Praveen.



I saw an update on Siva’s updates which included some good details of the
behavior when Error 88 is encountered which I did not hear before.



o   Debugged the reason for Abort messages when two different files are
transferred to two MMC cards from Ramfs one after the other.

o   When driver gets #88 error from MMC device, driver issues a STOP cmd
to the device and gets no response from it. Hence driver assumes that the
MMC card is not present and produces Abort messages.



Hardware team (Varun, Basil, Gaganpreet) had done different test cases for
testing similar to the ones I had described to you.  Gaganpreet’s test
cases and logs are attached to the
http://ingjira.sj.broadcom.com/browse/EPSW-2938 ticket where this issue
was logged.   When they did testing keeping MMC operations separately or
with sync they did not see issues also.  They saw similar problems as you
when performing tests with both MMC used at similar times, which is why we
are trying to understand if there is anything missing in the software
workaround for protecting both MMC (registers, data movements, etc.) from
being used at the same time, and are trying to find a trace which can
showcase either the software workaround being incomplete (or maybe needing
to add some delay latency before releasing the MMC lock for the other
controller?) or the hardware to be at fault and a method to showcase that.



What do you believe we should look at next, are you in progress on the
above points to determine any reason why the MMC does not respond to the
“STOP cmd”?



Some ideas to get further I had

-          What is the different symptoms and operations leading up to
error 88 or 145 on B0 silicon? How do the operations up to that point
differ to the failure signature?

-          What specifically does error 88 show has happened to the MMC
device for data corruption?  Does the recovery after error 88 (driver
reload?) recover and repeat all the same operations or does it fail to
complete the last operations (cleanly or in a dirty state?)?




Ryan




Sent: Monday, September 21, 2015 5:37 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



HI Ryan,



Sorry for the late reply, I was on leave last week.

Please see my comments inline.



2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?

Ø  Observed both 145 and 88 (DCRC ) errors.

Ø  I have tried transferring two different files to two mmc cards, but I
have observed the same errors 145 and 88 (DCRC error).



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?

Ø  On A1 , observed only 145 (Time out ) error. No data corruption
happening.

Ø  On B0/B1, observed both 145 and 88 (DCRC) errors.



I am wondering if anyone from Hardware team has tested this issue. If so,
sharing the test details may help us in our debugging.



,






Sent: Saturday, September 19, 2015 3:19 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0







Can you help to follow up on this request for Griffin MMC debug?



One important part I wanted to follow up on with you, the 2nd case where
we use 2 MMC at same time but not WITH SAME DATA transferred between
them..



                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?



This needs to be understood what delta’s in error types and issues are
seen so we focus our debug correctly.




Ryan




Sent: Thursday, September 10, 2015 4:36 PM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



+Paul/Joe



Praveen, Gaganpreet confirmed my comment is correct here:

The comment “non-fatal” in the error list was suggested as such because
the driver restarts and I guess continues operation to a successful test
completion, Gaganpreet is that correct?




Ryan




Sent: Wednesday, September 09, 2015 7:14 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Thanks for following up, I’ve been getting buried in tasks and issues
recently so haven’t been able to follow the below in-depth.  I’m going to
see if I can include another AE who can assess the details of the MMC
driver and error codes to give commentary on debug steps.



One important part I wanted to follow up on with you, the 2nd case where
we use 2 MMC at same time but not WITH SAME DATA transferred between
them..



                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?

This needs to be understood what delta’s in error types and issues are
seen so we focus our debug correctly.



The comment “non-fatal” in the error list was suggested as such because
the driver restarts and I guess continues operation to a successful test
completion, Gaganpreet is that correct?

The “cmd error” in the MMC_error_list excel sheet seems to suggest there
are time outs however from the output described.. that is definitely not
seem to be correlated to your missing timeout interrupt right, you don’t
see that log?



One of the logs:

mmcblk1: timed out sending r/w cmd command, card status 0x900

end_request: I/O error, dev mmcblk1, sector 63587

Buffer I/O error on device mmcblk1p2, logical block 15392

lost page write due to I/O error on mmcblk1p2



Ryan




Sent: Monday, September 07, 2015 6:07 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Since we know the cause for the generation of error 145(Waiting for
cmd/data completion interrupt) and error 88 (cmd/data error)

and it is also mentioned in the excel sheet attached to  EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  that these errors are
not fatal, what else do you want me to debug ?

Please suggest.



,
.


Sent: Tuesday, September 01, 2015 7:17 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







·         I have tried the two test cases which you suggested me to try on
griffin B0 , Following are the details



                1st case:

             - MMC0 copies files to or from RAM filesystem

     -THEN “sync” and then do MMC1 copies files to or from RAM filesystem

                                No issue, Works fine.

                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       Works well if the second command is run after some delay (10 sec)
instead of running immediately after first command completes.

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.



                Note: On griffin A1 , above 2 cases works fine.



·         I have been debugging MMC issue on A1 so far. Most of the time
observed timeout issue.

And On B0 I have observed error 88 (cmd or data error) , currently
debugging the same.



,

.




Sent: Saturday, August 29, 2015 6:18 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







So that the MMC operations don’t come into a weird state due to MMC0 and
MMC1 workaround that they cannot make operations (or even register
accesses) at the same time (and yet they somewhat must to provide data
from one to the other), are you able to change the test case so that we
try to avoid MMC0 or MMC1 doing any operations at same time and see if we
can reproduce an issue?



-          MMC0 copies files to or from RAM filesystem

-          THEN “sync” and then do MMC1 copies files to or from RAM
filesystem



If that can’t reproduce an issue, can we at least try not having MMC0 and
MMC1 transfer directly to each other so that they are not dependent on the
data operations occurring from each other?



-          MMC0 copies files to or from RAM filesystem

-          AND MMC1 copies files to or from RAM filesystem




Ryan




Sent: Friday, August 28, 2015 6:47 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0



HI Varun,



First I am mounting two mmc cards then copying 2gb of file with random
data from one mmc to other.

I tried to copy data form mmc1 to mmc2 and also mmc2 to mmc1, Almost every
time I am getting the error.



,

.




Sent: Friday, August 28, 2015 4:39 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0



Hello Praveen,



I am trying to understand the experiment being done here.

You copy data from one mmc to other mmc. Are you mounting both mmc first
and directly copying data from one mmc to other mmc?

Or do you copy the data from one mmc to system and then in second step
copy it to other mmc?



How often you see the failure? Are you always copying from a specific slot
to other slot or you are also doing other way round?





Varun








Sent: Thursday, August 27, 2015 5:50 AM

Khadilkar

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Just a clarification on 2nd question.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                This test is done with the workaround only.





Kamlakant Patel




Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0







Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.



Praveen, my interpretation of your results, does your current experiments
seem to suggest that

1.       In a failing case, the MMC controller is not generating a “Data
Transfer Complete” interrupt – and the rest of the operation and commands
up to that point seem fine – Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?



Ryan,



Following are my observations during debugging process.

·         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I’ve increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

·         I’ve extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a “Data Transfer
Complete/Command Complete” interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.



Following is the sequence of mmc operations in working and non-working
case.



Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)



Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)






Ryan






Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0







As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.



1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>

>> JC just started passing this debug to Mayank’s team in QA team to help
to test and address this issue, I’ll provide updates on the plan from
them.



2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank’s team in QA team to help
to test and address this issue, I’ll provide updates on the plan from
them.



3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.




Ryan




Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0



Kaushik,



There are several outstanding Griffin debug items that require your team’s
support.



We have been awaiting a schedule to resolve them for several weeks.



Please review with your team and provide a schedule.



1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)



Shaun




Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi JC



The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

·         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc.

·         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.





,



Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Gaganpreet,



We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time.

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.



It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.



,

JC.




Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Basil had further questions (please see attached). Let us know your take
on this.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0







Please find my reply inline.

Sorry for late reply, I was on leave last week.





Kamlakant Patel




Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi JC



NOTES:

·         DCRC error (Error Message – “Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress”) is
non-fatal, hence not of interest.

·         Error Val -145, -88 are non-fatal errors, hence not of interest.



NEXT:

Please

·         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

·         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

·         Explain these two errors observed in the “mmc_error_trace.txt”

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

·         Correlate the time-stamps of “mmc_error_trace.txt” and
“mmc_error.log”.

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.



Thanks

Gaganpreet Singh

Office: 4089194230








Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Gaganpreet, Varun,




transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.



And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.





JC.




Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0







Please find the details below.



Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.



f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002



·         Please find the log file with the detailed sequence of
operations, registers, register values and error.

·         Please find state of the machine after the error:



[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================



>3. The patch file shows the synchronization you have added. We are
assuming following for the function “static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)” that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.





Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Do you have any updates to share? Please let us know.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses.



1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?



0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000





2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure – This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.



3. The patch file shows the synchronization you have added. We are
assuming following for the function “static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)” that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.





Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Including Paul back into the discussion for assisting.



Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I’m not clear what Kamlakant’s new trace scenario is from and who
will review it next (Varun?).




Ryan




Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



HI all,



Please refer this(attached) file for trace.





Kamlakant Patel




Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.





Kamlakant  Patel




Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Sorry for the delay.



Please find the details below.

1.       (a). Checked the code again and again, couldn’t see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.



2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0



3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].







Kamlakant Patel




Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Just to re-capture what we discussed for individual points:



1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun.

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.





Kamlakant Patel




Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?



1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b].

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

·         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is “mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc” then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to “synchronize” the
operation”, without which failures occur on all other products.
[Kamlakant, Pending]



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.



We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.





Kamlakant Patel




Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.



I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Today’s debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ….

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

…



Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it’s working fine on other boards.





Kamlakant Patel




Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Kamlakant,



Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.



We need solutions to the other failures.



But I am still getting DCRC error on mmc1.

I am still not able to conclude either it’s a Hardware or software issue.
I will continue debugging.



Shaun








Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Did you have to make any changes to the driver to ensure “only one card is
active at a time and there is no interrupt conflicts between both MMCs”?



Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?





Basil




Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.





Varun




Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1.

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.



Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.



Do you see any other failures except DCRC on slot 1? What about Slot 0?





Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it’s a Hardware or software issue.
I will continue debugging.



I have following questions:

·         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.



·         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.





Kamlakant Patel




Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround.

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday.

If you want to refer the run logs for our testing, please refer the
following directories:

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.



> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.





Kamlakant Patel




Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design.

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hello Shaun,



Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.



If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.



Apart from simultaneous access to MMC Kamlakant mentions “looks like there
are some more issues with Griffin, we suspect it’s a hardware issue but
couldn’t conclude the actual reason”

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it.

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)





Varun






Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



+Varun



Varun,



Didn’t you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?



Perhaps we have different definitions of simultaneous?



Kamlakant,



Where are your results posted that point to a h/w problem?



Shaun




Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0



+ Ken, Shaun, Basil



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0







We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).



We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it’s a
hardware issue but couldn’t conclude the actual reason.



Please refer following JIRA’s for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180

http://ingjira.sj.broadcom.com/browse/EPSW-2938



Could you please help debug this issue.





Kamlakant Patel


Sent:	Monday, September 21, 2015 6:07 PM


Subject:	RE: mmc issue on Griffin B0

HI Ryan,



Sorry for the late reply, I was on leave last week.

Please see my comments inline.



2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?

Ø  Observed both 145 and 88 (DCRC ) errors.

Ø  I have tried transferring two different files to two mmc cards, but I
have observed the same errors 145 and 88 (DCRC error).



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?

Ø  On A1 , observed only 145 (Time out ) error. No data corruption
happening.

Ø  On B0/B1, observed both 145 and 88 (DCRC) errors.



I am wondering if anyone from Hardware team has tested this issue. If so,
sharing the test details may help us in our debugging.



,






Sent: Saturday, September 19, 2015 3:19 AM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0







Can you help to follow up on this request for Griffin MMC debug?



One important part I wanted to follow up on with you, the 2nd case where
we use 2 MMC at same time but not WITH SAME DATA transferred between
them..



                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?



This needs to be understood what delta’s in error types and issues are
seen so we focus our debug correctly.




Ryan




Sent: Thursday, September 10, 2015 4:36 PM

Varghese

(Sivaprasad) Pochiraju; Paul Kim; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



+Paul/Joe



Praveen, Gaganpreet confirmed my comment is correct here:

The comment “non-fatal” in the error list was suggested as such because
the driver restarts and I guess continues operation to a successful test
completion, Gaganpreet is that correct?




Ryan




Sent: Wednesday, September 09, 2015 7:14 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Thanks for following up, I’ve been getting buried in tasks and issues
recently so haven’t been able to follow the below in-depth.  I’m going to
see if I can include another AE who can assess the details of the MMC
driver and error codes to give commentary on debug steps.



One important part I wanted to follow up on with you, the 2nd case where
we use 2 MMC at same time but not WITH SAME DATA transferred between
them..



                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

>> What is the error observed in this log?  Was it error 145 or error 88?



Your comments on B0 vs A1, are you suggesting that the more fatal issue of
error 145 (timeout error) is only seen on A1 and never on B0 part?  And on
B0 part you have only seen error 88?

This needs to be understood what delta’s in error types and issues are
seen so we focus our debug correctly.



The comment “non-fatal” in the error list was suggested as such because
the driver restarts and I guess continues operation to a successful test
completion, Gaganpreet is that correct?

The “cmd error” in the MMC_error_list excel sheet seems to suggest there
are time outs however from the output described.. that is definitely not
seem to be correlated to your missing timeout interrupt right, you don’t
see that log?



One of the logs:

mmcblk1: timed out sending r/w cmd command, card status 0x900

end_request: I/O error, dev mmcblk1, sector 63587

Buffer I/O error on device mmcblk1p2, logical block 15392

lost page write due to I/O error on mmcblk1p2



Ryan




Sent: Monday, September 07, 2015 6:07 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Since we know the cause for the generation of error 145(Waiting for
cmd/data completion interrupt) and error 88 (cmd/data error)

and it is also mentioned in the excel sheet attached to  EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  that these errors are
not fatal, what else do you want me to debug ?

Please suggest.



,
.


Sent: Tuesday, September 01, 2015 7:17 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







·         I have tried the two test cases which you suggested me to try on
griffin B0 , Following are the details



                1st case:

             - MMC0 copies files to or from RAM filesystem

     -THEN “sync” and then do MMC1 copies files to or from RAM filesystem

                                No issue, Works fine.

                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       Works well if the second command is run after some delay (10 sec)
instead of running immediately after first command completes.

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.



                Note: On griffin A1 , above 2 cases works fine.



·         I have been debugging MMC issue on A1 so far. Most of the time
observed timeout issue.

And On B0 I have observed error 88 (cmd or data error) , currently
debugging the same.



,

.




Sent: Saturday, August 29, 2015 6:18 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







So that the MMC operations don’t come into a weird state due to MMC0 and
MMC1 workaround that they cannot make operations (or even register
accesses) at the same time (and yet they somewhat must to provide data
from one to the other), are you able to change the test case so that we
try to avoid MMC0 or MMC1 doing any operations at same time and see if we
can reproduce an issue?



-          MMC0 copies files to or from RAM filesystem

-          THEN “sync” and then do MMC1 copies files to or from RAM
filesystem



If that can’t reproduce an issue, can we at least try not having MMC0 and
MMC1 transfer directly to each other so that they are not dependent on the
data operations occurring from each other?



-          MMC0 copies files to or from RAM filesystem

-          AND MMC1 copies files to or from RAM filesystem




Ryan




Sent: Friday, August 28, 2015 6:47 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0



HI Varun,



First I am mounting two mmc cards then copying 2gb of file with random
data from one mmc to other.

I tried to copy data form mmc1 to mmc2 and also mmc2 to mmc1, Almost every
time I am getting the error.



,

.




Sent: Friday, August 28, 2015 4:39 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0



Hello Praveen,



I am trying to understand the experiment being done here.

You copy data from one mmc to other mmc. Are you mounting both mmc first
and directly copying data from one mmc to other mmc?

Or do you copy the data from one mmc to system and then in second step
copy it to other mmc?



How often you see the failure? Are you always copying from a specific slot
to other slot or you are also doing other way round?





Varun








Sent: Thursday, August 27, 2015 5:50 AM

Khadilkar

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0







Just a clarification on 2nd question.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                This test is done with the workaround only.





Kamlakant Patel




Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0







Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.



Praveen, my interpretation of your results, does your current experiments
seem to suggest that

1.       In a failing case, the MMC controller is not generating a “Data
Transfer Complete” interrupt – and the rest of the operation and commands
up to that point seem fine – Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?



Ryan,



Following are my observations during debugging process.

·         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I’ve increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

·         I’ve extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a “Data Transfer
Complete/Command Complete” interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.



Following is the sequence of mmc operations in working and non-working
case.



Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)



Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)






Ryan






Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0







As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.



1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>

>> JC just started passing this debug to Mayank’s team in QA team to help
to test and address this issue, I’ll provide updates on the plan from
them.



2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank’s team in QA team to help
to test and address this issue, I’ll provide updates on the plan from
them.



3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.




Ryan




Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0



Kaushik,



There are several outstanding Griffin debug items that require your team’s
support.



We have been awaiting a schedule to resolve them for several weeks.



Please review with your team and provide a schedule.



1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)



Shaun




Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi JC



The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

·         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc.

·         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.





,



Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Gaganpreet,



We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time.

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.



It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.



,

JC.




Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Basil had further questions (please see attached). Let us know your take
on this.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0







Please find my reply inline.

Sorry for late reply, I was on leave last week.





Kamlakant Patel




Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Hi JC



NOTES:

·         DCRC error (Error Message – “Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress”) is
non-fatal, hence not of interest.

·         Error Val -145, -88 are non-fatal errors, hence not of interest.



NEXT:

Please

·         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

·         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

·         Explain these two errors observed in the “mmc_error_trace.txt”

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

·         Correlate the time-stamps of “mmc_error_trace.txt” and
“mmc_error.log”.

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.



Thanks

Gaganpreet Singh

Office: 4089194230








Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0



Gaganpreet, Varun,




transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.



And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.





JC.




Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0







Please find the details below.



Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.



f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002



·         Please find the log file with the detailed sequence of
operations, registers, register values and error.

·         Please find state of the machine after the error:



[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================



>3. The patch file shows the synchronization you have added. We are
assuming following for the function “static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)” that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.





Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Do you have any updates to share? Please let us know.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses.



1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?



0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000





2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure – This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.



3. The patch file shows the synchronization you have added. We are
assuming following for the function “static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)” that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.





Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0



Including Paul back into the discussion for assisting.



Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I’m not clear what Kamlakant’s new trace scenario is from and who
will review it next (Varun?).




Ryan




Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



HI all,



Please refer this(attached) file for trace.





Kamlakant Patel




Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.





Kamlakant  Patel




Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Sorry for the delay.



Please find the details below.

1.       (a). Checked the code again and again, couldn’t see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.



2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0



3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].







Kamlakant Patel




Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Just to re-capture what we discussed for individual points:



1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun.

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.





Kamlakant Patel




Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?



1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b].

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

·         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is “mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc” then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to “synchronize” the
operation”, without which failures occur on all other products.
[Kamlakant, Pending]



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.



We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.





Kamlakant Patel




Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.



I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Today’s debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ….

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

…



Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it’s working fine on other boards.





Kamlakant Patel




Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Kamlakant,



Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.



We need solutions to the other failures.



But I am still getting DCRC error on mmc1.

I am still not able to conclude either it’s a Hardware or software issue.
I will continue debugging.



Shaun








Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Did you have to make any changes to the driver to ensure “only one card is
active at a time and there is no interrupt conflicts between both MMCs”?



Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?





Basil




Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.





Varun




Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1.

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.



Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.



Do you see any other failures except DCRC on slot 1? What about Slot 0?





Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it’s a Hardware or software issue.
I will continue debugging.



I have following questions:

·         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.



·         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.





Kamlakant Patel




Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround.

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday.

If you want to refer the run logs for our testing, please refer the
following directories:

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0







Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.



> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.





Kamlakant Patel




Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hi Kamlakant



We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design.

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



Hello Shaun,



Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.



If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.



Apart from simultaneous access to MMC Kamlakant mentions “looks like there
are some more issues with Griffin, we suspect it’s a hardware issue but
couldn’t conclude the actual reason”

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it.

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)





Varun






Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0



+Varun



Varun,



Didn’t you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?



Perhaps we have different definitions of simultaneous?



Kamlakant,



Where are your results posted that point to a h/w problem?



Shaun




Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0



+ Ken, Shaun, Basil



Thanks

Gaganpreet Singh

Office: 4089194230




Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0







We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).



We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it’s a
hardware issue but couldn’t conclude the actual reason.



Please refer following JIRA’s for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180

http://ingjira.sj.broadcom.com/browse/EPSW-2938



Could you please help debug this issue.





Kamlakant Patel


Sent:	Monday, September 21, 2015 2:36 PM


Subject:	status: WW38



 

Working on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue. 

    Debugged the reason for Abort messages when two different files are
transferred to two MMC cards from Ramfs one after the other.
   When driver gets #88 error from MMC device, driver issues a STOP cmd to
the device and gets no response from it. Hence driver assumes that the MMC
card is not present and produces Abort messages.

    

Misc:

      Holiday on 17/Sep,  PTO on 16th and 18th /Sep

 

,




Sent:	Monday, September 14, 2015 5:08 PM

Subject:	Mmc eoor msgs on B0

HI Kamlakant,

 

Following are the error msgs on B0

 

 

dd if=/tmp/ran_2gb_2.txt of=/mnt2/random_2gb.txt

[ 1094.328000] fb3ef714 mmcblk1: error -145 sending stop command, original
cmd response 0x0, card status 0x900

[ 1094.340000] fb414bc1 mmcblk1: error -88 transferring data, sector 3936,
nr 8, cmd response 0x0, card status 0x0

[ 1094.348000] fb43b4b9 mmcblk1: retrying using single block read

[ 1094.416000] fb53da05 mmcblk1: error -145 sending status command,
retrying

[ 1094.424000] mmcblk1: timed out sending r/w cmd command, card status
0x900

[ 1094.812000] mmc1: Got command interrupt 0x00010000 even though no
command operation was in progress.

[ 1094.824000] fbb4dbee mmcblk1: error -145 sending stop command

[ 1094.828000] end_request: I/O error, dev mmcblk1, sector 3940

[ 1094.836000] EXT4-fs error (device mmcblk1): ext4_read_inode_bitmap:175:
comm dd: Cannot read inode bitmap - block_group = 0, inode_bitmap = 492

dd: can't open '/mnt2/random_2gb.txt': Input/output error

(initramfs)ls -lh /mnt2/

drwx------    2 root     root       16.0K Oct 23 13:18 lost+found

 

 

 

dd if=/tmp/ran_2gb_2.txt of=/mnt2/random_2gb.txt

[  847.088000] 14fc5bb2 mmcblk1: error -145 sending stop command, original
cmd response 0x0, card status 0x900

[  847.096000] 14feb08b mmcblk1: error -88 transferring data, sector 3936,
nr 8, cmd response 0x0, card status 0x0

[  847.108000] BPK: return MMC_BLK_DATA_ERR

[  847.112000] 150208e1 mmcblk1: retrying using single block read

[  847.260000] mmc1: Got command interrupt 0x00010000 even though no
command operation was in progress.

[  847.336000] mmc1: Got command interrupt 0x00010000 even though no
command operation was in progress.

[  847.416000] mmc1: Got command interrupt 0x00010000 even though no
command operation was in progress.

[  847.424000] mmc1: Got command interrupt 0x00010000 even though no
command operation was in progress.

[  847.436000] 154f25e6 mmcblk1: error -145 sending stop command

[  847.440000] end_request: I/O error, dev mmcblk1, sector 3936

[  847.444000] EXT4-fs error (device mmcblk1): ext4_read_inode_bitmap:175:
comm dd: Cannot read inode bitmap - block_group = 0, inode_bitmap = 492

dd: can't open '/mnt2/random_2gb.txt': Input/output error

 

 

,



 


Sent:	Monday, September 14, 2015 2:52 PM


Subject:	status: WW37



 

Working on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue. 

      Tried data transfer modes other than ADMA (DMA, PIO) to see if the
transfer is successful, but data failed to transfer in these modes as
well.

      Tried Ryan's suggestion to transfer two different files to two MMC
card from Ramfs but transferring second file to other mmc aborts with DCRC
errors.

      Debugging the causes for Aborts mentioned above.

 

,




Sent:	Monday, September 14, 2015 2:18 PM


Subject:	RE: DOB correction status in PF account.
Attachments:	043721_.PDF



     I have submitted a form to correct my date of birth in my PF account
on Feb-2012, but still it is not reflected.

     Following are the details.

                PF No  BG/BNG/0026430/000/0001767

                Correct DOB : 14-06-1988 (14th JUNE 1988)

    I have submitted all the required documents attested by Employer.
Please resolve the issue.

     Please fins the attached for details. (attached Form-5 and PAN card
copy)

Thank You,

.

 


Sent: Monday, September 14, 2015 10:34 AM

Subject: RE: DOB correction status in PF account.

 

Sir,

 

Please contact K.R.Puram Office as the establishment is dealt by them.
You may send a mail to sro.krpuram@epfindia.gov.in

 

With regards,

 

RO, Bengaluru.

On 09.11.15 05:20 PM, Praveen B <praveenb@broadcom.com> wrote:


HI,

 

Following are the details

PF No  BG/BNG/0026430/000/0001767

Correct DOB : 14-06-1988 (14th JUNE 1988)

 

But in PF account it is showing it as 14th JANUARY 1988

It should be corrected to 14th JUNE 1988

 

Thank You



 


Sent: Friday, September 11, 2015 3:44 PM

Subject: RE: DOB correction status in PF account.

 

Sir,

 

Please mention your PF Code and A/c No. along with correct Date of birth
to verify from the portal.

 

With regards,

 

RO, Bengaluru.


On 09.11.15 03:32 PM, Praveen B <praveenb@broadcom.com> wrote:


HI ,

May I know the status of DOB correction in my PF account.

I have already submitted the necessary documents attested by Employer.

Please let me know the status so that My employer can able to link my PF
account with My UAN number.

Thank You




Sent: Wednesday, August 12, 2015 2:36 PM

Subject: RE: DOB correction status in PF account.

 

HI,

May I know the status of DOB correction in my PF account.

Where can I check to see if my DOB is corrected or not?






Sent: Tuesday, August 04, 2015 12:03 PM

Subject: RE: DOB correction status in PF account.

 



                My Employer has already submitted the attested PAN card
copy.

                Please find the attached document witch has the all
documents submitted by Employer.

                If you need any other documents please let me know I will
submit those.

Thank you.

.


Sent: Tuesday, August 04, 2015 11:33 AM

Subject: Re: DOB correction status in PF account.

 

Sir,

Please submit supporting documents such as Copy of Birth Certificate, SSLC
Marks card etc attested by the Employer to make necessary changes.

With regards,

Regional Office
Bengaluru

On 08.03.15 06:04 PM, Praveen B <praveenb@broadcom.com> wrote:


 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 

-- 
Thanks and  

Regional PF Office 
Bangalore 
PRO: 22279130,

or:      22238033- Extn: 603

-- 
Thanks and  

Regional PF Office 
Bengaluru 

 

-- 
Thanks and  

Regional PF Office 
Bengaluru 

 


Sent:	Friday, September 11, 2015 5:15 PM

Subject:	RE: DOB correction status in PF account.

HI,

 

Following are the details

PF No  BG/BNG/0026430/000/0001767

Correct DOB : 14-06-1988 (14th JUNE 1988)

 

But in PF account it is showing it as 14th JANUARY 1988

It should be corrected to 14th JUNE 1988

 

Thank You



 


Sent: Friday, September 11, 2015 3:44 PM

Subject: RE: DOB correction status in PF account.

 

Sir,

 

Please mention your PF Code and A/c No. along with correct Date of birth
to verify from the portal.

 

With regards,

 

RO, Bengaluru.


On 09.11.15 03:32 PM, Praveen B <praveenb@broadcom.com> wrote:


HI ,

 

May I know the status of DOB correction in my PF account.

I have already submitted the necessary documents attested by Employer.

Please let me know the status so that My employer can able to link my PF
account with My UAN number.

 

Thank You



 


Sent: Wednesday, August 12, 2015 2:36 PM

Subject: RE: DOB correction status in PF account.

 

HI,

 

May I know the status of DOB correction in my PF account.

Where can I check to see if my DOB is corrected or not?

 





 


Sent: Tuesday, August 04, 2015 12:03 PM

Subject: RE: DOB correction status in PF account.

 



                My Employer has already submitted the attested PAN card
copy.

                Please find the attached document witch has the all
documents submitted by Employer.

 

                If you need any other documents please let me know I will
submit those.

 

Thank you.

.


Sent: Tuesday, August 04, 2015 11:33 AM

Subject: Re: DOB correction status in PF account.

 

Sir,

Please submit supporting documents such as Copy of Birth Certificate, SSLC
Marks card etc attested by the Employer to make necessary changes.

With regards,

Regional Office
Bengaluru

On 08.03.15 06:04 PM, Praveen B <praveenb@broadcom.com> wrote:


 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 

-- 
Thanks and  

Regional PF Office 
Bangalore 
PRO: 22279130,

or:      22238033- Extn: 603

-- 
Thanks and  

Regional PF Office 
Bengaluru 

 


Sent:	Friday, September 11, 2015 3:33 PM

Subject:	RE: DOB correction status in PF account.

HI ,

 

May I know the status of DOB correction in my PF account.

I have already submitted the necessary documents attested by Employer.

Please let me know the status so that My employer can able to link my PF
account with My UAN number.

 

Thank You



 


Sent: Wednesday, August 12, 2015 2:36 PM

Subject: RE: DOB correction status in PF account.

 

HI,

 

May I know the status of DOB correction in my PF account.

Where can I check to see if my DOB is corrected or not?

 





 


Sent: Tuesday, August 04, 2015 12:03 PM

Subject: RE: DOB correction status in PF account.

 



                My Employer has already submitted the attested PAN card
copy.

                Please find the attached document witch has the all
documents submitted by Employer.

 

                If you need any other documents please let me know I will
submit those.

 

Thank you.

.


Sent: Tuesday, August 04, 2015 11:33 AM

Subject: Re: DOB correction status in PF account.

 

Sir,

Please submit supporting documents such as Copy of Birth Certificate, SSLC
Marks card etc attested by the Employer to make necessary changes.

With regards,

Regional Office
Bengaluru

On 08.03.15 06:04 PM, Praveen B <praveenb@broadcom.com> wrote:


 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 

-- 
Thanks and  

Regional PF Office 
Bangalore 
PRO: 22279130,

or:      22238033- Extn: 603


Sent:	Monday, September 07, 2015 6:37 PM


Subject:	RE: mmc issue on Griffin B0



 

Since we know the cause for the generation of error 145(Waiting for
cmd/data completion interrupt) and error 88 (cmd/data error)

and it is also mentioned in the excel sheet attached to  EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  that these errors are
not fatal, what else do you want me to debug ?

Please suggest.

 

,
.


Sent: Tuesday, September 01, 2015 7:17 PM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

.         I have tried the two test cases which you suggested me to try on
griffin B0 , Following are the details

 

                1st case:

             - MMC0 copies files to or from RAM filesystem

     -THEN "sync" and then do MMC1 copies files to or from RAM filesystem

                                No issue, Works fine.

                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       Works well if the second command is run after some delay (10 sec)
instead of running immediately after first command completes.

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

 

                Note: On griffin A1 , above 2 cases works fine.

 

.         I have been debugging MMC issue on A1 so far. Most of the time
observed timeout issue.

And On B0 I have observed error 88 (cmd or data error) , currently
debugging the same.

 

,

.

 


Sent: Saturday, August 29, 2015 6:18 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

So that the MMC operations don't come into a weird state due to MMC0 and
MMC1 workaround that they cannot make operations (or even register
accesses) at the same time (and yet they somewhat must to provide data
from one to the other), are you able to change the test case so that we
try to avoid MMC0 or MMC1 doing any operations at same time and see if we
can reproduce an issue?

 

-          MMC0 copies files to or from RAM filesystem

-          THEN "sync" and then do MMC1 copies files to or from RAM
filesystem

 

If that can't reproduce an issue, can we at least try not having MMC0 and
MMC1 transfer directly to each other so that they are not dependent on the
data operations occurring from each other?

 

-          MMC0 copies files to or from RAM filesystem

-          AND MMC1 copies files to or from RAM filesystem

 


Ryan

 


Sent: Friday, August 28, 2015 6:47 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 

HI Varun,

                

First I am mounting two mmc cards then copying 2gb of file with random
data from one mmc to other.

I tried to copy data form mmc1 to mmc2 and also mmc2 to mmc1, Almost every
time I am getting the error.

 

,

.

 


Sent: Friday, August 28, 2015 4:39 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 

Hello Praveen,

 

I am trying to understand the experiment being done here.

You copy data from one mmc to other mmc. Are you mounting both mmc first
and directly copying data from one mmc to other mmc?

Or do you copy the data from one mmc to system and then in second step
copy it to other mmc?

 

How often you see the failure? Are you always copying from a specific slot
to other slot or you are also doing other way round?

 



Varun

 

 

 


Sent: Thursday, August 27, 2015 5:50 AM

Khadilkar

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

Just a clarification on 2nd question.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                This test is done with the workaround only.

 



Kamlakant Patel

 


Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0

 



 

Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.

 

Praveen, my interpretation of your results, does your current experiments
seem to suggest that 

1.       In a failing case, the MMC controller is not generating a "Data
Transfer Complete" interrupt - and the rest of the operation and commands
up to that point seem fine - Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?

 

Ryan,

 

Following are my observations during debugging process.

.         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I've increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

.         I've extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a "Data Transfer
Complete/Command Complete" interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.

 

Following is the sequence of mmc operations in working and non-working
case.

 

Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002 

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)

 

Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)

 

 


Ryan

 

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Monday, September 07, 2015 3:26 PM


Subject:	status: WW36



 

Working on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue. 

Debugging the issues with data transfer from one mmc to the other.

.         Error 88 (Data/Cmd interrupt error)

                Spent some time on debugging the error code.

                Found that this is not a fatal error and can be ignored.

.         Incomplete data transfer with I/O error

                Debugging the same.

 

,




Sent:	Tuesday, September 01, 2015 7:17 PM


Subject:	RE: mmc issue on Griffin B0
Attachments:	mmc_error_88.txt



 

.         I have tried the two test cases which you suggested me to try on
griffin B0 , Following are the details

 

                1st case:

             - MMC0 copies files to or from RAM filesystem

     -THEN "sync" and then do MMC1 copies files to or from RAM filesystem

                                No issue, Works fine.

                2nd case:

               - MMC0 copies files to or from RAM filesystem

       - AND MMC1 copies files to or from RAM filesystem

       Works well if the second command is run after some delay (10 sec)
instead of running immediately after first command completes.

       But, Observed  errors if the second command is issued immediately
after completion of the first command.

      Attached the error log for the same.

 

                Note: On griffin A1 , above 2 cases works fine.

 

.         I have been debugging MMC issue on A1 so far. Most of the time
observed timeout issue.

And On B0 I have observed error 88 (cmd or data error) , currently
debugging the same.

 

,

.

 


Sent: Saturday, August 29, 2015 6:18 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

So that the MMC operations don't come into a weird state due to MMC0 and
MMC1 workaround that they cannot make operations (or even register
accesses) at the same time (and yet they somewhat must to provide data
from one to the other), are you able to change the test case so that we
try to avoid MMC0 or MMC1 doing any operations at same time and see if we
can reproduce an issue?

 

-          MMC0 copies files to or from RAM filesystem

-          THEN "sync" and then do MMC1 copies files to or from RAM
filesystem

 

If that can't reproduce an issue, can we at least try not having MMC0 and
MMC1 transfer directly to each other so that they are not dependent on the
data operations occurring from each other?

 

-          MMC0 copies files to or from RAM filesystem

-          AND MMC1 copies files to or from RAM filesystem

 


Ryan

 


Sent: Friday, August 28, 2015 6:47 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 

HI Varun,

                

First I am mounting two mmc cards then copying 2gb of file with random
data from one mmc to other.

I tried to copy data form mmc1 to mmc2 and also mmc2 to mmc1, Almost every
time I am getting the error.

 

,

.

 


Sent: Friday, August 28, 2015 4:39 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 

Hello Praveen,

 

I am trying to understand the experiment being done here.

You copy data from one mmc to other mmc. Are you mounting both mmc first
and directly copying data from one mmc to other mmc?

Or do you copy the data from one mmc to system and then in second step
copy it to other mmc?

 

How often you see the failure? Are you always copying from a specific slot
to other slot or you are also doing other way round?

 



Varun

 

 

 


Sent: Thursday, August 27, 2015 5:50 AM

Khadilkar

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

Just a clarification on 2nd question.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                This test is done with the workaround only.

 



Kamlakant Patel

 


Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0

 



 

Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.

 

Praveen, my interpretation of your results, does your current experiments
seem to suggest that 

1.       In a failing case, the MMC controller is not generating a "Data
Transfer Complete" interrupt - and the rest of the operation and commands
up to that point seem fine - Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?

 

Ryan,

 

Following are my observations during debugging process.

.         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I've increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

.         I've extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a "Data Transfer
Complete/Command Complete" interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.

 

Following is the sequence of mmc operations in working and non-working
case.

 

Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002 

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)

 

Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)

 

 


Ryan

 

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Tuesday, September 01, 2015 6:01 PM

Subject:	mmc issue:  check this error msg



 

I gave these below commands on B0 board

                (initramfs)cp /mnt1/random_2gb.txt /tmp/

                (initramfs)cp /tmp/random_2gb.txt /mnt2/

                (initramfs)cp /mnt1/ran_1gb_data.txt /tmp/

 

And got the following error. Please check this error msg.

 

[  517.852000] mmc1: Got data interrupt 0x00200000 even though no data
operation was in progress.

[  517.892000] mmc1: Got data interrupt 0x00200000 even though no data
operation was in progress.

[  517.924000] mmc1: Got data interrupt 0x00200000 even though no data
operation was in progress.

[  518.452000] : =========== REGISTER DUMP (mmc1)===========

[  518.452000] : Sys addr: 0x42051200 | Version:  0x00003202

[  518.452000] : Blk size: 0x00007200 | Blk cnt:  0x00000007

[  518.452000] : Argument: 0x000740d0 | Trn mode: 0x00000023

[  518.452000] : Present:  0x1fef0106 | Host ctl: 0x00000013

[  518.452000] : Power:    0x0000000f | Blk gap:  0x00000000

[  518.452000] : Wake-up:  0x00000000 | Clock:    0x00000307

[  518.452000] : Timeout:  0x0000000e | Int stat: 0x00618001

[  518.452000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[  518.452000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[  518.452000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[  518.452000] : Cmd:      0x0000193a | Max curr: 0x00000000

[  518.452000] : Host ctl2: 0x00000000

[  518.452000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x42052008

[  518.452000] : ===========================================

[  518.452000] ------------[ cut here ]------------

[  518.452000] WARNING: at
/projects/magnum/praveenb/sdk-base/buildroot/output/build/linux/drivers/mm
c/host/sdhci.c:1004 sdhci_send_command+0xe0c/0xed8()

[  518.452000] Modules linked in:

[  518.452000] CPU: 0 PID: 54 Comm: mmcqd/1 Not tainted
3.10.59-gcd72428-dirty #132

[  518.452000] Stack : ffffffffc2ee9d78 ffffffffc0132900 0000000000000001
0000000000000004

                  0000000000000044 ffffffffc2ee0000 ffffffffc0a20000
0000000000000001

                  0000000000000004 0000000000000000 0000000000000000
ffffffffc2f035fa

                  0000000000000006 ffffffffc01330c8 0000000000000000
0000000000000000

                  0000000000000000 ffffffffc2ee0000 ffffffffc0904370
ffffffffc0a21217

                  00000000000003ec ffffffffc096cfe8 000000000000193a
0000000000000010

                  0000000000000000 ffffffffc09d1e00 000000000000001d
ffffffffc076219c

                  c0000008081df718 c0000008081df610 000000000000001d
ffffffffc0130468

                  c00000080ff56040 ffffffffc0904370 0000000000000000
0000000000000036

                  000000080ff56040 ffffffffc010b130 0000000000000000
0000000000000000

                  ...

[  518.452000] Call Trace:

[  518.452000] [<ffffffffc010b130>] show_stack+0x68/0x80

[  518.452000] [<ffffffffc0130468>] warn_slowpath_common+0x78/0xa8

[  518.452000] [<ffffffffc0674034>] sdhci_send_command+0xe0c/0xed8

[  518.452000] [<ffffffffc0674b08>] sdhci_finish_data+0xe8/0x418

[  518.452000] [<ffffffffc0675d48>] sdhci_irq+0x908/0x1168

[  518.452000] [<ffffffffc019f264>] handle_irq_event_percpu+0x8c/0x310

[  518.452000] [<ffffffffc019f538>] handle_irq_event+0x50/0x88

[  518.452000] [<ffffffffc01a2b7c>] handle_level_irq+0xd4/0x150

[  518.452000] [<ffffffffc019e850>] generic_handle_irq+0x38/0x58

[  518.452000] [<ffffffffc0108338>] do_IRQ+0x18/0x30

[  518.452000] [<ffffffffc010646c>] ret_from_irq+0x0/0x4

[  518.452000] [<ffffffffc044d62c>] blk_update_request+0x3d4/0x520

[  518.452000] [<ffffffffc044ebe0>] blk_update_bidi_request+0x20/0xa8

[  518.452000] [<ffffffffc044fcd4>] blk_end_bidi_request+0x24/0x90

[  518.452000] [<ffffffffc066f32c>] mmc_blk_issue_rw_rq+0x82c/0xb48

[  518.452000] [<ffffffffc066f85c>] mmc_blk_issue_rq+0x214/0x570

[  518.452000] [<ffffffffc0670f78>] mmc_queue_thread+0xc0/0x190

[  518.452000] [<ffffffffc01576b0>] kthread+0xb8/0xc0

[  518.452000] [<ffffffffc01064b0>] ret_from_kernel_thread+0x10/0x18

[  518.452000] 

[  518.452000] ---[ end trace deda5264e0faea89 ]---

[  518.452000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  518.776000] mmcblk1: error -88 transferring data, sector 475344, nr 8,
cmd response 0x0, card status 0xc00

[  518.788000] mmc1: Got data interrupt 0x00200000 even though no data
operation was in progress.

[  518.796000] end_request: I/O error, dev mmcblk1, sector 475344

[  518.800000] Buffer I/O error on device mmcblk1, logical block 59418

[  518.808000] lost page write due to I/O error on mmcblk1

[  530.892000] mmc1: Got data interrupt 0x00100000 even though no data
operation was in progress.

[  534.880000] mmc1: Timeout waiting for hardware interrupt.

[  534.912000] mmcblk1: error -145 sending stop command, original cmd
response 0x920, card status 0xe00

[  535.116000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.164000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.360000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.396000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.460000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.524000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.640000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.672000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.708000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.772000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.836000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.868000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.892000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.912000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.924000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  535.984000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  536.020000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  536.084000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  536.116000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  536.128000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  536.164000] mmc1: Got data interrupt 0x00600000 even though no data
operation was in progress.

[  536.252000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.260000] FAT-fs (mmcblk0p2): Filesystem has been set read-only

[  536.264000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.272000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.284000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.292000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.300000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.308000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.316000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.324000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.332000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.340000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.348000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.356000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.364000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.372000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.380000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.388000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.400000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.408000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.416000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.424000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.432000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.440000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.448000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.456000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.464000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.472000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.480000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.488000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.496000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.504000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.512000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.524000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.532000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.540000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.548000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.556000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.564000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.572000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.580000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.588000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.596000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.604000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.612000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.620000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.628000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.640000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.648000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.656000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.664000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.672000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.680000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.688000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.696000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.704000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.712000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.720000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.728000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.736000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.748000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.756000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.764000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.772000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.780000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.788000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.796000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.804000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.812000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.820000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.828000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.836000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.844000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.852000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.864000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.872000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.880000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.888000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.896000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.904000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.912000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.920000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.928000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.936000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.944000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.952000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.960000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.968000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.976000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.988000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  536.996000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.004000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.012000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.020000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.028000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.036000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.044000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.052000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.060000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.068000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.076000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.084000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.092000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.104000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.112000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.120000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.128000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.136000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.144000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.152000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.160000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.168000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.176000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.184000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.192000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.200000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.208000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.216000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.228000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.236000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.244000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.252000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.260000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.268000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.276000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.284000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.292000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.300000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.308000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.316000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.324000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.332000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.344000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.352000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.360000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.368000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.376000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.384000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.392000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.400000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.408000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.416000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.424000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.432000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.440000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.448000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.456000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.468000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.476000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.484000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.492000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.500000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.508000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.516000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.524000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.532000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.540000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.548000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.556000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.564000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.572000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.584000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.592000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.600000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.608000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.616000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.624000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.632000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.640000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.648000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.656000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.664000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.672000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.680000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.688000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.700000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.708000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.716000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.724000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.732000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.740000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.748000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.756000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.764000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.772000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.780000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.788000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.796000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.804000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.812000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.824000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.832000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.840000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.848000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.856000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.864000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.872000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.880000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.888000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.896000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.904000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.912000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.920000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.928000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.940000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.948000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.956000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.964000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.972000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.980000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.988000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  537.996000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.004000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.012000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.020000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.028000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.036000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.044000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.052000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.064000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.072000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.080000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.088000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.096000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.104000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.112000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.120000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.128000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.136000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.144000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.152000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.160000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.168000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.180000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.188000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.196000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.204000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.212000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.220000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.228000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.236000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.244000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.252000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.260000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.268000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.276000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.284000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.292000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.304000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.312000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.320000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.328000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.336000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.344000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.352000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.360000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.368000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.376000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.384000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.392000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.400000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.408000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.420000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.428000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.436000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.444000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.452000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.460000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.468000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.476000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.484000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.492000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.500000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.508000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.516000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.524000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.536000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.544000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.552000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.560000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.568000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.576000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.584000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.592000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.600000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.608000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.616000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.624000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.632000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.640000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.648000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.660000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.668000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.676000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.684000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.692000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.700000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.708000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.716000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.724000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.732000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.740000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.748000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.756000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.764000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.776000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.784000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.792000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.800000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.808000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.816000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.824000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.832000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.840000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.848000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.856000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.864000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.872000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.880000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.892000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.900000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.908000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.916000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.924000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.932000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.940000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.948000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.956000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.964000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.972000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.980000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.988000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  538.996000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.004000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.016000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.024000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.032000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.040000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.048000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.056000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.064000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.072000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.080000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.088000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.096000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.104000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.112000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.120000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.132000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.140000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.148000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.156000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.164000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.172000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.180000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.188000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.196000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.204000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.212000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.220000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.228000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.236000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.248000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.256000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.264000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.272000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.280000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.288000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.296000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.304000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.312000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

[  539.320000] FAT-fs (mmcblk0p2): error, fat_bmap_cluster: request beyond
EOF (i_pos 243983)

cp: read error: Input/output error

 

,



 


Sent:	Monday, August 31, 2015 2:33 PM


Subject:	status: WW35



 

Working on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue. 

      Added debug information to trace the bug.

      Debugged the timeout issue.

      Driver is waiting for a data completion interrupt, failed to get
some times and prints timeout error. suspecting a hardware issue here.

      Verified that there is no data corruption even though there are
timeout errors.                

 

,




Sent:	Friday, August 28, 2015 7:17 PM


Subject:	RE: mmc issue on Griffin B0

HI Varun,

                

First I am mounting two mmc cards then copying 2gb of file with random
data from one mmc to other.

I tried to copy data form mmc1 to mmc2 and also mmc2 to mmc1, Almost every
time I am getting the error.

 

,

.

 


Sent: Friday, August 28, 2015 4:39 AM

Varghese

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 

Hello Praveen,

 

I am trying to understand the experiment being done here.

You copy data from one mmc to other mmc. Are you mounting both mmc first
and directly copying data from one mmc to other mmc?

Or do you copy the data from one mmc to system and then in second step
copy it to other mmc?

 

How often you see the failure? Are you always copying from a specific slot
to other slot or you are also doing other way round?

 



Varun

 

 

 


Sent: Thursday, August 27, 2015 5:50 AM

Khadilkar

(Sivaprasad) Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

Just a clarification on 2nd question.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                This test is done with the workaround only.

 



Kamlakant Patel

 


Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0

 



 

Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.

 

Praveen, my interpretation of your results, does your current experiments
seem to suggest that 

1.       In a failing case, the MMC controller is not generating a "Data
Transfer Complete" interrupt - and the rest of the operation and commands
up to that point seem fine - Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?

 

Ryan,

 

Following are my observations during debugging process.

.         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I've increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

.         I've extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a "Data Transfer
Complete/Command Complete" interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.

 

Following is the sequence of mmc operations in working and non-working
case.

 

Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002 

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)

 

Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)

 

 


Ryan

 

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Thursday, August 27, 2015 5:56 PM


Subject:	RE: mmc issue on Griffin B0
Attachments:	full_error145_log.txt

+Siva

 



 

Please see my comments inline.

1.       In a failing case, the MMC controller is not generating a "Data
Transfer Complete" interrupt - and the rest of the operation and commands
up to that point seem fine - Suggesting a hardware issue here?

                Yes, Suspecting a hardware issue here.

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

                Yes,.

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?

                Yes. Driver is taking care of that.

 

        One observation is that

                Even though there are timeout errors for some missing
"Data Transfer Complete" interrupts, the transferred data is valid and I
verified it using md5sum tool.

        Attached the log file of a 2GB data transfer from mmc1 to mmc2.

                

,



 


Sent: Thursday, August 27, 2015 7:28 AM


Shaun Kittle
Subject: RE: mmc issue on Griffin B0

 



 

Looping you in for next steps and details with more data on the debugging
that Praveen has captured for the dual MMC issues on Griffin.  Please let
us know if any comments on the data or questions.

 

Praveen, my interpretation of your results, does your current experiments
seem to suggest that 

1.       In a failing case, the MMC controller is not generating a "Data
Transfer Complete" interrupt - and the rest of the operation and commands
up to that point seem fine - Suggesting a hardware issue here?

2.       No issues observed with the workaround implemented in our SDHCI
driver for keeping MMC 0 and 1 separate?

3.       In the case where the Linux timeout interrupt is triggered after
10s, does the MMC device restart appropriately and continue operation
after that?

 

Ryan,

 

Following are my observations during debugging process.

.         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I've increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

.         I've extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a "Data Transfer
Complete/Command Complete" interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.

 

Following is the sequence of mmc operations in working and non-working
case.

 

Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002 

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)

 

Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)

 

 


Ryan

 

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Tuesday, August 25, 2015 9:22 PM


Subject:	RE: mmc issue on Griffin B0
Attachments:	mmc_full_log.txt; mmc_non_working_seq.txt; mmc_working_seq.txt

+Kamlakant

 



 

Following are my observations during debugging process.

.         During data transfer from one mmc to another mmc, for each block
of data transfer, driver(CPU) expects a Data Transfer Complete/Command
Complete interrupt and fails to get some times.

In the current code, Driver waits for 10s and prints out a timeout error.
I've increased the timeout from 10sec to 100sec to see if an interrupt is
really generated by the controller and found that no interrupt is being
generated.

.         I've extracted the sequence of MMC operations in working and
non-working case.

All the MMC operations are almost identical in working and non-working
case except that in non-working case, driver waits for a "Data Transfer
Complete/Command Complete" interrupt and gives timeout error.

Please find the attached complete log of mmc operations in working and
non-working case.

 

Following is the sequence of mmc operations in working and non-working
case.

 

Working case :

75dabe31            sdhci_read         mmc0     0            0
0x30      0x00000000

75dabe37            sdhci_irq             mmc0     0            0
0xfe      0x000000fe (Interrupt Processes)

75db15b7            sdhci_irq             mmc0     0            0
0xff       0x000000ff  (got Data Transfer Complete interrupt)

75db15c2             sdhci_read         mmc0     0            0
0x30      0x00000002 

75db15c7             sdhci_write       mmc0     0            0
0x30      0x00000002

75db15f0             sdhci_read         mmc0     0            0
0x30      0x00000000

75db15f6             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt Processes)

75db160d            sdhci_finish       mmc0     0            0
0xff       0x000000ff  (cmd finished)

 

Non-working case :

a9787e07             sdhci_read         mmc0     0            0
0x30      0x00000000

a9787e0d             sdhci_irq             mmc0     0            0
0xfe      0x000000fe (interrupt processed)

b2cc8e4a             sdhci_timeout  mmc0     7            145        0xff
0x000000ff  (got Timeout error)

 

 

,

.

 

 


Sent: Tuesday, August 25, 2015 12:10 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 

Thanks for the highlight last week Praveen.

 

I updated the team that we expect updates by mid of next week.  If there
are any updates on your progress on these fronts please let me know this
week, any incremental update would be very helpful.

 


Ryan

 


Sent: Wednesday, August 19, 2015 6:19 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 

HI Ryan,

 

I am currently understanding the code flow and registers.

I have discussed this issue with Kamlakant and I am planning to work on #a
(Highlighted in your below email)

Please consider Estimated time to be two weeks . I will try to update on
this  ASAP.

 



.

 


Sent: Wednesday, August 19, 2015 3:57 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

Thanks for the highlight.  I am needing to give some updates to Shaun's
team (Gaganpreet) about the progress and steps we are taking on this, and
it is a bit timely to ensure we understand this issue for the risk of a
similar issue in the Vulcan implementation which uses the same MMC IP.  Do
you believe those are appropriate next steps that we are taking to debug
the issue?

 

If you could provide me highlights of what the next steps you intend to
take and any ETA's of them would be appreciated, thanks!

 

This was my previous highlight of the issue and the "Next Steps" that
Shaun's team had proposed, 

 

.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

-          Shaun's team posted bug to EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938> 

-          Griffin will sometimes encounter driver crash logged (and
driver may recover)

-          Issue requires deep knowledge of MMC device driver in Linux and
usage of tracing/debug

-          Issue is still under investigation without root cause as yet

-          Kamlakant had captured MMC traces and showcased MMC operation

o   Suspected that there are still some hardware issues occurring with the
MMC controller due to errors captured (even though driver recovers)

-          Purpose: Determining if there is a potential hardware issue in
Griffin which may also exist in Vulcan MMC controller implementation (has
not changed)

-          Next steps requested by Shaun's team: 

a)      Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

b)      If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 


Ryan

 


Sent: Tuesday, August 18, 2015 5:10 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 

+ Siva

 



 

I am able to reproduce the MMC issue. Currently, I am trying to understand
the mmc driver.

I will let you know if there is any progress.

 





 


Sent: Tuesday, August 18, 2015 5:28 AM


Subject: FW: mmc issue on Griffin B0

 



 

Is there any updates you can provide on the issue #2 (EPSW-2938) MMC issue
debug?  Please provide any highlights of our progress of reproducing the
issue and debugging steps or ETA's of the next step for the debug.

 



Ryan

 


Sent: Monday, August 17, 2015 2:05 PM

Subject: RE: mmc issue on Griffin B0

 

Hey Ryan

 

Any news on these issues 1 and 2?

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Monday, August 24, 2015 3:01 PM


Subject:	status: WW34



 

       Working on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue. 

                Looked into the MMC driver code

                Added debug information to trace the bug.

                

 

,



 

 


Sent:	Wednesday, August 19, 2015 6:49 PM


Subject:	RE: mmc issue on Griffin B0

HI Ryan,

 

I am currently understanding the code flow and registers.

I have discussed this issue with Kamlakant and I am planning to work on #a
(Highlighted in your below email)

Please consider Estimated time to be two weeks . I will try to update on
this  ASAP.

 



.

 


Sent: Wednesday, August 19, 2015 3:57 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

Thanks for the highlight.  I am needing to give some updates to Shaun's
team (Gaganpreet) about the progress and steps we are taking on this, and
it is a bit timely to ensure we understand this issue for the risk of a
similar issue in the Vulcan implementation which uses the same MMC IP.  Do
you believe those are appropriate next steps that we are taking to debug
the issue?

 

If you could provide me highlights of what the next steps you intend to
take and any ETA's of them would be appreciated, thanks!

 

This was my previous highlight of the issue and the "Next Steps" that
Shaun's team had proposed, 

 

.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

-          Shaun's team posted bug to EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938> 

-          Griffin will sometimes encounter driver crash logged (and
driver may recover)

-          Issue requires deep knowledge of MMC device driver in Linux and
usage of tracing/debug

-          Issue is still under investigation without root cause as yet

-          Kamlakant had captured MMC traces and showcased MMC operation

o   Suspected that there are still some hardware issues occurring with the
MMC controller due to errors captured (even though driver recovers)

-          Purpose: Determining if there is a potential hardware issue in
Griffin which may also exist in Vulcan MMC controller implementation (has
not changed)

-          Next steps requested by Shaun's team: 

a)      Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

b)      If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 


Ryan

 


Sent: Tuesday, August 18, 2015 5:10 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 

+ Siva

 



 

I am able to reproduce the MMC issue. Currently, I am trying to understand
the mmc driver.

I will let you know if there is any progress.

 





 


Sent: Tuesday, August 18, 2015 5:28 AM


Subject: FW: mmc issue on Griffin B0

 



 

Is there any updates you can provide on the issue #2 (EPSW-2938) MMC issue
debug?  Please provide any highlights of our progress of reproducing the
issue and debugging steps or ETA's of the next step for the debug.

 



Ryan

 


Sent: Monday, August 17, 2015 2:05 PM

Subject: RE: mmc issue on Griffin B0

 

Hey Ryan

 

Any news on these issues 1 and 2?

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Wednesday, August 19, 2015 10:03 AM

Subject:	FW: mmc issue on Griffin B0



 

Please check the below Highlighted next steps and suggest me whether to
follow or not ?  

 





 


Sent: Wednesday, August 19, 2015 3:57 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 



 

Thanks for the highlight.  I am needing to give some updates to Shaun's
team (Gaganpreet) about the progress and steps we are taking on this, and
it is a bit timely to ensure we understand this issue for the risk of a
similar issue in the Vulcan implementation which uses the same MMC IP.  Do
you believe those are appropriate next steps that we are taking to debug
the issue?

 

If you could provide me highlights of what the next steps you intend to
take and any ETA's of them would be appreciated, thanks!

 

This was my previous highlight of the issue and the "Next Steps" that
Shaun's team had proposed, 

 

.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

-          Shaun's team posted bug to EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938> 

-          Griffin will sometimes encounter driver crash logged (and
driver may recover)

-          Issue requires deep knowledge of MMC device driver in Linux and
usage of tracing/debug

-          Issue is still under investigation without root cause as yet

-          Kamlakant had captured MMC traces and showcased MMC operation

o   Suspected that there are still some hardware issues occurring with the
MMC controller due to errors captured (even though driver recovers)

-          Purpose: Determining if there is a potential hardware issue in
Griffin which may also exist in Vulcan MMC controller implementation (has
not changed)

-          Next steps requested by Shaun's team: 

a)      Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

b)      If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 


Ryan

 


Sent: Tuesday, August 18, 2015 5:10 AM


Pochiraju
Subject: RE: mmc issue on Griffin B0

 

+ Siva

 



 

I am able to reproduce the MMC issue. Currently, I am trying to understand
the mmc driver.

I will let you know if there is any progress.

 





 


Sent: Tuesday, August 18, 2015 5:28 AM


Subject: FW: mmc issue on Griffin B0

 



 

Is there any updates you can provide on the issue #2 (EPSW-2938) MMC issue
debug?  Please provide any highlights of our progress of reproducing the
issue and debugging steps or ETA's of the next step for the debug.

 



Ryan

 


Sent: Monday, August 17, 2015 2:05 PM

Subject: RE: mmc issue on Griffin B0

 

Hey Ryan

 

Any news on these issues 1 and 2?

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Tuesday, August 18, 2015 5:40 PM


Subject:	RE: mmc issue on Griffin B0

+ Siva

 



 

I am able to reproduce the MMC issue. Currently, I am trying to understand
the mmc driver.

I will let you know if there is any progress.

 





 


Sent: Tuesday, August 18, 2015 5:28 AM


Subject: FW: mmc issue on Griffin B0

 



 

Is there any updates you can provide on the issue #2 (EPSW-2938) MMC issue
debug?  Please provide any highlights of our progress of reproducing the
issue and debugging steps or ETA's of the next step for the debug.

 



Ryan

 


Sent: Monday, August 17, 2015 2:05 PM

Subject: RE: mmc issue on Griffin B0

 

Hey Ryan

 

Any news on these issues 1 and 2?

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, August 10, 2015 11:59 AM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Basil Varghese;
Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam Naghshineh; Mayank Vaish;
Vinod Mopuri
Subject: RE: mmc issue on Griffin B0

 



 

As we discussed in our Friday weekly meeting, there are actions in
progress on each of these issues.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX -> posted to bug at EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification -> posted bug at EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938>  and the email thread
discussion ongoing below

>> JC just started passing this debug to Mayank's team in QA team to help
to test and address this issue, I'll provide updates on the plan from
them.

 

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

>> Vinod on my team has been working with Sam on this debug and assisting
with the updates.  He has released a new version of the power management
code that has been tested on the 964 and should be working on that board.
We also need Ops to fuse a new 12 or 8 core (748 or 948, 732 or 932) part
for seeing if other core count devices are supported.

 


Ryan

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Monday, August 17, 2015 2:06 PM


Subject:	status: WW33



 

       Graph500:    

                Worked on identifying core code in benchmark for the
compute kernel.

 

       Working on  <http://engjira.sj.broadcom.com/browse/SIISSUES-180>
SIISSUES-180 - MMC Driver issue.             

 

,



 

 


Sent:	Monday, August 17, 2015 10:11 AM

Subject:	RE: Weekly Status report for Week-33

Still you are sending your status to Anurag ?

 


Sent: Sunday, August 16, 2015 3:22 PM


Praveen B; Saswat Dash; Sreenidhi Bharathkar Ramesh; Mahendra Ladhe;
Virendra Pathak
Subject: Weekly Status report for Week-33

 



 

Achievements

.         Read about HDF5 (Hierarchical Data Format) library.

.         Compiled and ran single threaded tests on x86 machine and on
Juno board.

 

Issues:

.         Parallel tests are failing.

 

Next steps:

.         Run parallel tests on x86 and Juno.

.         Look for possibility of optimization.

 



Siva Krishna.


Sent:	Thursday, August 13, 2015 10:31 AM

Subject:	FW: mmc issue on Griffin B0

FYI .

 


Sent: Thursday, August 13, 2015 9:25 AM

Subject: FW: mmc issue on Griffin B0

 

 

 


Sent: 13 August 2015 01:42


Subject: RE: mmc issue on Griffin B0

 

Thanks Ryan. Let's kick this off. JC, please remain is available for
consultation if need be.

 

I am curious - Mayank - in terms of capabilities - you seem to have
team-members with development or SE background ? (White-box testing vs.
software engineering) - please confirm.

 

Best,

-Kaushik

 

 

 


Sent: Wednesday, August 12, 2015 12:59 PM


Subject: RE: mmc issue on Griffin B0

 



 

I had a call with JC and Mayank on the addressing of issue #1 and #2 last
night (as previously discussed, Vinod on my team is in progress on #3
already in conjunction with Sam's team). 

 

JC and Mayank (and I after discussion with them) are comfortable that the
engineers we are putting on point for the debug, while not our primary
development team, will be able to make progress on the issues after they
come up to speed with the assistance of JC's team.  Also for the fact that
these engineers are co-located with JC's development team they will have
an easier time for support/coming up to speed on the debug taken so far
with assistance of JC's team.

 

Since they are new to the issues I don't have an ETA so far to provide to
Shaun but I will keep in the loop with Mayank and his team on the progress
and milestones we can provide to Shaun.

 

Here was JC's update below:

 

We have identified two engineers for working on these:

 

Praveen kumar <praveenb@broadcom.com>  of Siva's team will work on the MMC
issue, he has some background in development and Kamlakant will be able to
help him with the setup and the debugging code he already added to
replicate the issue here.

 

AJAY CHAUDHARY <ajay.chaudhary@broadcom.com> - of Mayank's team will work
on i2c, the JIRA already has the workaround needed, so we will try the
workaround and also review the driver to see if we have missed anything
else.

 

Please let me know if any questions.

 



Ryan

 


Sent: Tuesday, August 11, 2015 6:23 PM


Subject: RE: mmc issue on Griffin B0

 

Sure thing Kaushik, I set up a meeting to call JC/Mayank tonight and get
in sync on this.



Ryan

 


Sent: Tuesday, August 11, 2015 2:31 PM


Subject: RE: mmc issue on Griffin B0

 

JC/Ryan/Mayank:

 

Please collaborate on 1,2 and provide an update on ETA to me and Shaun.

 

Best.

-Kaushik

 


Sent: Tuesday, August 11, 2015 2:27 PM


Subject: RE: mmc issue on Griffin B0

 

JC:

 

I thought Mayank manages QA effort - how's that going to help #1 and #2 as
both seem development issues.

Please work with Shaun and provide me an update.

 

Best.

-Kaushik

 


Sent: Friday, August 07, 2015 3:19 AM


Subject: RE: mmc issue on Griffin B0

 

I am working with Mayank on items  1 and 2. Mayank will talk to the
engineers in his team who are free. If it works out we can handle these
items from here.

 

JC.

 


Sent: Thursday, August 06, 2015 7:38 AM

Subject: RE: mmc issue on Griffin B0

 

Thanks.

 

-Kaushik

 


Sent: Wednesday, August 05, 2015 7:01 PM

Subject: RE: mmc issue on Griffin B0

 

Will inform Shaun after JC and I are in sync.

 


Sent: Wednesday, August 05, 2015 5:59 PM

Subject: RE: mmc issue on Griffin B0

 

Thanks Ryan - appreciate it.

 

Once scrubbed - please inform Shaun about it.

 

Best.

-Kaushik

 


Sent: Wednesday, August 05, 2015 5:57 PM

Subject: RE: mmc issue on Griffin B0

 



 

Got it.  My team is already assisting with the #3 ticket.

 

JC, 

 

This is my understanding of the below tickets, can you confirm what help
my team can provide for these?

 

1.        SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read
issue in LINUX

-          Shaun's team posted bug to EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

-          Seems like the issue is root-caused to an issue with MAX6653
A2D device using for thermal diode reading, and a proposal for changes
provided by Operations team

-          Fix will need an update to MAX6653 Linux driver to latest SDK
base

o   Do you want my team to look into the proposed updates to MAX6653
device and propose a patch for Linux driver to you?

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

-          Shaun's team posted bug to EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938> 

-          Griffin will sometimes encounter driver crash logged (and
driver may recover)

-          Issue requires deep knowledge of MMC device driver in Linux and
usage of tracing/debug

-          Issue is still under investigation without root cause as yet

-          Kamlakant had captured MMC traces and showcased MMC operation

o   Suspected that there are still some hardware issues occurring with the
MMC controller due to errors captured (even though driver recovers)

-          Purpose: Determining if there is a potential hardware issue in
Griffin which may also exist in Vulcan MMC controller implementation (has
not changed)

-          Next steps requested by Shaun's team: 

a)      Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

b)      If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

-          This will require a decent effort by a member of my team to
come up to speed on the MMC experiments and captures Kamlakant has
observed so far, but it can be done

-          Do you want my team to work with Kamlakant and Gaganpreet to be
able to reproduce the issue, how to capture the debug traces and take on
next steps proposed by Shaun's team?

 



Ryan

 


Sent: Wednesday, August 05, 2015 5:43 PM

Subject: RE: mmc issue on Griffin B0

 

Please ACK that you have seen this message.

 

Best.

-Kaushik

 


Sent: Wednesday, August 05, 2015 11:25 AM

Subject: FW: mmc issue on Griffin B0
Importance: High

 

FYI -

 

Please collaborate and get back to me on  current status.

 

JC, I know you have lot of things on your plate - please enable Ryan's
team to get this resolved.

 

Best.

-Kaushik

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Thursday, August 13, 2015 10:31 AM

Subject:	FW: mmc issue on Griffin B0

FYI .

 


Sent: Thursday, August 13, 2015 9:25 AM

Subject: FW: mmc issue on Griffin B0

 

 

 


Sent: 13 August 2015 01:42


Subject: RE: mmc issue on Griffin B0

 

Thanks Ryan. Let's kick this off. JC, please remain is available for
consultation if need be.

 

I am curious - Mayank - in terms of capabilities - you seem to have
team-members with development or SE background ? (White-box testing vs.
software engineering) - please confirm.

 

Best,

-Kaushik

 

 

 


Sent: Wednesday, August 12, 2015 12:59 PM


Subject: RE: mmc issue on Griffin B0

 



 

I had a call with JC and Mayank on the addressing of issue #1 and #2 last
night (as previously discussed, Vinod on my team is in progress on #3
already in conjunction with Sam's team). 

 

JC and Mayank (and I after discussion with them) are comfortable that the
engineers we are putting on point for the debug, while not our primary
development team, will be able to make progress on the issues after they
come up to speed with the assistance of JC's team.  Also for the fact that
these engineers are co-located with JC's development team they will have
an easier time for support/coming up to speed on the debug taken so far
with assistance of JC's team.

 

Since they are new to the issues I don't have an ETA so far to provide to
Shaun but I will keep in the loop with Mayank and his team on the progress
and milestones we can provide to Shaun.

 

Here was JC's update below:

 

We have identified two engineers for working on these:

 

Praveen kumar <praveenb@broadcom.com>  of Siva's team will work on the MMC
issue, he has some background in development and Kamlakant will be able to
help him with the setup and the debugging code he already added to
replicate the issue here.

 

AJAY CHAUDHARY <ajay.chaudhary@broadcom.com> - of Mayank's team will work
on i2c, the JIRA already has the workaround needed, so we will try the
workaround and also review the driver to see if we have missed anything
else.

 

Please let me know if any questions.

 



Ryan

 


Sent: Tuesday, August 11, 2015 6:23 PM


Subject: RE: mmc issue on Griffin B0

 

Sure thing Kaushik, I set up a meeting to call JC/Mayank tonight and get
in sync on this.



Ryan

 


Sent: Tuesday, August 11, 2015 2:31 PM


Subject: RE: mmc issue on Griffin B0

 

JC/Ryan/Mayank:

 

Please collaborate on 1,2 and provide an update on ETA to me and Shaun.

 

Best.

-Kaushik

 


Sent: Tuesday, August 11, 2015 2:27 PM


Subject: RE: mmc issue on Griffin B0

 

JC:

 

I thought Mayank manages QA effort - how's that going to help #1 and #2 as
both seem development issues.

Please work with Shaun and provide me an update.

 

Best.

-Kaushik

 


Sent: Friday, August 07, 2015 3:19 AM


Subject: RE: mmc issue on Griffin B0

 

I am working with Mayank on items  1 and 2. Mayank will talk to the
engineers in his team who are free. If it works out we can handle these
items from here.

 

JC.

 


Sent: Thursday, August 06, 2015 7:38 AM

Subject: RE: mmc issue on Griffin B0

 

Thanks.

 

-Kaushik

 


Sent: Wednesday, August 05, 2015 7:01 PM

Subject: RE: mmc issue on Griffin B0

 

Will inform Shaun after JC and I are in sync.

 


Sent: Wednesday, August 05, 2015 5:59 PM

Subject: RE: mmc issue on Griffin B0

 

Thanks Ryan - appreciate it.

 

Once scrubbed - please inform Shaun about it.

 

Best.

-Kaushik

 


Sent: Wednesday, August 05, 2015 5:57 PM

Subject: RE: mmc issue on Griffin B0

 



 

Got it.  My team is already assisting with the #3 ticket.

 

JC, 

 

This is my understanding of the below tickets, can you confirm what help
my team can provide for these?

 

1.        SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read
issue in LINUX

-          Shaun's team posted bug to EPSW-3003
<http://engjira.sj.broadcom.com/browse/EPSW-3003>  

-          Seems like the issue is root-caused to an issue with MAX6653
A2D device using for thermal diode reading, and a proposal for changes
provided by Operations team

-          Fix will need an update to MAX6653 Linux driver to latest SDK
base

o   Do you want my team to look into the proposed updates to MAX6653
device and propose a patch for Linux driver to you?

 

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

-          Shaun's team posted bug to EPSW-2938
<http://ingjira.sj.broadcom.com/browse/EPSW-2938> 

-          Griffin will sometimes encounter driver crash logged (and
driver may recover)

-          Issue requires deep knowledge of MMC device driver in Linux and
usage of tracing/debug

-          Issue is still under investigation without root cause as yet

-          Kamlakant had captured MMC traces and showcased MMC operation

o   Suspected that there are still some hardware issues occurring with the
MMC controller due to errors captured (even though driver recovers)

-          Purpose: Determining if there is a potential hardware issue in
Griffin which may also exist in Vulcan MMC controller implementation (has
not changed)

-          Next steps requested by Shaun's team: 

a)      Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

b)      If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

-          This will require a decent effort by a member of my team to
come up to speed on the MMC experiments and captures Kamlakant has
observed so far, but it can be done

-          Do you want my team to work with Kamlakant and Gaganpreet to be
able to reproduce the issue, how to capture the debug traces and take on
next steps proposed by Shaun's team?

 



Ryan

 


Sent: Wednesday, August 05, 2015 5:43 PM

Subject: RE: mmc issue on Griffin B0

 

Please ACK that you have seen this message.

 

Best.

-Kaushik

 


Sent: Wednesday, August 05, 2015 11:25 AM

Subject: FW: mmc issue on Griffin B0
Importance: High

 

FYI -

 

Please collaborate and get back to me on  current status.

 

JC, I know you have lot of things on your plate - please enable Ryan's
team to get this resolved.

 

Best.

-Kaushik

 


Sent: Monday, August 03, 2015 5:23 PM


Singh; Jayachandran Chandrashekaran Nair; Kamlakant Patel; Ryan Emmett;
Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim; Sam
Naghshineh
Subject: RE: mmc issue on Griffin B0

 

Kaushik,

 

There are several outstanding Griffin debug items that require your team's
support.

 

We have been awaiting a schedule to resolve them for several weeks.

 

Please review with your team and provide a schedule.

 

1.     SIISSUES-192 - Griffin B0 SLT: Thermal Diode temperature read issue
in LINUX

2.     <http://engjira.sj.broadcom.com/browse/SIISSUES-180> SIISSUES-180 -
MMC Driver Modification

3.    <http://ingjira.sj.broadcom.com/browse/EPSW-3008> EPSW-3008 - Power
Management Crash with 764/964(fused out core config)

 

Shaun

 


Sent: Friday, July 24, 2015 2:29 PM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

The SD/MMC IP b/w Griffin and Vulcan has not changed. So, we want to make
sure that the same issue does not show up on Vulcan. To ensure that, we
would like the driver code to be modified(below) to see if these spurious
interrupts can be worked around :

.         Include debug information and verify whether or not suspect
interrupts are spurious. Eg. If previous command was complete, but
controller still report a command-timeout. No data transfer is in
progress, but still report data errors etc. 

.         If an interrupt can be determined to be spurious, discard the
interrupt. Reset the corresponding controller(data or cmd or both as
needed through MMC_SWRESET register) and clear error registers.  Verify
that this will not result in data corruption.

 

 

,

 

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 12:47 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet,

 

We have been spending a lot of time on this exercise, and in my opinion
some of this was unnecessary. We have provided more than enough data to
prove that :

1.       our locking is correct, and we ensure that more than one
operation including DMA does not occur, across both slots at this time. 

2.       there are other hardware issues (like spurious interrupts) which
cause these failures,

We have other high priority tasks to complete for Vulcan, and I think we
cannot spend more time in helping you debug this.

 

It would have been helpful if all the known issues were in the errata.
Then we could add hacks to the linux driver to work around the broken
hardware instead of spending an unnecessary amount of time defending the
locking in the driver.

 

,

JC.

 


Sent: Tuesday, July 21, 2015 11:28 PM

Ryan Emmett; Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh
Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Basil had further questions (please see attached). Let us know your take
on this.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, July 21, 2015 6:47 AM

Shaun Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 



 

Please find my reply inline.

Sorry for late reply, I was on leave last week.

 



Kamlakant Patel

 


Sent: Tuesday, July 14, 2015 6:23 AM

Kittle; Basil Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Hi JC

 

NOTES:

.         DCRC error (Error Message - "Got data interrupt
0x00600000/0x00200000 even though no data operation was in progress") is
non-fatal, hence not of interest.

.         Error Val -145, -88 are non-fatal errors, hence not of interest.

 

NEXT: 

Please 

.         Reproduce a fatal error(refer to attached) and print the log
before and after.

a.  If fatal error observed, print the reg address for MMC Slot0 and MMC
Slot1.

>> I will try to reproduce fetal error and send the log. Not able to
progress  because boards are not available due to SDK release in process.

.         Indicate in the log file where MMC1 and MMC0 simultaneous
accesses are prevented.

>> This you can see in the log file. The actual transfer starts with the
sdhci_req and finishes with sdhci_finish and there is no conflicting
access to registers between these two function calls.

.         Explain these two errors observed in the "mmc_error_trace.txt"

a.  sdhci_do_set_ios: Got mmc1 req while mmc0 was in progress****

b.  sdhci_do_start_signal_voltage_switch: Got mmc1 req while mmc0 was in
progress

>> I have put some conditional prints to track if there is any conflicting
function calls. These prints are during initialization, not during any
actual transfer. Please ignore these prints.

.         Correlate the time-stamps of "mmc_error_trace.txt" and
"mmc_error.log".

>> I will try to get timestamp for errors messages in mmc_error.log too,
so that we can correlate.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 

 

 


Sent: Monday, July 13, 2015 1:04 PM

Varghese; Varun Khadilkar; Paresh Hargunani; Paul Kim

Subject: RE: mmc issue on Griffin B0

 

Gaganpreet, Varun,

 


transactions, and that there is still a hardware  issue even when we
prevent two transactions from happening simultaneously.

 

And looking thru the trace, the issue seems to be a spurious interrupt to
the wrong slot - but I will let you guys do the analysis and draw the
conclusion.

 



JC.

 


Sent: Friday, July 10, 2015 9:38 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 



 

Please find the details below.

 

Following is the snap shot of the sequence of operations on mmc1 which is
failing most often.

Please find the this sequence in the log file in the dotted block.

I have marked the error place in the mmc_error_trace log file.

 

f94aaa3b         sdhci_req       mmc1     0        0     0xff
0x000000ff

f94aaa4a         sdhci_read      mmc1     0        0     0x28
0x00000012

f94aaa4e         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaa64         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa71         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa76         sdhci_send_cmd  mmc1     0        0     0xff
0x000000ff

f94aaa83         sdhci_read      mmc1     0        0     0x24
0x1fff0000

f94aaa8e         sdhci_write     mmc1     0        0     0x2e
0x0000000a

f94aaab1         sdhci_write     mmc1     0        0     0x58
0x42013000

f94aaac3         sdhci_read      mmc1     0        0     0x28
0x00000013

f94aaac7         sdhci_write     mmc1     0        0     0x28
0x00000013

f94aaadd         sdhci_read      mmc1     0        0     0x34
0x02ff008b

f94aaae3         sdhci_write     mmc1     0        0     0x34
0x02ff008b

f94aaae9         sdhci_write     mmc1     0        0     0x38
0x02ff008b

f94aaaf0         sdhci_write     mmc1     0        0     0x04
0x00007200

f94aaaf8         sdhci_write     mmc1     0        0     0x06
0x00000001

f94aab00         sdhci_write     mmc1     0        0     0x08
0x0000ee23

f94aab08         sdhci_write     mmc1     0        0     0x0c
0x00000013

f94aab11         sdhci_write     mmc1     0        0     0x0e
0x0000113a

f94aab32         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aab3f         sdhci_read      mmc1     0        0     0x30
0x00208000

f94aab44         sdhci_write     mmc1     0        0     0x30
0x00200000

f94aab59         sdhci_read      mmc1     0        0     0x0e
0x0000113a

f94aab5e         sdhci_data_irq  mmc1     6       -88    0xff
0x000000ff

f94aab8c         sdhci_read      mmc1     0        0     0x30
0x00018000

f94aab91         sdhci_write     mmc1     0        0     0x30
0x00010000

f94aab97         sdhci_cmd_irq   mmc1     2      -145    0xff
0x000000ff

f94aaba6         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aabc2         sdhci_irq       mmc1     0        0     0xff
0x000000ff

f94aabd0         sdhci_read      mmc1     0        0     0x30
0x00000001

f94aabd5         sdhci_write     mmc1     0        0     0x30
0x00000001

f94aabea         sdhci_read      mmc1     0        0     0x30
0x00000000

f94aac00         sdhci_finish    mmc1     0        0     0xff
0x000000ff

f94aac15         sdhci_read      mmc1     0        0     0x24
0x1fff0206

f94aac1b         sdhci_write     mmc1     0        0     0x2f
0x00000002

 

.         Please find the log file with the detailed sequence of
operations, registers, register values and error.

.         Please find state of the machine after the error:

 

[   93.296000] : =========== REGISTER DUMP (mmc1)===========

[   93.296000] : Sys addr: 0x420a2800 | Version:  0x00003202

[   93.296000] : Blk size: 0x00007200 | Blk cnt:  0x00000100

[   93.296000] : Argument: 0x000ad3e8 | Trn mode: 0x00000033

[   93.296000] : Present:  0x1f3f0206 | Host ctl: 0x00000013

[   93.296000] : Power:    0x0000000f | Blk gap:  0x00000000

[   93.296000] : Wake-up:  0x00000000 | Clock:    0x00000307

[   93.296000] : Timeout:  0x0000000a | Int stat: 0x00618001

[   93.296000] : Int enab: 0x02ff008b | Sig enab: 0x02ff008b

[   93.296000] : AC12 err: 0x00000000 | Slot int: 0x00000002

[   93.296000] : Caps:     0x01cf00b0 | Caps_1:   0x03000000

[   93.296000] : Cmd:      0x0000123a | Max curr: 0x00000000

[   93.296000] : Host ctl2: 0x00000000

[   93.296000] : ADMA Err: 0x00000003 | ADMA Ptr: 0x420d0008

[   93.296000] : ===========================================

 

>3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you >have modified. Let us
know if otherwise.

>a) All mmc accesses now go through this function that you have modified.

        All mmc requests will pass through sdhci_request() for any
transfer request.

>b) DMAs are blocking(wait till complete) and not managed through
interrupt.

        This is taken care by the transfer complete interrupt. Next
request starts only after current transfer is complete.

>c) There are no other functions that allows any access to mmc controller.

                There are other function used for setup and configuration
of mmc which is called only during the initialization.

 



Kamlakant Patel


Sent: Thursday, July 09, 2015 5:34 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Do you have any updates to share? Please let us know.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 2:22 PM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

In the call trace sent, most of the accesses to slots are in blocks . But
there are a few accesses like the one Basil pointed below, where there is
a single slot 1 accesses in among a block of slot 0 accesses. 

 

1. Will the below sequence interleave slot accesses :

                a. Register reads/writes

                b. Does the sdhci_write/sdhci_read function wait for DMA
completion before exiting or is that a separate interrupt?

 

0363f3a8      sdhci_read   mmc0  0x2f  0x00000004

036430bf      sdhci_read   mmc0  0x2f  0x00000000

036430ce      sdhci_read   mmc0  0x28  0x00000001

036430d2      sdhci_write  mmc0  0x28  0x00000000

03680d2d      sdhci_read   mmc1  0x3e  0x00000000

0369378f      sdhci_req    mmc0  0xff  0x000000ff

0369379e      sdhci_read   mmc0  0x28  0x00000000

036937a2      sdhci_write  mmc0  0x28  0x00000001

036937b8      sdhci_read   mmc0  0x24  0x1fff0000

 

 

2. Also, you did not send us the log file, which shows the failure and the
timestamp(s) for function calls that caused the failure, so that we can
know the state of the controller before/during/after the failure - This
was the intention of this debug.

1.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

While at it, please ensure that there is a way to link the call trace to
log file and add more print statements to the drive wherever makes sense
that the info could be pertinent. The idea is that we should be able to
link a failure, for eg. the h/w interrupt  timeout, seen in the log file,
to a specific line in the call trace.

May be add a print of the time-stamp at the beginning/end of each function
also. Just a suggestion. Please do whatever to achieve the intended else
as is, it is not really useful.

 

3. The patch file shows the synchronization you have added. We are
assuming following for the function "static void sdhci_request(struct
mmc_host *mmc, struct mmc_request *mrq)" that you have modified. Let us
know if otherwise.

a)      All mmc accesses now go through this function that you have
modified.

b)      DMAs are blocking(wait till complete) and not managed through
interrupt.

c)       There are no other functions that allows any access to mmc
controller.

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, July 06, 2015 11:29 AM

Khadilkar; Paresh Hargunani; Paul Kim

Usmani; Joe (Joseph) Lednicky
Subject: RE: mmc issue on Griffin B0

 

Including Paul back into the discussion for assisting.

 

Kamlakant/Gaganpreet, can you please comment on the next steps for the
debug, I'm not clear what Kamlakant's new trace scenario is from and who
will review it next (Varun?).

 


Ryan

 


Sent: Friday, July 03, 2015 4:50 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

HI all,

 

Please refer this(attached) file for trace.

 



Kamlakant Patel

 


Sent: Thursday, July 02, 2015 10:23 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry, I forgot to mention following.

The sequence in the trace file like :

sdhci_*                mmc0   0xff       0x000000ff         just shows the
function call with timestamp.

 



Kamlakant  Patel

 


Sent: Thursday, July 02, 2015 10:01 PM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Sorry for the delay.

 

Please find the details below.

1.       (a). Checked the code again and again, couldn't see any problem.
FIY, we use the standard SD/MMC driver which is common for everybody.

 

2. Please find the attached file for the details [mmc_trace.txt]. All the
operations done on single CPU only.

Operations sequence:   mount slot 0 > mount slot 1 > copy data from slot1
-> slot 0

 

3. Please find attached files:

                a. Standard sd/mmc driver [sdhci.c].

                b. patch for synchronizing transfers
[0001-sd-mmc-fix-simultaneous-transfer-issue.patch].

                c. xlp sd/mmc platform code[sdhci-xlp.c].

 

 



Kamlakant Patel 

 


Sent: Thursday, June 25, 2015 11:32 PM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant 

 

Just to re-capture what we discussed for individual points:

 

1.       Kamlakant confirmed that the driver code modifications are
functioning according to the requirements provided by Varun. 

a.       Next: Go over the driver code again to review the code to double
check if something might have been inadvertently missed.[Kamlakant,
Pending]

2.       Send the complete summary and log with detailed sequence of
operations, register values and timestamps.[Kamlakant, Pending]

3.       Diff old driver code vs new driver code and send out the patch
file with explanation .[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Thursday, June 25, 2015 6:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

As per our discussion today. I will send the complete summary and log with
detailed sequence of operations, register values and timestamps.

This might take couple of days. I will send the log once done.

 



Kamlakant Patel  

 


Sent: Thursday, June 25, 2015 6:15 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

In preparation for the 10PM PST meeting today, to make the most out of it,
can you please come prepared with the following information?

 

1. Provide details of regs for spin-locking that are shared b/w 2 slots
[Varun. DONE. See points a and b]. 

a)      We know that 2 slots cannot be operated at the same time. This is
not limited to just issuing commands to external MMC/SD device. We also
need to make sure that we only write/read registers which belong to same
slot.

b)      In Summary, spin-lock should cover all register accesses to the
slots (not just command register which initiates actual transaction on the
interface)

c)       NEXT: Confirm if this has implemented correctly.[Kamlakant,
Pending]

2. Provide specifics of failing operation sequence(commands/reg
accesses/addresses) . [Kamlakant, Pending]

.         The information that are looking for will look like something to
the following extent. For example, if the operation that fails is "mount
slot 0 -> mount slot 1 -> copy to slot 0 -> copy to slot 1  etc" then we
need to understand specific hardware access sequence leading to the
failure, for eg., write cmd x to slot 0 -> initiate dma -> write cmd y to
slot 1 -> poll the reg x or service interrupt y and so on. It may show you
certain info to debug further.

3. Provide specifics of the changes that were made to "synchronize" the
operation", without which failures occur on all other products.
[Kamlakant, Pending]

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Tuesday, June 23, 2015 6:53 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

1.       Yes, we do see errors on other products without this fix.

2.       PFA.

3.       We do not see any issues when accessing individual slots at a
time.

 

We can have meeting. Tomorrow evening [10PM PST] will be fine for me. It
will better if you can make it early. Please schedule the meeting.

 



Kamlakant Patel 

 


Sent: Tuesday, June 23, 2015 12:39 AM

Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

1. You mentioned that you made some changes to synchronize operations on
both slots. Without this code fix, do you see errors on other products
also?

2. The errors below; are these fatal or recoverable? Please share your log
file also if possible.

3. Do you see similar errors when you only issue commands to a single slot
only? As mentioned, we do not see any issues when accessing individual
slots at a time.

 

I believe we need to have a meeting with you and Varun/Ozair/Basil. All of
us in this thread usually work 10-7PM PST.

Please let us know what time works for you(preferably above mentioned if
possible) and I will sync up with everyone and schedule a meeting.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 22, 2015 8:58 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Today's debugging status:

1.       Added some more code changes to make sure that the next request
starts after current is finished. But still getting same errors.

[   52.108000] mmcblk1: error -88 transferring data, sector 1725523, nr
256, cmd response 0x0, card status 0xb00

[   52.120000] mmcblk1: retrying using single block read

[   52.524000] ------------[ cut here ]------------

[   52.524000] WARNING: at
/projects/cps-sw/patelk/work/sdk-base/buildroot/output/build/linux/drivers
/mmc/host/sdhci.c:984 sdhci_send_command+0xe68/0xf30()

[   52.524000] Modules linked in:

                ..

2.       I tried to put some time delay between two operations. But
getting following error while transferring b/w to cards.

[  925.924000] mmcblk1: timed out sending r/w cmd command, card status
0xb00

[  925.928000] end_request: I/O error, dev mmcblk1, sector 1622617

[  925.936000] FAT-fs (mmcblk1p2): FAT read failed (blocknr 52)

.

 

Basil,

Yes, I have made changes to synchronize operations on both slots and with
the same changes it's working fine on other boards.

 



Kamlakant Patel

 


Sent: Saturday, June 20, 2015 3:16 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Kamlakant,

 

Please do not focus on the DCRC error.  This is a known issue with a
workaround, as Gaganpreet mentioned.  

 

We need solutions to the other failures.

 

But I am still getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

Shaun

 

 

 


Sent: Friday, June 19, 2015 11:47 AM

Paresh Hargunani

Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Did you have to make any changes to the driver to ensure "only one card is
active at a time and there is no interrupt conflicts between both MMCs"?

 

Also, are you seeing the issue we saw (log files in JIRA-180) when testing
with two MMCc/SDs?

 



Basil

 


Sent: Friday, June 19, 2015 11:43 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

MMC controller is exactly same for XLP5xx, XLP9xx and XLP8xx.

 



Varun

 


Sent: Friday, June 19, 2015 11:33 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

The elf wb binary that we used indicated that DCRC occurred after sending
CMD0 or CMD6

We have not been able to pin point the reason why these DCRC errors are
triggered on Slot 1. 

However, these DCRC errors can be fixed by doing a Data Controller reset.
This workaround is also incorporated in linux.

 

Per Varun, nothing has changed in the MMC Controller since XLP8xx so there
is no difference b/w XLP9xx and XLP5xx. Varun can comment further.

 

Do you see any other failures except DCRC on slot 1? What about Slot 0?

 

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Friday, June 19, 2015 11:05 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

During my debug process, I could see that only one card is active at a
time and there is no interrupt conflicts between both MMCs. But I am still
getting DCRC error on mmc1.

I am still not able to conclude either it's a Hardware or software issue.
I will continue debugging. 

 

I have following questions:

.         Did you find out the reason for the occasional DCRC errors?

> FYI: We have ran several units, one slot at a time on Griffin using
linux and have not seen any failures (except occasional DCRC errors during
linux boot on slot1). So individually both slots are clean.

 

.         Since XLP5XX works fine for the same test cases, could you
please tell me the difference between XLP9XX and XLP5XX MMC controllers.

 



Kamlakant Patel 

 


Sent: Friday, June 19, 2015 5:01 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

Were you able to make any progress on the debug?  Please share daily
updates with us  since we have a 24 hour turnaround. 

On our side, we have been running more process corners across temps and so
far, individual slots at 95C, 25C and -40C are solid with no fails.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 11:44 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

You might be aware that Griffin tape out is scheduled 0622 so we need to
wrap this up by Friday. 

If you want to refer the run logs for our testing, please refer the
following directories: 

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot1_200mb_a5pattern

/projects/cps_postsi_ext1/griffin/data/b0/pvt_char/mmc/debug/SIISSUES_180/
pvt_char_griffinB0_mmc_slot0_200mb_a5pattern

*HACKBENCH.log.cleaned

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Wednesday, June 17, 2015 7:37 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 



 

Yes, as mentioned the software fix works fine for XLP2xx, XLP3xx and
XLP5xx.

 

> Also, can you please share the run logs that you believe indicate a h/w
issue?

I am running some more tests with some changes, I will share details once
done.

 



Kamlakant Patel  

 


Sent: Wednesday, June 17, 2015 5:36 AM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hi Kamlakant

 

We are still waiting for your feedback. As Varun mentioned, simultaneous
accesses are not permitted by IP Design. 

Your first email indicates that a software fix to prevent above situation
is in place for all products including Griffin and works for XLP2xx,
XLP3xx and XLP5xx but not on XLP9xx. Please confirm.

Also, can you please share the run logs that you believe indicate a h/w
issue?

FYI: We have ran several units, one slot at a time on Griffin using linux
and have not seen any failures (except occasional DCRC errors during linux
boot on slot1). So individually both slots are clean.

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:10 PM


Basil Varghese; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

Hello Shaun,

 

Simultaneous operations to both ports are not allowed and this is a
limitation/feature of MMC controller IP by design.

 

If S/W is doing simultaneous operations to both ports, its illegal
operation and cannot be considered as H/W problem.

If S/W is not aware of the controller limitation/feature, we need to add
it to our PDM/PRM. Controller IP document has this information.

 

Apart from simultaneous access to MMC Kamlakant mentions "looks like there
are some more issues with Griffin, we suspect it's a hardware issue but
couldn't conclude the actual reason"

We can look at these issues if we have some logs/traces.

If these additional issues are linked to
http://ingjira.sj.broadcom.com/browse/SIISSUES-180, we have already
addressed it. 

(We know that DCRC error occurs on port 1 of Griffin B0. Linux code
already has work-around for it)

 



Varun

 

 


Sent: Monday, June 15, 2015 11:26 AM


Basil Varghese; Varun Khadilkar; Ozair Usmani
Subject: RE: mmc issue on Griffin B0

 

+Varun

 

Varun,

 

Didn't you mention that simultaneous operations to both ports are not
allowed and must be gated by s/w?

 

Perhaps we have different definitions of simultaneous?  

 

Kamlakant,

 

Where are your results posted that point to a h/w problem?  

 

Shaun

 


Sent: Monday, June 15, 2015 10:44 AM


(Kenneth) Schmahl; Basil Varghese
Subject: RE: mmc issue on Griffin B0

 

+ Ken, Shaun, Basil

 

Thanks

Gaganpreet Singh

Office: 4089194230

 


Sent: Monday, June 15, 2015 6:26 AM


Subject: mmc issue on Griffin B0

 



 

We have issues while using two SD/MMCs simultaneously on Griffin boards.
While it works properly if only one card is present.

While doing simultaneous transfer on both the slots, we observed multiple
failures(e.g. DCRC error, CMD error, read and write error).

 

We have put software workaround(allow only one slot to do the transfer at
a time) which fixes simultaneous transfer issue on both slots for XLP3xx,
XLP2xx and XLP5xx.

But looks like there are some more issues with Griffin, we suspect it's a
hardware issue but couldn't conclude the actual reason.

 

Please refer following JIRA's for more information:

http://ingjira.sj.broadcom.com/browse/SIISSUES-180 

http://ingjira.sj.broadcom.com/browse/EPSW-2938 

 

Could you please help debug this issue.

 



Kamlakant Patel


Sent:	Wednesday, August 12, 2015 2:36 PM

Subject:	RE: DOB correction status in PF account.

HI,

 

May I know the status of DOB correction in my PF account.

Where can I check to see if my DOB is corrected or not?

 





 


Sent: Tuesday, August 04, 2015 12:03 PM

Subject: RE: DOB correction status in PF account.

 



                My Employer has already submitted the attested PAN card
copy.

                Please find the attached document witch has the all
documents submitted by Employer.

 

                If you need any other documents please let me know I will
submit those.

 

Thank you.

.


Sent: Tuesday, August 04, 2015 11:33 AM

Subject: Re: DOB correction status in PF account.

 

Sir,

Please submit supporting documents such as Copy of Birth Certificate, SSLC
Marks card etc attested by the Employer to make necessary changes.

With regards,

Regional Office
Bengaluru

On 08.03.15 06:04 PM, Praveen B <praveenb@broadcom.com> wrote:


 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 

-- 
Thanks and  

Regional PF Office 
Bangalore 
PRO: 22279130,

or:      22238033- Extn: 603


Sent:	Wednesday, August 12, 2015 2:35 PM

Subject:	RE: DOB correction status in PF account.

 

HI,

 

May I know the status of DOB correction in my PF account.

Where can I check to see if my DOB is corrected or not?

 





 


Sent: Tuesday, August 04, 2015 12:03 PM

Subject: RE: DOB correction status in PF account.

 



                My Employer has already submitted the attested PAN card
copy.

                Please find the attached document witch has the all
documents submitted by Employer.

 

                If you need any other documents please let me know I will
submit those.

 

Thank you.

.


Sent: Tuesday, August 04, 2015 11:33 AM

Subject: Re: DOB correction status in PF account.

 

Sir,

Please submit supporting documents such as Copy of Birth Certificate, SSLC
Marks card etc attested by the Employer to make necessary changes.

With regards,

Regional Office
Bengaluru

On 08.03.15 06:04 PM, Praveen B <praveenb@broadcom.com> wrote:


 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 

-- 
Thanks and  

Regional PF Office 
Bangalore 
PRO: 22279130,

or:      22238033- Extn: 603


Sent:	Tuesday, August 11, 2015 5:40 PM

Subject:	mmc driver issue on 9xx



 

I tried to copy 400MB file from one sdcard to other on 9xx

I got the following error.

Can you please check the following error log and conform that this is the
bug in 9xx.

 

ls -lh /mnt/mmc1/

-rwxr-xr-x    1 root     root      400.0M May 25 17:16 new1.txt

-rwxr-xr-x    1 root     root      801.9K Jul 29  2015 u-boot.bin

-rwxr-xr-x    1 root     root      118.2K Jul 29  2015 xload.bin

(initramfs)cp /mnt/mmc1/new1.txt /mnt/mmc2/

(initramfs)ls -lh /mnt/mmc2/

drwx------    2 root     root       16.0K May 25 16:55 lost+found

-rwxr-xr-x    1 root     root      400.0M May 25 17:16 new1.txt

(initramfs)

(initramfs)[ 4348.852000] mmcblk1: timed out sending r/w cmd command, card
status 0xd00

[ 4348.860000] end_request: I/O error, dev mmcblk1, sector 150752

[ 4348.864000] end_request: I/O error, dev mmcblk1, sector 150880

[ 4348.864000] DMA: Out of SW-IOMMU space for 65536 bytes at device
0000:01:07.3

[ 4348.864000] ------------[ cut here ]------------

[ 4348.864000] WARNING: at
/projects/cps-sw/praveenb/sdk-base/buildroot/output/build/linux/drivers/mm
c/host/sdhci.c:824 sdhci_send_command+0xa58/0xd78()

[ 4348.864000] Modules linked in:

[ 4348.864000] CPU: 39 PID: 368 Comm: mmcqd/0 Not tainted 3.10.59-gcd72428
#2

[ 4348.864000] Stack : 000000000000003e 0000000000000000 0000000000000000
ffffffffc0a20000

[ 4348.864000]     000000000000003e ffffffffc4a40000 ffffffffc0a20000
0000000000000027

[ 4348.864000]     0000000000000004 ffffffffc0a20000 ffffffffc4a40000
ffffffffc0131fc0

[ 4348.864000]     000000000000003e ffffffffc0132fb4 0000000000000000
0000000000000000

[ 4348.864000]     0000000000000000 ffffffffc4a40000 ffffffffc0902270
ffffffffc0a21217

[ 4348.864000]     0000000000000338 ffffffffc096af48 0000000000000009
0000000000000008

[ 4348.864000]     c00000081b4f4890 c00000081808d000 ffffffffc0a231e0
ffffffffc07608bc

[ 4348.864000]     c00000080209fa50 c00000080209f948 ffffffffc0a231e0
ffffffffc0130468

[ 4348.864000]     c000000801a8aba0 ffffffffc0902270 0000000000000027
0000000000000170

[ 4348.864000]     0000000801a8aba0 ffffffffc010b130 0000000000000000
0000000000000000

[ 4348.864000]     ...

[ 4348.864000] Call Trace:

[ 4348.864000] [<ffffffffc010b130>] show_stack+0x68/0x80

[ 4348.864000] [<ffffffffc0130468>] warn_slowpath_common+0x78/0xa8

[ 4348.864000] [<ffffffffc06735c8>] sdhci_send_command+0xa58/0xd78

[ 4348.864000] [<ffffffffc0673f50>] sdhci_request+0x198/0x258

[ 4348.864000] [<ffffffffc0660b00>] mmc_start_req+0x2f0/0x3f0

[ 4348.864000] [<ffffffffc066ebb4>] mmc_blk_issue_rw_rq+0xc4/0xb48

[ 4348.864000] [<ffffffffc066f84c>] mmc_blk_issue_rq+0x214/0x570

[ 4348.864000] [<ffffffffc0670f68>] mmc_queue_thread+0xc0/0x190

[ 4348.864000] [<ffffffffc01576b0>] kthread+0xb8/0xc0

[ 4348.864000] [<ffffffffc01064b0>] ret_from_kernel_thread+0x10/0x18

[ 4348.864000] 

[ 4348.864000] ---[ end trace 9f835c71da5029fd ]---

 

 

,



 


Sent:	Monday, August 10, 2015 2:25 PM


Subject:	status: WW32



 

Achievements:

       Graph500:    

.         Compiled and ran it on x86 / juno.

.         Collected and documented the benchmark results.

.         Collected performance stats of the benchmark on x86 and juno.


Issues:

 

,



 

 


Sent:	Tuesday, August 04, 2015 12:03 PM

Subject:	RE: DOB correction status in PF account.
Attachments:	043721_.PDF



                My Employer has already submitted the attested PAN card
copy.

                Please find the attached document witch has the all
documents submitted by Employer.

 

                If you need any other documents please let me know I will
submit those.

 

Thank you.

.


Sent: Tuesday, August 04, 2015 11:33 AM

Subject: Re: DOB correction status in PF account.

 

Sir,

Please submit supporting documents such as Copy of Birth Certificate, SSLC
Marks card etc attested by the Employer to make necessary changes.

With regards,

Regional Office
Bengaluru

On 08.03.15 06:04 PM, Praveen B <praveenb@broadcom.com> wrote:


 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 

-- 
Thanks and  

Regional PF Office 
Bangalore 
PRO: 22279130,

or:      22238033- Extn: 603


Sent:	Monday, August 03, 2015 5:31 PM

Subject:	DOB correction status in PF account.
Attachments:	043721_.PDF

 



                I am an employee of BROAMCOM COMMUNICATIONS.

                I have submitted a form to correct my date of birth in my
PF account on Feb-2012, but still it is not reflected.

                Please resolve the issue.

                Please fins the attached Form-5 for details. 

 

,



 


Sent:	Monday, August 03, 2015 12:02 PM


Subject:	status: WW31



 

Achievements:

    Spent some time on PIN tool to get instruction mix percentages.

    Graph500:

.         Spent some time to understand the benchmark details.

.         Downloaded the source code and compiled it on x86.

 

Issues:

.         Not able to get other categories of workload characteristics
with PIN tool.

.         Got some errors while executing the Graph500 benchmark on x86.

 

,



 

 


Sent:	Monday, July 27, 2015 2:36 PM


Subject:	status: WW30



 

    NPB: compute kernel

   Achievements:

                Studied "Microarchitecture-independent workload
characterization" paper.

                Spent some time to identify valgrind tools.

                Explored the options in PIN tool.

 

   Issues:

                Not able to find ATOM tool sources.       

 

 

,



 

 


Sent:	Monday, July 20, 2015 3:08 PM


Subject:	Status WW29



 

NPB:

Achievements:

1.       Extracted compute kernel from benchmark and made a standalone
program out of it that does random memory access.

2.       Analyzed the behavior of compute kernel using toplev and
perftools.

 

Issues:

    .

 

Next steps:

                Analyze more on compute kernel to collect useful stats

 

,



 


Sent:	Monday, July 13, 2015 12:19 PM


Subject:	Status WW28



 

NPB:

Achievements:

    Identified core code in benchmark.

    Collected traces for a complete core benchmark code. 

 

Issues:

    .

 

Next steps:

    Categorize the workloads in NPB benchmarks.

    Create a sample compute kernel.  

 

Misc:

      Gave a presentation on my work on identifying compute kernel in npb
benchmark.

 

 

,



 


Sent:	Monday, July 06, 2015 3:53 PM


Subject:	status: ww27



 

     NPB:

                Collected Gem5 traces for all serial type NPB benchmarks ,
for both class S (small) and class W (workstation)

                Working on identifying core code in benchmark without
initialization and cleanup for collecting minimal gem5 traces.

                                

,



 


Sent:	Monday, June 29, 2015 3:29 PM


Subject:	status: ww26



 

     NPB:

            Collected gem5 traces for a category (serial type) of NPB
benchmarks.

            Spent some time in collecting gem5 traces for MPI based NPB
benchmarks but getting some errors.

                                

,



 


Sent:	Monday, June 22, 2015 1:15 PM

Subject:	FW: status : ww25

 

 


Sent: Friday, June 19, 2015 3:38 PM


Praveen B; Saswat Dash; Siva (Sivaprasad) Pochiraju; Sreenidhi Bharathkar
Ramesh
Subject: status : ww25

 



 

Please find the status report for week 25

 

Vulcan Toolchain

-          [GCC] improved the vulcan pipeline description in the gcc
backend

-          Re-validation of the toolchain due to gcc modifications (cross
toolchain (booting linux on juno), native toolchain (coremark on juno))

-          updated the confluence page for vulcan GCC
http://confluence.broadcom.com/display/VULCANSW/GCC 

-          Discussion with Debayan on vulcan toolchain automations process

 

LIBM 

-          Started with the study of sin() implementation in
openlibm-0.4.1 & crlibm-1.0beta4

 

Misc

-          Worked with Ajay in resolving EPSW-2954

-          Discussion with Ajay Kumar in XLPSDK-2205 (H3C 64 bit
toolchain)

 

 

Plan for next wk

-          PTO

 

Thanks

 

with regards

Virendra Pathak


Sent:	Friday, June 12, 2015 5:17 PM


Subject:	status : ww24



 

                NPB Benchmarks:

                                Collected trace for a NPB benchmark using
Gem5.

                                                Collected traces using gdb
and .rcS script.

 

                Spent some time on reading about ARM neon intrinsics.

 

                misc:

                    1 day PTO. 

 

 

,



 


Sent:	Monday, June 08, 2015 5:11 PM


Subject:	status : ww23



                Looking into ARM PMU event counters   (Continuing)

                     1. Working on a method to identify bottlenecks in ARM
using available events

 

                Started working on gem5 simulator to collect npb benchmark
traces.

 

,



 


Sent:	Monday, June 01, 2015 2:16 PM


Subject:	status : ww22

 



 

                NPB Benchmarks:

                                1.       Ran toplev with npb benchmarks.
Most of them are backend bound on x86.

                                2.       Spent some time on understanding
top-down events used in pmu-tools.

                                                Tried to look into
available events in Intel. There are 500+ hardware events in x86 arch

                                                 In arm ~30 hardware
events are present

                                3.       Working on a method to identify
bottlenecks in ARM using available events

 

,

.


Sent:	Monday, May 25, 2015 2:14 PM


Subject:	status: ww21

HI Siva,

 

                NPB Benchmarks:

                                Spent some time on understanding x86 perf
PMU tools.

                                Trying to identify the workloads using
pmu-tools.

 

,



 


Sent:	Wednesday, May 20, 2015 12:12 PM

Subject:	RE: HD0000006796042 - Case Update - need access to the page

Now I am able to access that page. You can close this ticket.

Thank you,



-----Original Message-----

Sent: Tuesday, May 19, 2015 10:43 PM

Subject: HD0000006796042 - Case Update - need access to the page

On 5/19/2015 10:12:33 AM Jorge Orante wrote ...


Subject: RE: HD0000006796042 - Update - need access to the page

Praveen, you now have this access, can you please validate and let me know
any comment.
Thanks.

Best regards
Jorge Orante | Information Technology Broadcom Corporation | (M) 52 1 646
125 6379


-----Original Message-----

Sent: Tuesday, May 19, 2015 9:45 AM

Subject: HD0000006796042 - Update - need access to the page

SEND REQUESTER UPDATE :
mailto:remedyhelp@broadcom.com&subject=HD0000006796042
SEND INTERNAL UPDATE  :
mailto:remedyhelp@broadcom.com&subject=HD0000006796042i

SMARTPHONE READERS ONLY:
To redirect your response to the Internal Work Log field, edit the subject
of your reply by adding a lowercase "i" after the case ID (i.e.
HD0000006796042i)

REQUESTER : praveen B - (praveenb)
ASSIGNEE  : Jorge Orante
CASE TYPE : Problem
STATUS    : Work In Progress
PRIORITY  : Medium
DUE DATE  : 5/25/2015 11:59:59 PM (PST)
FILE ADDED: No

LAST REQUESTER UPDATE :
On 5/19/2015 9:13:43 AM Jorge Orante wrote ...


Subject: RE: HD0000006796042 - Assigned - need access to the page

 I just receive your case and will check it with the
site owner, on any update I'll let you know.

Best regards
Jorge Orante | Information Technology Broadcom Corporation | (M) 52 1 646
125 6379

-----Original Message-----

Sent: Tuesday, May 19, 2015 4:25 AM

Subject: HD0000006796042 - Assigned - need access to the page

SEND REQUESTER UPDATE :
mailto:remedyhelp@broadcom.com&subject=HD0000006796042
SEND INTERNAL UPDATE  :
mailto:remedyhelp@broadcom.com&subject=HD0000006796042i

SMARTPHONE READERS ONLY:
To redirect your response to the Internal Work Log field, edit the subject
of your reply by adding a lowercase "i" after the case ID (i.e.
HD0000006796042i)

REQUESTER : praveen B - (praveenb)
ASSIGNEE  : Jorge Orante
CASE TYPE : Problem
STATUS    : Assigned
PRIORITY  : Medium
DUE DATE  : 5/20/2015 11:59:59 PM (PST)
FILE ADDED: 

LAST REQUESTER UPDATE :
On 5/19/2015 4:24:36 AM Chris Davis wrote ...


I have transferred your case to the application support department to work
on your ticket. Otherwise please do not hesitate to contact the help desk
at 949-926-5559 (ext 65559) or help@broadcom.com for further assistance. 

Thank you,

Chris Davis
Service Desk Support Technician
(949) 926-5559
x65559
Have you seen the new IT Self-Service site? You can get information about
IT Services and submit online requests here:
http://itservices.broadcom.com/SelfService/SitePages/SelfService.aspx

LAST INTERNAL UPDATE  : 
On 5/19/2015 4:24:36 AM Chris Davis wrote ...
Reached out to user via Lync because office number does not work.

Was unable to use link getting the error that the link does not work.

Spoke with user and and found that the link provided should be correct.

confirmed with user that priority can be lowered.

[5/19/2015 7:21 AM] Chris Davis: 
Ok for this then I will need to speak to the sharepoint admins to find out
what happened to it however currently they are not in the office. Is this
something that can wait until they become available?
[5/19/2015 7:21 AM] Praveen B: 
ok no probelm
*problem


CASE DESCRIPTION:
Subject: need access to the page



                Please provide access to following page
http://ingbu.broadcom.com/PWI/EP/EP-Apps/
                I need this for reserving Sanjose lab machines for Vulcan
HPC benchmarking.

,


CASE DETAIL : http://remedy.broadcom.com/casea.asp?E=HD0000006796042
CASE TABLE  :
http://myremedy.broadcom.com/ticket/?ticket=HD0000006796042;prune=1

LAST INTERNAL UPDATE  : 
On 5/19/2015 9:45:11 AM Ryan Emmett wrote ...


<remedyhelp@broadcom.com>
Subject: RE: HD0000006796042i - Assigned - need access to the page



Yes you can give Praveen access to the sharepoint by Contribute on the
parent site.


Ryan

-----Original Message-----

Sent: Tuesday, May 19, 2015 9:16 AM


Subject: RE: HD0000006796042i - Assigned - need access to the page

 just checking with you if it's OK to grant this access
to Praveen, I come to you because you appear as the owner for this
SharePoint.
He's looking for "Contribute" access at least as he want to update a file
in a list.
We can grant this access thru the parent site "EP-Apps", this because the
site where Praveen requires the access inherits his permissions from this
one.
The other way is to stop this inheritance and grant only the access in the
library he needs.
Please let me know any comments.

Best regards
Jorge Orante | Information Technology Broadcom Corporation | (M) 52 1 646
125 6379


-----Original Message-----

Sent: Tuesday, May 19, 2015 4:25 AM

Subject: HD0000006796042 - Assigned - need access to the page

SEND REQUESTER UPDATE :
mailto:remedyhelp@broadcom.com&subject=HD0000006796042
SEND INTERNAL UPDATE  :
mailto:remedyhelp@broadcom.com&subject=HD0000006796042i

SMARTPHONE READERS ONLY:
To redirect your response to the Internal Work Log field, edit the subject
of your reply by adding a lowercase "i" after the case ID (i.e.
HD0000006796042i)

REQUESTER : praveen B - (praveenb)
ASSIGNEE  : Jorge Orante
CASE TYPE : Problem
STATUS    : Assigned
PRIORITY  : Medium
DUE DATE  : 5/20/2015 11:59:59 PM (PST)
FILE ADDED: 

LAST REQUESTER UPDATE :
On 5/19/2015 4:24:36 AM Chris Davis wrote ...


I have transferred your case to the application support department to work
on your ticket. Otherwise please do not hesitate to contact the help desk
at 949-926-5559 (ext 65559) or help@broadcom.com for further assistance. 

Thank you,

Chris Davis
Service Desk Support Technician
(949) 926-5559
x65559
Have you seen the new IT Self-Service site? You can get information about
IT Services and submit online requests here:
http://itservices.broadcom.com/SelfService/SitePages/SelfService.aspx

LAST INTERNAL UPDATE  : 
On 5/19/2015 4:24:36 AM Chris Davis wrote ...
Reached out to user via Lync because office number does not work.

Was unable to use link getting the error that the link does not work.

Spoke with user and and found that the link provided should be correct.

confirmed with user that priority can be lowered.

[5/19/2015 7:21 AM] Chris Davis: 
Ok for this then I will need to speak to the sharepoint admins to find out
what happened to it however currently they are not in the office. Is this
something that can wait until they become available?
[5/19/2015 7:21 AM] Praveen B: 
ok no probelm
*problem


CASE DESCRIPTION:
Subject: need access to the page



                Please provide access to following page
http://ingbu.broadcom.com/PWI/EP/EP-Apps/
                I need this for reserving Sanjose lab machines for Vulcan
HPC benchmarking.

,


CASE DETAIL : http://remedy.broadcom.com/casea.asp?E=HD0000006796042
CASE TABLE  :
http://myremedy.broadcom.com/ticket/?ticket=HD0000006796042;prune=1

CASE DESCRIPTION:
Subject: need access to the page



                Please provide access to following page
http://ingbu.broadcom.com/PWI/EP/EP-Apps/
                I need this for reserving Sanjose lab machines for Vulcan
HPC benchmarking.

,


CASE DETAIL : http://remedy.broadcom.com/casea.asp?E=HD0000006796042
CASE TABLE  :
http://myremedy.broadcom.com/ticket/?ticket=HD0000006796042;prune=1

ref:EWL

=========================== MORE DETAIL ===========================
To update this case, reply to this email with the full Case ID in the
subject field.

CASE DETAIL :
http://myremedy.broadcom.com/ticket/?ticket=HD0000006796042;prune=1

To escalate the priority of this request, please use one of the following
options:
 1. Contact the HelpDesk at ext-65559 or 949-926-5559 to inform them that
this request is urgent.
 2. Click on the following link to initiate a detailed email which will
notify the appropriate individuals of the escalation.
 
mailto:remedyhelp@broadcom.com&subject=ESCALATE%20$HD0000006796042$&body=E
scalation%20Details%3A


Sent:	Monday, May 18, 2015 12:48 PM


Subject:	RE: status: ww20



 

                NPB benchmarks:

                                1. Compared dependent libraries of npb
binaries on x86 and arm (juno).

           Found that juno binaries are subset of x86. (eg. x86 binary
depends on libquadmath.so but not in arm)

                       Working on finding the reason for mismatches in
dependent libraries.

2. Spent some time on understanding x86 perf PMU tools.

 

                                

,



 


Sent:	Monday, May 11, 2015 12:29 PM


Subject:	status ww19



 

                NPB-Benchmark:

                                Looked at  top level functions of
benchmark source code.

                                Spent some time on understanding perf
tool.

                                Ran profiling tools like gperf and perf.

 

,



 


Sent:	Monday, May 04, 2015 3:24 PM


Subject:	ww18 : status



 

                Looked at  top level functions in NPB benchmarks.

                Observed that lot of computation and random memory access
is happening inside the benchmarks.

 

                Misc:

                                PTO: 29th and 30th

                                

 

,



 


Sent:	Monday, April 13, 2015 3:26 PM


Subject:	ww15 status



 

                Worked on presenting NPB results n better way.

                Read about HPC benchmark ECMWF.

 





 


Sent:	Monday, April 06, 2015 12:50 PM


Subject:	ww14 status



 

                Ran NPB benchmarks on x86 multi node setup and collected
performance numbers.

                Working on presenting obtained performance numbers.

 

                Updated the rtc driver as per review comments from JC.

                RTC driver has been merged into qaq/01 by JC.  

 





 


Sent:	Thursday, April 02, 2015 3:39 PM


Subject:	RE: rtc driver
Attachments:	0001-RTC-Added-RTC-driver-support-for-XLP2xx-XLP5xx-and-X.patch; rtc-log.txt



	Following branch has the updated code.
	remotes/origin/proposed/praveenb/xlp_rtc_driver (sysconfig, linux)
	Please find the attached patch file for code changes.
	
	I have compiled it as a module and tested it on 2xx board by
loading and unloading the module multiple times.
	Please find the attached log file for the same.
	Also I have powered off the board for some time and verified the
time.

Thank you,



-----Original Message-----

Sent: Thursday, April 02, 2015 12:50 AM


Subject: Re: rtc driver

On Wed, Apr 01, 2015 at 05:11:38PM +0530, Praveen kumar wrote:
> 
> 
> 	I have incorporated the changes which you suggested.
> 	The updated rtc code is present in the following branch,
> 		remotes/origin/proposed/praveenb/xlp_rtc_driver
(sysconfig, linux) 
> 
> 	please find the attached patch file for code changes.
> 	
> 	According to PRM, RTC does not support interrupts.
> 	As nothing needs to be done in remove function, I have removed it.
(As per Subhendu's review comments)
> 	If it is mandatory, I will add the following lines as remove
function.
> 
> static int xlp_rtc_remove(struct platform_device *pdev)
> {
>         platform_set_drvdata(pdev, NULL);
>         return 0;
> }

The init does some setup in the volt register etc, don't you have to undo
that on module remove?

Can you test this compiling this as a module and loading and unloading
a few times? We want to ensure that repeating the init sequence again
and agiain is fine, otherwise we have to do some sort of reset in the
remove.

Please also test by switching off the board for sometime and checking
if the time is still correct.

Some more minor comments below, but the code mostly looks good now.


diff --git a/drivers/rtc/rtc-xlp.c b/drivers/rtc/rtc-xlp.c
new file mode 100644
index 00000000..63de68c
--- /dev/null
+++ b/drivers/rtc/rtc-xlp.c
@@ -0,0 +1,235 @@
+/*
+ * Copyright (c) 2003-2015 Broadcom Corporation
+ *
+ * This file is licensed under the terms of the GNU General Public
+ * License version 2.  This program is licensed "as is" without any
+ * warranty of any kind, whether express or implied.
+ */
+
+#include <linux/module.h>
+#include <linux/platform_device.h>
+#include <linux/rtc.h>
+#include <linux/bcd.h>
+#include <linux/jiffies.h>
+
+#define RTC_SECONDS_REG			0x00
+#define RTC_SECONDS_MASK		0x7F
+
+#define RTC_MINUTES_REG			0x01
+
+#define RTC_CENTURY_HOURS_REG		0x02
+#define RTC_HOUR_MASK			0x3F
+
+#define RTC_DAY_REG			0x03
+#define RTC_DAY_BIT_MASK		0x07
+
+#define RTC_DATE_REG			0x04
+
+#define RTC_MONTH_REG			0x05
+
+#define RTC_YEAR_REG			0x06
+#define RTC_YEAR_REG_MASK		0x80000000
+
+#define RTC_STATUS_REG				0x08
+#define RTC_RESETACTIVE_BIT_MASK		0x01
+#define RTC_RESETACTIVE_BIT_SHIFT		04
+#define RTC_TRANSFER_IN_PROGRESS_BIT_POS	03
+#define RTC_TRANSFER_IN_PROGRESS_BIT_MASK	0x01
+
+#define RTC_FLAG_REG			0x09
+#define RTC_OSCSTOPFLAG_BIT_MASK	0x01
+#define RTC_OSCSTOPFLAG_ENABLE		0x01
+#define RTC_UPDATE_FLAG_BIT_SHIFT	02

Missed 0x here?

+#define RTC_UPDATE_FLAG_BIT_MASK	0x01
+#define RTC_UPDATE_FLAG_ENABLE		0x04
+
+#define RTC_CLOCK_PERIOD_REG		0x0a
+
+#define RTC_LOCK_REG			0x0b
+#define RTC_READ_LOCK_BIT_POS		0
+#define RTC_READ_LOCK_BIT_MASK		0x01
+
+#define RTC_VOLT_REG			0x0c
+#define RTC_CORE_ENABLE_MASK		0x02
+
+struct xlp_rtc {
+	struct rtc_device *rtc;
+	u32 __iomem *base;
+};
+
+static int xlp_rtc_wait(struct xlp_rtc *priv, int reg_offset, int
bit_pos,
+			int mask, int time_after, int excepted_value)
+{
+	u32 value;
+	unsigned long stoptime;
+
+	/* Wait till flag to be reset */
+	stoptime = jiffies + msecs_to_jiffies(time_after);
+	while (time_after(stoptime, jiffies)) {
+		value = readl(priv->base + reg_offset);
+		if (((value >> bit_pos) & mask) == excepted_value)
+			return 0;
+	}
+	return -ETIMEDOUT;
+}
+
+static int xlp_rtc_get_time(struct xlp_rtc *priv, struct rtc_time *tm)
+{
+	int err;
+	u32 value;
+
+	writel(RTC_UPDATE_FLAG_ENABLE, priv->base + RTC_FLAG_REG);
+	/* Wait till read lock flag to be set */
+	err =
+	    xlp_rtc_wait(priv, RTC_LOCK_REG, RTC_READ_LOCK_BIT_POS,
+			 RTC_READ_LOCK_BIT_MASK, 20, 0);

Formatting here.

+	if (err) {
+		dev_dbg(&priv->rtc->dev,
+			"Failed to read RTC time, readlock flag not set
:\n");

Message does not need ' :' at the end.

+		return err;
+	}
+
+	value = readl(priv->base + RTC_YEAR_REG);
+	tm->tm_year = bcd2bin(value);
+	/* Assume we are in 1970...2069 */
+	if (tm->tm_year < 70)
+		tm->tm_year += 100;
+
+	value = readl(priv->base + RTC_MONTH_REG);
+	tm->tm_mon = bcd2bin(value);
+
+	value = readl(priv->base + RTC_DATE_REG);
+	tm->tm_mday = bcd2bin(value);
+
+	value = readl(priv->base + RTC_DAY_REG);
+	tm->tm_wday = (value & RTC_DAY_BIT_MASK);
+
+	value = readl(priv->base + RTC_CENTURY_HOURS_REG);
+	tm->tm_hour = bcd2bin(value & RTC_HOUR_MASK);
+
+	value = readl(priv->base + RTC_MINUTES_REG);
+	tm->tm_min = bcd2bin(value);
+
+	value = readl(priv->base + RTC_SECONDS_REG);
+	tm->tm_sec = bcd2bin(value & RTC_SECONDS_MASK);
+
+	tm->tm_yday = rtc_year_days(tm->tm_mday, tm->tm_mon, tm->tm_year);
+
+	return rtc_valid_tm(tm);
+}
+
+static int xlp_rtc_init(struct device *dev)
+{
+	u32 data;
+	int err;
+	struct xlp_rtc *priv = dev_get_drvdata(dev);
+
+	/* Enable core bit */
+	data = readl(priv->base + RTC_VOLT_REG)
+	    | RTC_CORE_ENABLE_MASK;

Formatting

+	writel(data, priv->base + RTC_VOLT_REG);
+
+	/* Wait for resetactive flag to be reset */
+	err =
+	    xlp_rtc_wait(priv, RTC_STATUS_REG, RTC_RESETACTIVE_BIT_SHIFT,
+			 RTC_RESETACTIVE_BIT_MASK, 20, 0);

Formatting

+	if (err)
+		return err;
+
+	/* Wait for rtcupdate flag to be set */
+	err =
+	    xlp_rtc_wait(priv, RTC_FLAG_REG, RTC_UPDATE_FLAG_BIT_SHIFT,
+			 RTC_UPDATE_FLAG_BIT_MASK, 1000, 1);
+	if (err)
+		return err;
+	writel(RTC_UPDATE_FLAG_ENABLE, priv->base + RTC_FLAG_REG);
+
+	return 0;
+
+}
+
+static int xlp_rtc_read_time(struct device *dev, struct rtc_time *rtc_tm)
+{
+	struct xlp_rtc *priv = dev_get_drvdata(dev);
+
+	/* Read current time from RTC time registers */
+	return xlp_rtc_get_time(priv, rtc_tm);
+}
+
+static int xlp_rtc_set_time(struct device *dev, struct rtc_time *tm)
+{
+	struct xlp_rtc *priv = dev_get_drvdata(dev);
+
+	/* Stop osilator */

Spelling.

+	writel(RTC_OSCSTOPFLAG_ENABLE, priv->base + RTC_FLAG_REG);
+
+	/* Write new time values To RTC time registers */
+	writel(bin2bcd(tm->tm_sec), priv->base + RTC_SECONDS_REG);
+	writel(bin2bcd(tm->tm_min), priv->base + RTC_MINUTES_REG);
+	writel(bin2bcd(tm->tm_hour), priv->base + RTC_CENTURY_HOURS_REG);
+	writel(tm->tm_wday, priv->base + RTC_DAY_REG);
+	writel(bin2bcd(tm->tm_mday), priv->base + RTC_DATE_REG);
+	writel(bin2bcd(tm->tm_mon), priv->base + RTC_MONTH_REG);
+	writel(bin2bcd(tm->tm_year % 100) | RTC_YEAR_REG_MASK,
+	       priv->base + RTC_YEAR_REG);
+
+	/* Wait till Transferinprogress flag to be reset */
+	return xlp_rtc_wait(priv, RTC_STATUS_REG,
+			    RTC_TRANSFER_IN_PROGRESS_BIT_POS,
+			    RTC_TRANSFER_IN_PROGRESS_BIT_MASK, 20, 0);
+}
+
+static const struct rtc_class_ops xlp_rtc_ops = {
+	.read_time = xlp_rtc_read_time,
+	.set_time = xlp_rtc_set_time,
+};
+
+static int xlp_rtc_probe(struct platform_device *pdev)
+{
+	struct xlp_rtc *priv;
+	struct resource *res;
+	int err;
+
+	priv = devm_kzalloc(&pdev->dev, sizeof(*priv), GFP_KERNEL);
+	if (!priv)
+		return -ENOMEM;
+
+	res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
+	priv->base = devm_ioremap_resource(&pdev->dev, res);
+	if (IS_ERR(priv->base))
+		return PTR_ERR(priv->base);
+
+	platform_set_drvdata(pdev, priv);
+
+	err = xlp_rtc_init(&pdev->dev);
+	if (err)
+		return err;
+
+	priv->rtc = devm_rtc_device_register(&pdev->dev, pdev->name,
+						     &xlp_rtc_ops,
THIS_MODULE);

Formatting

+	if (IS_ERR(priv->rtc))
+		return PTR_ERR(priv->rtc);
+
+	return 0;
+}
+
+static const struct of_device_id xlp_rtc_match[] = {
+	{
+	 .compatible = "netlogic,xlp208-rtc",
+	 },

Indent

+	{},
+};
+
+static struct platform_driver xlp_rtc_driver = {
+	.probe = xlp_rtc_probe,
+	.driver = {
+		   .name = "Netlogic-XLP-RTC",

Name is usually simpler like xlp208-rtc

+		   .of_match_table = xlp_rtc_match,
+		   },
+};
+
+module_platform_driver(xlp_rtc_driver);
+
+MODULE_AUTHOR(" <praveenb@broadcom.com>");
+MODULE_DESCRIPTION("RTC driver for Netlogic XLPII");
+MODULE_LICENSE("GPL V2");

JC.

Sent:	Wednesday, April 01, 2015 5:12 PM


Subject:	RE: rtc driver
Attachments:	0001-RTC-Added-RTC-driver-support-for-XLP2xx-XLP5xx-and-X.patch



	I have incorporated the changes which you suggested.
	The updated rtc code is present in the following branch,
		remotes/origin/proposed/praveenb/xlp_rtc_driver
(sysconfig, linux) 

	please find the attached patch file for code changes.
	
	According to PRM, RTC does not support interrupts.
	As nothing needs to be done in remove function, I have removed it.
(As per Subhendu's review comments)
	If it is mandatory, I will add the following lines as remove
function.

static int xlp_rtc_remove(struct platform_device *pdev)
{
        platform_set_drvdata(pdev, NULL);
        return 0;
}

Thank you,
.

-----Original Message-----

Sent: Tuesday, March 31, 2015 7:44 PM


Subject: Re: rtc driver

Here's my review, could not get it into gerrit. Please see the inline
comments

+/*
+ * Copyright (c) 2003-2015 Broadcom Corporation
+ * All Rights Reserved
+ *
+ * This software is available to you under a choice of one of two
+ * licenses.  You may choose to be licensed under the terms of the GNU
+ * General Public License (GPL) Version 2, available from the file
+ * COPYING in the main directory of this source tree, or the Broadcom
+ * license below:
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ * 1. Redistributions of source code must retain the above copyright
+ *    notice, this list of conditions and the following disclaimer.
+ * 2. Redistributions in binary form must reproduce the above copyright
+ *    notice, this list of conditions and the following disclaimer in
+ *    the documentation and/or other materials provided with the
+ *    distribution.
+ *
+ * THIS SOFTWARE IS PROVIDED BY BROADCOM ``AS IS'' AND ANY EXPRESS OR
+ * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
+ * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+ * ARE DISCLAIMED. IN NO EVENT SHALL BROADCOM OR CONTRIBUTORS BE LIABLE
+ * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
+ * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+ * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
+ * BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
+ * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
+ * OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN
+ * IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+*/

The module license says GPL, so use a simple GPLv2 here, no need for
GPLv2/BSD

+
+#include <linux/module.h>
+#include <linux/platform_device.h>
+#include <linux/rtc.h>
+#include <linux/bcd.h>
+#include <linux/jiffies.h>
+
+#define RTC_SECONDS_REG			0x00
+#	define RTC_TEN_SECONDS_BIT_MASK	0x70

This style is not used usually in the kernel, no indentation for #define

+
+#define RTC_MINUTES_REG			0x01
+#	define RTC_TEN_MINUTES_BIT_MASK	0x70
+
+#define RTC_CENTURY_HOURS_REG		0x02
+#	define RTC_TEN_HOUR_BIT_MASK	0x30
+
+#define RTC_DAY_REG			0x03
+#	define RTC_DAY_BIT_MASK		0x07
+
+#define RTC_DATE_REG			0x04
+#	define RTC_TEN_DATE_BIT_MASK	0x30
+
+#define RTC_MONTH_REG			0x05
+#	define RTC_TEN_MONTH_BIT_MASK	0x10
+
+#define RTC_YEAR_REG			0x06
+#	define RTC_TEN_YEAR_BIT_MASK	0xf0
+#	define RTC_YEAR_REG_MASK	0x80000000
+
+#define RTC_STATUS_REG					0x08
+#	define RTC_RESETACTIVE_BIT_MASK			0x01
+#	define RTC_RESETACTIVE_BIT_SHIFT		04
+#	define RTC_TRANSFER_IN_PROGRESS_BIT_POS		03
+#	define RTC_TRANSFER_IN_PROGRESS_BIT_MASK	0x01
+
+#define RTC_FLAG_REG				0x09
+#	define RTC_OSCSTOPFLAG_BIT_MASK		0x01
+#	define RTC_OSCSTOPFLAG_ENABLE		0x01
+#	define RTC_UPDATE_FLAG_BIT_SHIFT	02
+#	define RTC_UPDATE_FLAG_BIT_MASK		0x01
+#	define RTC_UPDATE_FLAG_ENABLE		0x04
+
+#define RTC_CLOCK_PERIOD_REG			0x0a
+#define RTC_LOCK_REG				0x0b
+#	define RTC_READ_LOCK_BIT_POS		0
+#	define RTC_READ_LOCK_BIT_MASK		0x01
+
+#define RTC_VOLT_REG				0x0c
+#	define RTC_CORE_ENABLE_MASK		0x02
+
+#define XLP_RTC_BCD2BIN(x, y)		(((x & 0x0f)) + ((x & y) >> 4) *
10)

Lot of defines above are not used like RTC_TEN_MONTH_BIT_MASK
and RTC_TEN_MONTH_BIT_MASK

And XLP_RTC_BCD2BIN() is unnecessary, doesn't just doing
bcd2bin(value & mask) work?

+
+struct xlp_rtc {
+	struct rtc_device *rtc_dev;
+	u32 __iomem *base;
+};
+
+static int xlp_rtc_wait(struct xlp_rtc *rtc,
+					int reg_offset, int bit_pos, int
mask)
+{
+	u32 value;
+	int set;
+	unsigned long stoptime;
+
+	/* Wait till flag to be reset */
+	stoptime = jiffies + msecs_to_jiffies(20);
+	while (time_after(stoptime, jiffies)) {
+		value = readl(rtc->base + reg_offset);
+		set = (value >> bit_pos) & mask;
+		if (!set)
+			return 0;
+	}
+	return -ETIMEDOUT;
+}
+
+static int wait_for_xlp_rtc_update(struct xlp_rtc *rtc)
+{
+	int rtcupdate;
+	unsigned long stoptime;
+	stoptime = jiffies + msecs_to_jiffies(1000);
+	while (time_after(stoptime, jiffies)) {
+		rtcupdate = (readl(rtc->base + RTC_FLAG_REG) >>
+				RTC_UPDATE_FLAG_BIT_SHIFT)
+				& RTC_UPDATE_FLAG_BIT_MASK;
+		if (rtcupdate)
+			return 0;
+	}
+	return -ETIMEDOUT;
+}

These two functions are almost duplicated code. Looks like one is
waiting for set and other function is waiting for clear.  Please combine
them by passing a value parameter.

+
+static int xlp_rtc_get_time(struct xlp_rtc *rtc, struct rtc_time *tm)
+{
+	int ret;
+	u32 value, sec, min, hour, day, date, month, year;
+
+	writel(RTC_UPDATE_FLAG_ENABLE, rtc->base + RTC_FLAG_REG);
+	/* Wait till read lock flag to be set */
+	ret = xlp_rtc_wait(rtc, RTC_LOCK_REG,
+					RTC_READ_LOCK_BIT_POS,
+					RTC_READ_LOCK_BIT_MASK);
+	if (ret) {
+		dev_dbg(&rtc->rtc_dev->dev,
+			"Failed to read RTC time, readlock flag not set
:\n");
+		return ret;
+	}
+
+	value = readl(rtc->base + RTC_YEAR_REG);
+	year = bcd2bin(value);
+
+	value = readl(rtc->base + RTC_MONTH_REG);
+	month = bcd2bin(value);
+
+	value = readl(rtc->base + RTC_DATE_REG);
+	date = bcd2bin(value);
+
+	value = readl(rtc->base + RTC_DAY_REG);
+	day = (value & RTC_DAY_BIT_MASK);
+
+	value = readl(rtc->base + RTC_CENTURY_HOURS_REG);
+	hour = XLP_RTC_BCD2BIN(value, RTC_TEN_HOUR_BIT_MASK);
+
+	value = readl(rtc->base + RTC_MINUTES_REG);
+	min = bcd2bin(value);
+
+	value = readl(rtc->base + RTC_SECONDS_REG);
+	sec = XLP_RTC_BCD2BIN(value, RTC_TEN_SECONDS_BIT_MASK);
+
+	tm->tm_sec = sec;
+	tm->tm_min = min;
+	tm->tm_hour = hour;
+	tm->tm_mday = date;
+	tm->tm_mon = month;
+	tm->tm_year = year;

Lot of unnecessary variables, it will be much easier to read if you do:

	value = readl(rtc->base + RTC_CENTURY_HOURS_REG);
	tm->tm_hour = bcd2bin(value & RTC_HOUR_BIT_MASK);

+	/* Assume we are in 1970...2069 */
+	if (tm->tm_year < 70)
+		tm->tm_year += 100;
+	tm->tm_wday = day;
+	tm->tm_yday =
+	    rtc_year_days(tm->tm_mday, tm->tm_mon, tm->tm_year);
+	return 0;
+
+}
+
+static int xlp_rtc_init(struct device *dev)
+{
+	u32 rtcupdate;
+	u32 data;
+	int ret;
+	unsigned long stoptime;

Unused variable - have you cleared all the warnings?


+	struct xlp_rtc *rtc = dev_get_drvdata(dev);
+
+	/* Enable core bit */
+	data = readl(rtc->base + RTC_VOLT_REG)
+		| RTC_CORE_ENABLE_MASK;
+	writel(data, rtc->base + RTC_VOLT_REG);
+
+	/* Wait for resetactive flag to be reset */
+	ret = xlp_rtc_wait(rtc, RTC_STATUS_REG,
+					RTC_RESETACTIVE_BIT_SHIFT,
+					RTC_RESETACTIVE_BIT_MASK);
+	if (ret)
+		return ret;
+
+	/* Wait for rtcupdate flag to be set */
+	ret = wait_for_xlp_rtc_update(rtc);
+	if (ret)
+		return ret;

using name err instead of ret in cases an error or 0 is returned
will make the code more readable.

+	writel(RTC_UPDATE_FLAG_ENABLE, rtc->base + RTC_FLAG_REG);
+
+	return 0;
+
+}
+
+static int xlp_rtc_read_time(struct device *dev, struct rtc_time *rtc_tm)
+{
+	int ret;
+	struct xlp_rtc *rtc = dev_get_drvdata(dev);
+
+	/* Read current time from RTC time registers */
+	ret = xlp_rtc_get_time(rtc, rtc_tm);
+	return ret;

unneeded variable.

+}
+
+static int xlp_rtc_set_time(struct device *dev, struct rtc_time *tm)
+{
+	int ret;
+	u32 sec, min, hour, mday, mon, year, wday;
+	struct xlp_rtc *rtc = dev_get_drvdata(dev);
+
+	ret = rtc_valid_tm(tm);
+	if (ret != 0)
+		return ret;

the valid time check not needed here, but probably needed in the
read path

+
+	sec = bin2bcd(tm->tm_sec);
+	min = bin2bcd(tm->tm_min);
+	hour = bin2bcd(tm->tm_hour);
+	mday = bin2bcd(tm->tm_mday);
+	wday = tm->tm_wday;
+	mon = bin2bcd(tm->tm_mon);
+	year = tm->tm_year % 100;
+	year = bin2bcd(year) | RTC_YEAR_REG_MASK;
+
+	/* Stop osilator */
+	writel(RTC_OSCSTOPFLAG_ENABLE, rtc->base + RTC_FLAG_REG);
+
+	/* Write new time values To RTC time registers */
+	writel(sec, rtc->base + RTC_SECONDS_REG);
+	writel(min, rtc->base + RTC_MINUTES_REG);
+	writel(hour, rtc->base + RTC_CENTURY_HOURS_REG);
+	writel(wday, rtc->base + RTC_DAY_REG);
+	writel(mday, rtc->base + RTC_DATE_REG);
+	writel(mon, rtc->base + RTC_MONTH_REG);
+	writel(year, rtc->base + RTC_YEAR_REG);

unnecessary statements, simpler
	writel(bin2bcd(tm->tm_sec), rtc->base + RTC_SECONDS_REG);


+
+	/* Wait till Transferinprogress flag to be reset */
+	ret = xlp_rtc_wait(rtc, RTC_STATUS_REG,
+					RTC_TRANSFER_IN_PROGRESS_BIT_POS,
+
RTC_TRANSFER_IN_PROGRESS_BIT_MASK);

Use standard indentation for continuation lines


+	return ret;

Avoid trivial statements like:
	x = fn();
	return x;
and use 
	return fn();

+
+}
+
+static const struct rtc_class_ops xlp_rtc_ops = {
+	.read_time = xlp_rtc_read_time,
+	.set_time = xlp_rtc_set_time,
+};
+
+static int xlp_rtc_probe(struct platform_device *pdev)
+{
+	struct xlp_rtc *rtc;

calling it rtc will be confusing, this is private data, priv
or rtc_info or rtc_data or anything to reflect that would be
better

+	struct resource *res;
+	int ret;
+
+	rtc = devm_kzalloc(&pdev->dev, sizeof(*rtc), GFP_KERNEL);
+	if (!rtc)
+		return -ENOMEM;
+
+	res = platform_get_resource(pdev, IORESOURCE_MEM, 0);
+	if (!res) {
+		dev_dbg(&pdev->dev, "no mem resource!\n");
+		return -EINVAL;
+	}

No need of this error check, the devm_iomap_resource does it
as part of API

+
+	rtc->base = devm_request_and_ioremap(&pdev->dev, res);
+	if (!rtc->base) {
+		dev_dbg(&pdev->dev, "device io mapping failed!\n");
+		return -EIO;
+	}

use newer devm_ioremap_resource() API, the return has to be
checked with IS_ERR() and return PTR_ERR()

+
+	platform_set_drvdata(pdev, rtc);
+
+	ret = xlp_rtc_init(&pdev->dev);
+	if (ret)
+		return ret;
+
+	rtc->rtc_dev = devm_rtc_device_register(&pdev->dev, pdev->name,
+						&xlp_rtc_ops,
THIS_MODULE);
+	if (IS_ERR(rtc->rtc_dev))
+		return PTR_ERR(rtc->rtc_dev);
+
+	return 0;
+}
+
+static const struct of_device_id xlp_rtc_match[] = {
+	{
+		.compatible = "netlogic,xlp208-rtc",
+	},
+	{},
+};
+
+static struct platform_driver xlp_rtc_driver = {
+	.probe = xlp_rtc_probe,
+	.driver = {
+		   .name = "Netlogic-XLP-RTC",
+		   .owner = THIS_MODULE,

.owner should be done by driver core.

+		   .of_match_table = xlp_rtc_match,
+		   },
+};

unregister part seems to be missing.

+
+module_platform_driver(xlp_rtc_driver);
+
+MODULE_AUTHOR(" <praveenb@broadcom.com>");
+MODULE_DESCRIPTION("RTC driver for Netlogic XLPII");
+MODULE_LICENSE("GPL V2");

Does the rtc have a interrupt?


JC.

Sent:	Monday, March 30, 2015 12:30 PM


Subject:	ww13 status



 

                Ran NPB bench marks on x86 (48 cpu) machine which is
located in SJ.

                Review in progress for RTC device driver, incorporated
changes suggested by Subhendu.

                

 





 


Sent:	Tuesday, March 24, 2015 11:04 AM


Subject:	ww12 status



 

            Ran NPB bench marks on Juno board (embedded os ) .

            Review in progress for RTC device driver, incorporated changes
suggested by Kamlakant.

 

            Misc:

                        PTO on 20Th and  23rd

            





 


Sent:	Thursday, March 12, 2015 7:22 PM

Subject:	RE: RTC driver for XLP2xx
Attachments:	rtc_test_log.txt



 

                I have  incorporated code review comments in the following
branch.

 
remotes/origin/proposed/praveenb/rtc_driver_support_for_xlp_qaq01 (linux
and sysconfig)

                

                Following are commit ids

709a60946f40c802179504902d821e5999ea5e84 (linux)

ecb9c4da68d2c01b9ff19ba42d5e5492457d6126 (sysconfig)

 

Tested the RTC driver functionality with hwclock and attached log file for
the same.

 

Git web links:

Linux:

http://git-ing-02.sj.broadcom.com/gitweb/?p=linux.git;a=commit;h=709a60946
f40c802179504902d821e5999ea5e84

sysconfig:

http://git-ing-02.sj.broadcom.com/gitweb/?p=sysconfig.git;a=commit;h=ecb9c
4da68d2c01b9ff19ba42d5e5492457d6126

 

 

                Please do review the new changes.

 





 


Sent: Wednesday, March 11, 2015 6:07 PM

Subject: RE: RTC driver for XLP2xx

 



 

                Modified sysconfig files for xlp9xx and xlp5xx to support
rtc driver.

                Following branch has updated changes.

 

 
remotes/origin/proposed/praveenb/rtc_driver_support_for_xlp_qaq01 (linux
and sysconfig)

 

                Please ignore the below email

Thanks




Sent: Wednesday, March 11, 2015 4:19 PM

Subject: RTC driver for XLP2xx

 



 

                Following branch has the updated RTC driver changes for
XLP2xx

 
remotes/origin/proposed/proposed/praveenb/rtc_driver_support_for_xlp2xx_qa
q01 (linux and sysconfig)

 





 


Sent:	Monday, March 09, 2015 6:51 PM

Subject:	FW: ww10 status
Attachments:	ww10 status (Team) (25.5 KB)

 

 


Sent: Monday, March 09, 2015 4:58 PM


Praveen kumar; Saswat Dash; Virendra Pathak
Subject: ww10 status

 

WW10:

 

.         Vulcan

.         HPC

o   No update

 

.         Griffin

.         Soft RoCE for XtremeIO - discussions/analysis reg memcpy,
multiple instances

.         jumbo frame issue, remote setup

.         Debugging issue with lower bandwidth, memory leak (rc mode)

.         Linux RTC driver for griffin/firefly (Praveen)

 

 

-----

 

WW11:

 

1.       Vulcan / SDK work items

.         Soft RoCE POC for XtremeIO

.         HPC benchmarks


Sent:	Tuesday, March 03, 2015 12:06 PM


Subject:	RE: Query on Read/Write RTC registers



 

                I tried the sequence which you sent for loading the time
into RTC , but still there is no effect.

 

                After writing to the registers , I am able to read the
same values for 100ms but after 100ms , I am seeing older values .

                

                1.            rtc_print_time();  /* seeing some time
values */

                2.            set_rtc_registers (); /* setting current
date and time  values */

                3.            rtc_print_time(); /* seeing current date and
time */

                4.            msleep(100);

                5.            rtc_print_time(); /* seeing older values as
#1 */

 

Can you please confirm if the same exact sequence is working at your
setup.

 

                I  am using 0xFFFFFFFFb8115000 as base value for xlp9xx
RTC registers. Can you please confirm if this base address is correct?

                And why this GPIO line 36 has to be enabled?

                                uint32_t *mmio_gpio_reg_bit36 = (uint32_t
*) C_XLP_IO_GPIO_PCIH_BASE + (0x41<<2);

*mmio_gpio_reg_bit36 = 0x10;

                

Thank You,




Sent: Tuesday, March 03, 2015 8:43 AM


Chandrashekaran Nair
Subject: RE: Query on Read/Write RTC registers

 



 

Can you please use this sequence for loading the time into the RTC.

 

  printf("Loading new time value again\n");

 

  *mmio_rtc_reg_flag =0x1;

  *mmio_rtc_reg_seconds =0x55;

  *mmio_rtc_reg_mins =0x59;

  *mmio_rtc_reg_hrs =0xa3;

  *mmio_rtc_reg_day =0x6;

  *mmio_rtc_reg_date =0x31;

  *mmio_rtc_reg_month =0x12;

  *mmio_rtc_reg_year =0x80000099;

  tranferInProgress = 1;

  while (tranferInProgress == 1) {

      tranferInProgress = (rtc_read_status() >> 3) & 0x1;

  }

  rtc_print_time();

 

,

Santosh

 


Sent: Sunday, March 01, 2015 10:33 PM


Chandrashekaran Nair
Subject: Query on Read/Write RTC registers

 



                

I have started working on  writing a driver to support internal Real Time
Clock (RTC) for XLP2xx/5xx/9xx

 

 

On XLP5xx/9xx I am able to read values from registers, but while writing
to the registers, the values are not reflecting.

               The base value used for registers is 0xFFFFFFFFb8115000

                And Register offset values are from 0x300 to 0x30f.

 

And on XLP2XX, I am facing an issue, The ResetActive bit on STATUS_REG is
always one and it is not going to zero. 

                The base value used for registers is 0xFFFFFFFFb8035000

                And STATUS_REG offset value is 0x308 

 

I am testing the driver with hwclock. 

I'm attaching the driver code. Please  have a look at "xlp_read_time" and
"xlp_write_time" functions in the attached file.

 

Please let me know with correct sequence of writing values to the
registers for setting time.

 

 





 


Sent:	Monday, March 02, 2015 5:50 PM


Subject:	status report W008



 

                Working on writing a driver to support internal Real Time
Clock (RTC) for XLP2xx/9xx/5xx.

                Facing an issue while writing time to RTC Registers and
Debugging the same.

                                

 





 


Sent:	Monday, March 02, 2015 3:57 PM


Subject:	RE: Query on Read/Write RTC registers

I checked with Arun Doddamani , He told that No need to enable any GPIO
lines to Read/Write RTC registers.

 


Sent: Monday, March 02, 2015 1:32 PM


Subject: RE: Query on Read/Write RTC registers

 

 

  uint32_t *mmio_gpio_reg_bit36 = (uint32_t *) C_XLP_IO_GPIO_PCIH_BASE +
(0x41<<2);

*mmio_gpio_reg_bit36 = 0x10;

 

This sets the output enable for line 36 I think. Not sure why this is
needed for RTC, you can check with the board team (Bala) if GPIO line 36
is used at all.

 

JC.

 


Sent: Monday, March 02, 2015 1:23 PM


Subject: RE: Query on Read/Write RTC registers

 



 

                The GPIO variables are not being used anywhere in the
program.

 

                And to enable the core we just need to set the
RtCoreEn(2nd bit) bit in VOLT_REG register.

 

                And In first 3 lines he just checked status of following
bits

resetActive bit in STATUS REG,

oscStopFlag bit in FLAG_REG,

oscDisable bit in SECONDS_REG.

 

                Also I tried with reading above 3 registers in the driver
code still doesn't work.

 

Thanks



 


Sent: Monday, March 02, 2015 12:45 PM


Subject: RE: Query on Read/Write RTC registers

 

I did a quick review of your rtc code and Santosh's verification code for
2xx

 

Santosh seems to be setting up a GPIO line before doing the operations -
have you checked this?

Also your core enable code is in the read path, which seems incorrect.

 

JC.

 


Sent: Monday, March 02, 2015 12:03 PM


Chandrashekaran Nair
Subject: Query on Read/Write RTC registers

 



                

I have started working on  writing a driver to support internal Real Time
Clock (RTC) for XLP2xx/5xx/9xx

 

 

On XLP5xx/9xx I am able to read values from registers, but while writing
to the registers, the values are not reflecting.

               The base value used for registers is 0xFFFFFFFFb8115000

                And Register offset values are from 0x300 to 0x30f.

 

And on XLP2XX, I am facing an issue, The ResetActive bit on STATUS_REG is
always one and it is not going to zero. 

                The base value used for registers is 0xFFFFFFFFb8035000

                And STATUS_REG offset value is 0x308 

 

I am testing the driver with hwclock. 

I'm attaching the driver code. Please  have a look at "xlp_read_time" and
"xlp_write_time" functions in the attached file.

 

Please let me know with correct sequence of writing values to the
registers for setting time.

 

 





 


Sent:	Monday, March 02, 2015 1:23 PM


Subject:	RE: Query on Read/Write RTC registers



 

                The GPIO variables are not being used anywhere in the
program.

 

                And to enable the core we just need to set the
RtCoreEn(2nd bit) bit in VOLT_REG register.

 

                And In first 3 lines he just checked status of following
bits

resetActive bit in STATUS REG,

oscStopFlag bit in FLAG_REG,

oscDisable bit in SECONDS_REG.

 

                Also I tried with reading above 3 registers in the driver
code still doesn't work.

 

Thanks



 


Sent: Monday, March 02, 2015 12:45 PM


Subject: RE: Query on Read/Write RTC registers

 

I did a quick review of your rtc code and Santosh's verification code for
2xx

 

Santosh seems to be setting up a GPIO line before doing the operations -
have you checked this?

Also your core enable code is in the read path, which seems incorrect.

 

JC.

 


Sent: Monday, March 02, 2015 12:03 PM


Chandrashekaran Nair
Subject: Query on Read/Write RTC registers

 



                

I have started working on  writing a driver to support internal Real Time
Clock (RTC) for XLP2xx/5xx/9xx

 

 

On XLP5xx/9xx I am able to read values from registers, but while writing
to the registers, the values are not reflecting.

               The base value used for registers is 0xFFFFFFFFb8115000

                And Register offset values are from 0x300 to 0x30f.

 

And on XLP2XX, I am facing an issue, The ResetActive bit on STATUS_REG is
always one and it is not going to zero. 

                The base value used for registers is 0xFFFFFFFFb8035000

                And STATUS_REG offset value is 0x308 

 

I am testing the driver with hwclock. 

I'm attaching the driver code. Please  have a look at "xlp_read_time" and
"xlp_write_time" functions in the attached file.

 

Please let me know with correct sequence of writing values to the
registers for setting time.

 

 





 


Sent:	Monday, March 02, 2015 12:03 PM


Subject:	Query on Read/Write RTC registers
Attachments:	rtc-xlp.c

Follow Up Flag:	Follow up
Flag Status:	Flagged



                

I have started working on  writing a driver to support internal Real Time
Clock (RTC) for XLP2xx/5xx/9xx

 

 

On XLP5xx/9xx I am able to read values from registers, but while writing
to the registers, the values are not reflecting.

               The base value used for registers is 0xFFFFFFFFb8115000

                And Register offset values are from 0x300 to 0x30f.

 

And on XLP2XX, I am facing an issue, The ResetActive bit on STATUS_REG is
always one and it is not going to zero. 

                The base value used for registers is 0xFFFFFFFFb8035000

                And STATUS_REG offset value is 0x308 

 

I am testing the driver with hwclock. 

I'm attaching the driver code. Please  have a look at "xlp_read_time" and
"xlp_write_time" functions in the attached file.

 

Please let me know with correct sequence of writing values to the
registers for setting time.

 

 





 


Sent:	Thursday, February 26, 2015 10:35 AM

Subject:	FW: Did RTC debug started for Firefly?
Attachments:	RTC.zip

 

 


Sent: Wednesday, February 25, 2015 11:00 PM


Subject: FW: Did RTC debug started for Firefly?

 

See attachment for the verification code, if the PRM is not correct.

 

JC.

 


Sent: Monday, February 23, 2015 6:49 PM

Hua

(Satyanarayana) Rao
Subject: RE: Did RTC debug started for Firefly?

 



 

Please find the RTC code for loading time here. The test file
rtc_load_time has the basic functions to load the time. Please let me know
if you need anything.

 

,

Santosh

 

 


Sent:	Wednesday, February 25, 2015 5:09 PM

Subject:	rtc code



 

 

 

#define RTC_REG_SECONDS_REG            0x300

#define RTC_REG_MINUTES_REG            0x301

#define RTC_REG_CENTURY_HOURS_REG      0x302

#define RTC_REG_DAY_REG                0x303

#define RTC_REG_DATE_REG               0x304

#define RTC_REG_MONTH_REG              0x305

#define RTC_REG_YEAR_REG               0x306

#define RTC_REG_CONTROL_REG            0x307

#define RTC_REG_STATUS_REG             0x308

#define RTC_REG_FLAG_REG               0x309

#define RTC_REG_CLOCK_PERIOD_REG       0x30a

#define RTC_REG_LOCK_REG               0x30b

#define RTC_REG_VOLT_REG               0x30c

#define RTC_REG_TEST_REG               0x30f

 

 

 

  u32 seconds_reg;

  u32 minutes_reg;

  u32 hours_reg;

  u32 volt_reg;

  u32 control_reg;

  u32 status_reg;

 

                struct xlp_rtc *rtc = dev_get_drvdata(dev);

 

                volt_reg = __raw_readl(rtc->base + RTC_REG_VOLT_REG);

  printk ("volt_reg = %u\n", volt_reg);

                __raw_writel(2, rtc->base + RTC_REG_VOLT_REG);

                volt_reg = __raw_readl(rtc->base + RTC_REG_VOLT_REG);

                status_reg = __raw_readl(rtc->base + RTC_REG_STATUS_REG);

  control_reg = __raw_readl(rtc->base + RTC_REG_CONTROL_REG);

  seconds_reg = __raw_readl(rtc->base + RTC_REG_SECONDS_REG);

  minutes_reg = __raw_readl(rtc->base + RTC_REG_MINUTES_REG);

  hours_reg = __raw_readl(rtc->base + RTC_REG_CENTURY_HOURS_REG);

  printk ("volt_reg = %u\n", volt_reg);

  printk ("status_reg = %u\n", status_reg);

  printk ("control_reg = %u\n", control_reg);

  printk ("seconds_reg = %u\n", seconds_reg);

  printk ("minutes_reg = %u\n", minutes_reg);

  printk ("hours_reg = %u\n", hours_reg);

 





 


Sent:	Monday, February 23, 2015 4:59 PM


Subject:	Weekly Status Report  WW07



 

1.       Ran NPB benchmarks on JUNO board (fedora 21)

a.       I have to prepare consolidated report.

2.       Started working on Real Time Clock driver.

 

 





 


Sent:	Tuesday, February 17, 2015 9:47 AM

Subject:	Weekly Status Report  WW07



 

                Ran NAS Parallel benchmarks on X86 for Class "S" and Class
"W".

                Started running NPB benchmarks on Juno board.

                                

 





 


Sent:	Monday, February 09, 2015 2:40 PM


Subject:	Weekly Status Report  WW06



 

                Read about the following topics in ARM Architecture,

                                Common Memory System Architecture,

                                Virtual Memory System Architecture,

                And Added regex statistics counters to native command
center.

 

 





 


Sent:	Tuesday, February 03, 2015 10:16 AM


Subject:	Weekly Status Report  WW05



                

                Studied about ARM architecture.

                                ARM system level Architecture,

                                System Level Programming Model.

                                                ARM Processor modes,

                                                Instructions set states,

                                                The security extensions,

                                                Exception Handling.


Sent:	Tuesday, January 27, 2015 4:31 PM


Subject:	Weekly Status Report  WW04



 

                Started reading about ARM architecture.

                Ramping up on linux device drivers

 

 





 


Sent:	Tuesday, January 13, 2015 10:23 AM


Subject:	Weekly status - WW02



 

                Started reading ARM architecture.

                                Read about introduction to arm
architecture , ARM core registers  and  status registers.

                                Started reading about Application level
memory model

 





 


Sent:	Monday, January 05, 2015 5:57 PM


Subject:	Weekly Status Report  WW01



 

                Last week worked on linux device drivers.

                                Read about Memory Mapping in linux device
drivers.

                                Read about function calls used in netl7
driver.

                Started Reading ARM Architecture. 

 





 


Sent:	Tuesday, December 30, 2014 11:11 AM


Subject:	Weekly status - WW52



 

                Written simple modular programs using memory map calls.

                Read about Memory Mapping in linux device drivers.

 

 

                Misc: 1day Leave (Friday)

 

 





 


Sent:	Tuesday, December 23, 2014 10:23 AM

Subject:	RE: Weekly status - WW51

Correction

                Started writing simple modular programs using memory map
calls to understand more about Memory Mapping.

 

 

 


Sent: Tuesday, December 23, 2014 10:21 AM


Krishna Gudivada; Shreyas Panduranga
Subject: Weekly status - WW51

 



 

                Read about Memory Mapping and DMA in linux device drivers.

                Started writing simple modular programs using memory map
calls to under more about Memory Mapping.

 





 


Sent:	Tuesday, December 23, 2014 10:21 AM


Subject:	Weekly status - WW51



 

                Read about Memory Mapping and DMA in linux device drivers.

                Started writing simple modular programs using memory map
calls to under more about Memory Mapping.

 





 


Sent:	Monday, December 15, 2014 6:44 PM


Subject:	Weekly Status report for Week-50



 

               Read about I/O ports and I/O Memory in device drivers

 

 





 


Sent:	Monday, December 08, 2014 6:03 PM


Subject:	Weekly Status report for Week-49



 

                Wrote simple programs using kmalloc and vmalloc to
understand more about vmalloc and kmalloc

                Started reading about I/O ports.

 

 





 


Sent:	Monday, December 01, 2014 6:40 PM


Subject:	Weekly Status report for Week-48



 

                Studied Following topics in linux-device drivers

                                Memory allocation in modular programs

                                Vmalloc and per-cpu variables

                                Writing simple programs to understand more
about these topics.

 

 

 





 


Sent:	Monday, November 24, 2014 6:47 PM


Subject:	Weekly Status report for Week-47



 

                Studied Following topics in linux-device drivers

                                Ioctl , Blocking I/O and interuppts

                                Ioctl is used to communicate with the
device 

 

 





 


Sent:	Tuesday, November 18, 2014 9:39 AM
Learning Linux device drivers.
Read about Interrupts in Device driver
programs.
Ran simple device driver programs on foundation model
Ran hello world , char device program on
Foundation model

Compiled USB mouse driver program for
Foundation model.
Read about basics of ARM architecture.


Sent:	Tuesday, November 11, 2014 9:59 AM
Working on Foundation model,
Complied and installed simple modular
programs.
Working on character device drivers.

Sent:	Tuesday, November 04, 2014 10:04 AM
Working on Foundation model,
Got kernel source and tool chain for ARM
foundation model.
Found some issues while
compiling kernel source which downloaded from Linaro.
Downloaded another kernel
source form Buildroot. With this I am able to compile the kernel and
loaded vmlinux on Foundation model.
Got some issues while
compiling drivers (default drivers exist in kernel source) , checking
these issues.

Sent:	Tuesday, October 28, 2014 11:37 AM
Working on ARM Foundation model,
Downloaded kernel source and tool chain
from Linaro.
Found issues while compiling kernel
source,  searching for a solution and other sources to compile kernel
source.

Sent:	Tuesday, October 21, 2014 9:37 AM
Working on Foundation Model
Downloaded and running the Foundation
Model with sample Images.
Trying to compile the linux source and
also some simple programs using appropriate toolchain.

Sent:	Monday, October 13, 2014 6:23 PM
Understanding the linux usb storage driver program. 


Sent:	Wednesday, October 08, 2014 10:05 AM
Understanding the linux USB mouse driver and USB key board
driver programs.
Using print statements understating USB
mouse driver program (like which function  are called when a USB mouse
attached).

Started reading about USB storage driver.

Sent:	Tuesday, September 23, 2014 9:39 AM
Understanding linux existing usb mouse driver, and trying
to write basic usb driver.                         
Understanding basic modular program functions by writing
simple basic modular programs and compiling.

Sent: Tuesday, September 16, 2014 7:19 AM
Worked on LESSFS,  after Team meeting started reading
about drivers. 
Reading and understanding about basic driver programming and then started
reading USB driver basics
Reading Basic concepts of USB protocol.


Sent:	Tuesday, September 16, 2014 9:49 AM
Worked on LESSFS,  after Team meeting started reading
about drivers. 
Reading and understanding about basic driver programming and then started
reading USB driver basics
Reading Basic concepts of USB protocol.

Sent:	Tuesday, September 09, 2014 10:04 AM
Worked on LESSFS 

1.       Understanding The Lessfs code

2.       Checked Hash values for different string using the following Hash
algorithms.

a.       Tiger Mhash (192 bit Hash)

b.      MHASH SHA256 (256 bit Hash)

c.       MHASH SHA1 (160 bit Hash)

XLP supports SHA1 and SHA256 Hash algorithms.

Sent:	Wednesday, August 27, 2014 10:09 AM
1.      Worked on data duplication on XLP
Tested lessfs on X86 and noted down block usage numbers for HDD and SSD
Hard disks.
Understanding the lessfs code.

Sent:	Tuesday, August 19, 2014 2:39 PM
1.       Tried to install SDFS on xlp but didn't get proper source files.


2.       Installed and testing LESSFS on XLP.

Installed dependent packages For lessfs

a.       mhash

b.      fuse

c.       tokyocabinet

Able to create lessfs on available disk space which is mounted using nfs
server.

Sent:	Tuesday, August 12, 2014 4:48 PM
1.Installed Lessfs on XLP but while creating a lessfs file system
taking so much time.
Trying to create a specific amount of volume with lessfs file system.
2.       Checking for Source of SDFS (open dedup) to compile for XLP.

Sent:	Tuesday, August 05, 2014 11:10 AM
Read about dedup and Lessfs.

1.       Lessfs is solution for data deduplication.

                                                In the process of data
deduplication redundant data will be removed and only one copy of data
will be stored on disk.

 

2.       Installed Lessfs on VMware (Ubuntu) .

3.       Experimenting with lessfs.

 

4.       Trying to install Open-dedup on one of the lab machine.

Sent:	Wednesday, July 30, 2014 12:30 PM

Read about HDFS and openstack,

And installed devstack application (openstack demo for
single machine) on VMware and one lab machine to get more information
about openstack.

 

Dev stack creates a webserver with GUI interface to run openstack. 

Trialing different options available in devstack.

Sent:	Tuesday, July 15, 2014 11:39 AM
Brcm_nae_app:

1.       Created one temporary queue and store packets according to packet
proceeding time (randomly generated).

2.       Based on packet processing time need to release the packet and
store new packet.

Read about storage topics:

1.       HDFS

2.       GFS

3.       OpenStack

4.       MYSQLDB

5.       MONGODB.

Just got basic idea about these topics , have to read more about these
topics.

Sent:	Tuesday, June 10, 2014 9:55 AM
Worked on brcm_nae app in loop back mode with 16 threads

1.       Created a temporary queue with size 10 to store and send packets.

a.       Packet latency is 62.6 us for packet size 512 and 179 us for
packet size 1518.

b.      Changed number of free descriptors from 150 to 170 in dts file to
work with Queue size 10.

2.       With Queue size 100 got some issue . analyzing the same.

Sent:	Tuesday, June 03, 2014 10:31 AM
Worked on brcm-nae app

1.       Ran brcm_nae_app in loop back mode

2.       Understanding the code to find packet latency.

3.       Average packet latency in loop back mode is 1.28 us on XLP3XX
Board

4.       Started learning about all  initializations in nae app.
 
Sent:	Tuesday, May 27, 2014 11:15 AM
Worked on code to dump memory allocation details for
compiler code.

Made code changes as discussed in code
review.
Started working on brcm-nae app to calculate packet
latency. 

Sent:	Tuesday, May 20, 2014 10:19 AM
Worked on code support for regex.*regex
Made code changes as discussed in code
review.
Started learning about brcm_nae app.

Sent:	Tuesday, May 13, 2014 9:14 AM
Worked on code support for regex.*regex
Testing with existing regex tests.

Sent: Monday, May 12, 2014 5:09 PM
Worked on code support for regex.*regex
Testing with exciting existing regex
tests.

Sent:	Monday, May 12, 2014 5:09 PM
Worked on code support for regex.*regex
Testing with exciting regex tests.


Sent:	Monday, May 05, 2014 7:15 PM
Started work on to supporting regex.*regex
Analyzing possible supported regex.

Sent:	Monday, April 28, 2014 6:36 PM
Added a check to find Overlapping fields for grammar rules
(EPSW-1215 <http://engjira.sj.broadcom.com/browse/EPSW-1215> )

If parent and child both fields have
grammar rules will get matches for only child field.

Added code to generate dot graph (tree
structure) for grammar files and highlight fields which has grammar rules.

Optimize compile time for Main Engine rules (trigger
comparison)

Changed hash calculation for start
anchored rules so that it avoids comparison of actual trigger bytes.

Optimize parser instructions (jira issue EPSW-515
<http://engjira.sj.broadcom.com/browse/EPSW-515> )

Generate MATCH_BR_STR instruction for case
ignore string present in grammar field.

Existing code generates match cc cnt1
instruction for every byte in the string.

Sent:	Monday, April 21, 2014 5:36 PM
Added debug information (with compile time enable/disable
option) to check module wise memory usage for dpi compiler, have to send
for code review.

Started work on finding Overlapping fields for grammar
rules (parent and child have grammar rules).

Sent:	Monday, April 14, 2014 10:53 AM

Continued with adding debug information (with compile time
enable/disable option) to check module wise memory usage for dpi compiler.


Sent:	Saturday, March 29, 2014 8:27 PM

Debugging and analyzing compile time for bsd and non bsd rules.

Generating 1million random regex rules and analyzing which
function is taking more compile time.

Started working on adding debug information to check memory usage for dpi
compiler. 

Sent:	Monday, March 24, 2014 7:08 PM

Added hash based string comparison to search for
duplicate strings.

1.       Compute 64bit bsd signature with SEED0 as hash value.

2.        Handled multiple rule actions If duplicate strings found
(signature and string matches for both strings) 

3.        If signature matches for two different strings then mark the
group as to rebuild signatures with SEED1.

4.       Use this calculated signatures while creating bsd dictionary.

5.       If the group has to rebuild signatures with SEED1 then calculate
new signatures with SEED1 and  then create bsd dictionary.

Added a switch (USE_BSD_SEED1) to calculate bsd signatures with SEED1
instead of SEED0 (default SEED0).

Added new grammar tests.                      

Tests to verify the results when macro
stitching disabled for single field grammar rules.

13 New BSD tests

Tests to check direct
match results by BSD.

Tests to check duplicate
strings rule actions by BSD and Stitcher.

Test with duplicates
strings with in the rule.

Tests to check duplicate
rule in original group and virtual group

Test to check results with
SEED1

Test with False Positive
matches.

17 new grammar tests
Tests with duplicate
grammar rules (single field , complex , scoped rules and combinations)
Tests to check duplicate
rule actions by DFA 
Tests to check duplicate
rule actions by DFA -> NFA
rule actions by DFA -> NFA -> stitcher
rule actions by DFA -> stitcher
Tests to check duplicates
rules one with micro stitched and one with macro stitched.
Tests to check presence of
micro flags after the grammar field.
Test to check duplicate
rules in original group and virtual group.

Sent:	Monday, March 17, 2014 7:24 PM
Resetting micro stitcher flags at the end
of every grammar field.
Created one new token and
token program to kill all micro stitcher flags at the end of grammar
field.
Added a parser instruction
which calls stitcher with a specific token_id to kill all micro stitcher
flags.
Fixed generation of invalid match ids
(token id as match id) from stitcher.
This case occurs if a
string was macro stitched and micro stitched. So skip macro stitched rules
while checking for duplicate strings in stitcher.
Fixed an issue while converting regex rule to bsd strings.
Create new rule for unique strings. Don't create for
duplicate strings.
Fixed an issue in dpi_model
Instead of processing all jobs at a time , process only
required number of jobs sent from app to start jobs.
Added checks to validate arguments passed to api calls in
dpi_model's packet api.

Sent:	Monday, March 10, 2014 7:50 PM
Disabled generation of stitcher tokens for single field
grammar rules

Handled multiple rule actions (rule actions of duplicate rules) in dfa ,
nfa are done

Working on handling multiple rule actions in stitcher (for  rules like
abcd.*xyz)

Writing test cases to check above changes
and running existing daily regression test. 

Sent:	Monday, March 03, 2014 6:27 PM
Disabled generation of stitcher tokens for single field
grammar rules(BSD or NonBSD groups).

Marked fields used in
complex grammar rules and scoped rules.

Marked groups which
belongs to a composite field grammar rule.

Disabled generation of stitcher tokens for
groups belongs to single filed grammar rules.

Found and fixed some issues with duplicate
rules when disabled generation of stitcher tokens for grammar rules.

If duplicate rule found , rule actions are appended to original rule.

Handle multiple rule
actions while generating ac match instructions and nfa match instructions.

Bsd alone cannot handle
multiple rule actions so creating stitcher token programs for bsdable
rules with multiple rule actions.

Read about Thompson nfa graph , and nfa
instructions to handle multiple rule actions.

Sent:	Monday, February 24, 2014 6:46 PM
Disabled generation of stitcher tokens for single field
grammar rules(BSD or NonBSD groups).
Marked fields used in
complex grammar rules and scoped rules.
Marked groups which
belongs to a composite field grammar rule.
Disabled generation of stitcher tokens for
groups belongs to single filed grammar rules.
Found issues with duplicate rules.
analyzing a way to handle duplicate rules.

Sent:	Tuesday, February 18, 2014 11:07 AM

1.       Fixed Memory leak issues in DPI_MODEL and BSD compiler code.

a.       Added unload database function to every module in dpi_model.

b.      Before destroy flow calling free context to free context memory
for every module.

c.       Added dpi module fini function to free allocated memory for
module data, downstream list and path.

Sent:	Monday, February 10, 2014 5:57 PM
1.       Reading Vulcan dru micro-architecture document.

2.       Debugging issues found while generation dat files.  

Job queue is circular queue but moving job by job linearly so reaching out
of boundary value.

Observed some memory leaks.
Fixing these memory leaks.
